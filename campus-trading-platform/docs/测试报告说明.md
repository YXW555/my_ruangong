# 测试报告说明文档

## 一、测试结果报告生成位置

### 1. JUnit 测试报告（Surefire Reports）

**生成位置**：
- **本地**：`campus-trading-platform/backend/target/surefire-reports/`
- **CI/CD**：GitHub Actions 会将其上传为 Artifact，可在 Actions 页面下载

**报告内容**：
- `TEST-*.xml`：测试结果 XML 格式
- `*.txt`：测试结果文本格式
- 包含每个测试用例的执行结果（通过/失败）

**查看方式**：
```bash
# 本地运行测试并查看报告
cd campus-trading-platform/backend
mvn test
# 报告生成在 target/surefire-reports/ 目录
```

### 2. 代码覆盖率报告（JaCoCo）

**生成位置**：
- **本地**：`campus-trading-platform/backend/target/site/jacoco/index.html`
- **CI/CD**：GitHub Actions 会将其上传为 Artifact

**报告内容**：
- 代码覆盖率百分比
- 每个类、方法的覆盖率详情
- 未覆盖的代码行标记

**查看方式**：
```bash
# 本地运行测试并生成覆盖率报告
cd campus-trading-platform/backend
mvn test jacoco:report
# 然后用浏览器打开 target/site/jacoco/index.html
```

### 3. GitHub Actions 测试报告

**查看位置**：
1. 进入 GitHub 仓库
2. 点击 **Actions** 标签
3. 选择最新的工作流运行
4. 在 **Artifacts** 部分下载测试报告

**报告内容**：
- `backend-test-results`：包含 Surefire Reports 和 JaCoCo 报告

---

## 二、GitHub Actions 测试失败行为

### 1. 测试失败会导致什么？

**是的，如果测试不通过，GitHub Actions 会报错！**

具体行为：

1. **`backend-test` 任务失败**：
   - 如果 `mvn test` 执行失败（有测试用例失败）
   - 整个 `backend-test` 任务会标记为失败（红色 ❌）
   - **不会继续执行后续任务**（Docker 构建、部署等）

2. **依赖关系**：
   ```
   backend-test (必须成功)
      ↓
   docker-build-push (依赖 backend-test)
      ↓
   deploy (依赖 docker-build-push)
   ```
   
   如果 `backend-test` 失败，后续任务都不会执行。

3. **测试失败的原因**：
   - 测试用例断言失败（`assertTrue(false)`）
   - 测试代码抛出异常
   - 编译错误
   - 测试超时

### 2. 如何查看测试失败详情？

1. **在 GitHub Actions 中**：
   - 进入失败的运行
   - 点击 `backend-test` 任务
   - 查看 `Run tests` 步骤的日志
   - 可以看到具体哪个测试失败了，为什么失败

2. **本地调试**：
   ```bash
   cd campus-trading-platform/backend
   mvn test
   # 查看控制台输出，找到失败的测试
   ```

### 3. 测试失败示例

**示例 1：测试用例失败**
```
[ERROR] Tests run: 10, Failures: 2, Errors: 0, Skipped: 0
[ERROR] testAddIdleItem(IdleItemServiceTest)  FAILED
[ERROR]   expected: <true> but was: <false>
```

**示例 2：编译错误**
```
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.1:testCompile
[ERROR] Compilation failure
```

---

## 三、当前已实现的测试

### 1. 单元测试（Service 层）

**文件位置**：`backend/src/test/java/com/second/hand/trading/server/service/`

| 测试类 | 测试内容 | 测试用例数 |
|--------|---------|-----------|
| `UserServiceTest` | 用户服务测试 | 3个 |
| `IdleItemServiceTest` | 商品服务测试 | 7个 |
| `OrderServiceTest` | 订单服务测试 | 6个 |

**测试覆盖的功能**：
- ✅ 用户登录、注册、获取信息
- ✅ 商品发布、查询、搜索、更新
- ✅ 订单创建、查询、更新

### 2. 集成测试（Controller 层）

**文件位置**：`backend/src/test/java/com/second/hand/trading/server/controller/`

| 测试类 | 测试内容 | 测试用例数 |
|--------|---------|-----------|
| `UserControllerTest` | 用户接口测试 | 2个 |
| `IdleItemControllerTest` | 商品接口测试 | 6个 |
| `OrderControllerTest` | 订单接口测试 | 6个 |

**测试覆盖的接口**：
- ✅ `/user/login`、`/user/sign-in`
- ✅ `/idle/add`、`/idle/info`、`/idle/all`、`/idle/find`
- ✅ `/order/add`、`/order/info`、`/order/update`、`/order/my`

---

## 四、运行测试

### 1. 本地运行所有测试

```bash
cd campus-trading-platform/backend
mvn test
```

### 2. 运行特定测试类

```bash
mvn test -Dtest=UserServiceTest
mvn test -Dtest=IdleItemServiceTest
```

### 3. 运行单个测试方法

```bash
mvn test -Dtest=UserServiceTest#testUserLogin
```

### 4. 生成覆盖率报告

```bash
mvn test jacoco:report
# 然后打开 target/site/jacoco/index.html
```

---

## 五、测试报告填写建议

### 1. 模块测试（表3-2）

**选择模块**：
- 用户登录模块（`UserService.userLogin`）
- 商品发布模块（`IdleItemService.addIdleItem`）
- 订单创建模块（`OrderService.addOrder`）

**填写方式**：
1. 画程序流程图（可以用工具如 draw.io）
2. 找出基本路径
3. 运行对应的 JUnit 测试
4. 将测试结果填入表格：
   - **输入**：测试用例的输入数据
   - **期望输出**：测试用例的断言
   - **输出内容**：实际测试结果
   - **测试结果**：✅ 通过 或 ❌ 失败
   - **测试人**：可以写"JUnit自动化测试"或你的名字

### 2. 功能测试（表3-4）

**使用 Postman 手动测试**：
1. 列出功能需求（表3-3）
2. 用 Postman 测试每个接口
3. 填写测试表格：
   - **功能名称**：如"用户登录"
   - **输入内容**：请求参数
   - **期望输出**：预期的响应
   - **输出内容**：实际的响应
   - **测试结果**：✅ 通过 或 ❌ 失败
   - **测试人**：你的名字

---

## 六、Postman 手动测试指南

### 1. 安装 Postman

- 下载地址：https://www.postman.com/downloads/
- 安装桌面版（推荐）或使用网页版

### 2. 创建 Collection

1. 打开 Postman
2. 点击 **New** → **Collection**
3. 命名为"校园二手交易平台API"
4. 创建文件夹组织接口：
   - 用户模块
   - 商品模块
   - 订单模块

### 3. 测试接口示例

#### 用户登录接口

**请求**：
- **方法**：POST
- **URL**：`http://localhost:8080/user/login`
- **参数**：
  - `accountNumber`: `13800138000`
  - `userPassword`: `123456`
- **类型**：`application/x-www-form-urlencoded`

**预期响应**：
```json
{
  "status_code": 200,
  "data": {
    "id": 1,
    "accountNumber": "13800138000",
    "nickname": "测试用户"
  }
}
```

#### 发布商品接口

**请求**：
- **方法**：POST
- **URL**：`http://localhost:8080/idle/add`
- **Headers**：
  - `Content-Type`: `application/json`
- **Cookie**：
  - `shUserId`: `1`（需要先登录获取）
- **Body**（JSON）：
```json
{
  "idleName": "测试商品",
  "idlePrice": 99.99,
  "idleLabel": 1,
  "idleDetails": "这是一个测试商品",
  "stock": 1
}
```

### 4. 测试流程建议

1. **先测试登录接口**，获取 Cookie
2. **保存 Cookie**，后续接口都带上
3. **按功能模块测试**：
   - 用户模块（登录、注册）
   - 商品模块（发布、查询、搜索）
   - 订单模块（创建、查询、更新）

### 5. 填写测试报告

测试完每个接口后，将结果填入表3-4：
- **功能名称**：接口功能
- **输入内容**：请求参数
- **期望输出**：预期的响应
- **输出内容**：Postman 显示的响应
- **测试结果**：✅ 通过 或 ❌ 失败
- **测试时间**：测试时间
- **测试人**：你的名字

---

## 七、常见问题

### Q1: 测试报告在哪里查看？

**A**: 
- **本地**：`backend/target/surefire-reports/` 和 `backend/target/site/jacoco/`
- **GitHub Actions**：在 Actions 页面的 Artifacts 中下载

### Q2: 测试失败会导致部署失败吗？

**A**: 
- **是的**！如果测试失败，GitHub Actions 不会继续执行 Docker 构建和部署任务
- 这是 CI/CD 的保护机制，确保只有测试通过的代码才会被部署

### Q3: 如何让测试通过？

**A**: 
1. 运行 `mvn test` 查看失败原因
2. 修复代码或测试用例
3. 重新运行测试
4. 确保所有测试通过后再提交代码

### Q4: Postman 测试和 JUnit 测试有什么区别？

**A**: 
- **JUnit 测试**：自动化测试，测试代码逻辑，适合回归测试
- **Postman 测试**：手动测试，测试接口功能，适合功能验证和填写测试报告

### Q5: 测试覆盖率要达到多少？

**A**: 
- **建议**：核心功能（用户、商品、订单）覆盖率 > 60%
- **当前**：运行 `mvn test jacoco:report` 查看当前覆盖率

---

## 八、总结

1. **测试报告位置**：
   - 本地：`backend/target/surefire-reports/` 和 `backend/target/site/jacoco/`
   - CI/CD：GitHub Actions Artifacts

2. **测试失败影响**：
   - ✅ 测试失败 → GitHub Actions 报错 → 不会部署

3. **已实现的测试**：
   - ✅ 单元测试：UserService、IdleItemService、OrderService
   - ✅ 集成测试：UserController、IdleItemController、OrderController

4. **Postman 手动测试**：
   - 用于功能测试和填写测试报告
   - 不需要自动化，手动操作即可

