# Redis在校园二手交易平台中的应用场景

## 一、核心应用场景

### 1. **缓存层** - 提升性能
- **商品列表缓存**：首页商品列表、分类商品列表（缓存5-10分钟）
- **商品详情缓存**：热门商品详情（缓存30分钟）
- **用户信息缓存**：登录用户信息（缓存1小时）
- **统计数据缓存**：平台统计数据（缓存10分钟）

**收益**：减少数据库查询，提升响应速度

---

### 2. **会话管理** - 替代Cookie
- **用户登录状态**：存储用户Session（30天过期）
- **管理员登录状态**：存储管理员Session
- **支持分布式部署**：多服务器共享Session

**收益**：更安全、支持集群部署

---

### 3. **计数器** - 实时统计
- **商品浏览量**：`product:view:{id}` - 记录商品浏览次数
- **商品收藏数**：`product:favorite:{id}` - 实时收藏数
- **用户发布数**：`user:publish:{id}` - 本月发布数量（会员权限检查）

**收益**：实时统计，无需频繁查数据库

---

### 4. **分布式锁** - 防止并发问题
- **防止重复提交**：订单创建、支付回调（锁3秒）
- **库存扣减**：防止超卖（锁5秒）
- **会员开通**：防止重复开通（锁2秒）

**收益**：解决并发问题，保证数据一致性

---

### 5. **限流控制** - 防止恶意请求
- **登录限流**：同一账号5分钟内最多尝试5次
- **发布限流**：同一用户1分钟内最多发布1个商品
- **API限流**：接口调用频率限制

**收益**：防止暴力破解、刷接口

---

### 6. **排行榜** - 热门数据
- **热门商品**：按浏览量、收藏数排序（ZSET）
- **销量排行**：按订单数排序
- **活跃用户**：按发布商品数排序

**收益**：快速获取热门数据，提升用户体验

---

### 7. **消息队列** - 异步任务
- **订单超时取消**：延迟队列，30分钟未支付自动取消
- **会员到期提醒**：到期前3天提醒
- **商品下架通知**：异步发送通知

**收益**：异步处理，不阻塞主流程

---

### 8. **购物车** - 临时数据
- **未登录购物车**：临时存储商品（7天过期）
- **已登录购物车**：持久化存储

**收益**：提升用户体验，支持未登录浏览

---

### 9. **搜索热词** - 数据分析
- **热门搜索词**：统计搜索关键词（ZSET）
- **搜索历史**：用户搜索历史（7天过期）

**收益**：了解用户需求，优化搜索功能

---

### 10. **验证码存储** - 安全验证
- **短信验证码**：`sms:code:{phone}` - 5分钟过期
- **邮箱验证码**：`email:code:{email}` - 10分钟过期
- **图形验证码**：`captcha:{sessionId}` - 2分钟过期

**收益**：安全验证，防止恶意注册

---

## 二、推荐优先级

### 高优先级（立即实现）
1. ✅ **缓存层** - 商品列表、详情（性能提升明显）
2. ✅ **分布式锁** - 订单、支付（防止并发问题）
3. ✅ **计数器** - 浏览量、收藏数（实时统计）

### 中优先级（后续优化）
4. ⭐ **会话管理** - 替代Cookie（支持集群）
5. ⭐ **限流控制** - API限流（安全防护）
6. ⭐ **排行榜** - 热门商品（用户体验）

### 低优先级（可选）
7. 📌 **消息队列** - 异步任务（功能增强）
8. 📌 **购物车** - 临时存储（功能增强）
9. 📌 **搜索热词** - 数据分析（运营支持）

---

## 三、技术实现要点

### 依赖添加
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

### 配置示例
```yaml
spring:
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
```

### 使用示例
```java
@Autowired
private StringRedisTemplate redisTemplate;

// 缓存商品
redisTemplate.opsForValue().set("product:" + id, json, 30, TimeUnit.MINUTES);

// 计数器
redisTemplate.opsForValue().increment("product:view:" + id);

// 分布式锁
Boolean lock = redisTemplate.opsForValue()
    .setIfAbsent("lock:order:" + orderId, "1", 5, TimeUnit.SECONDS);
```

---

## 四、预期收益

| 场景 | 性能提升 | 用户体验 | 安全性 |
|------|---------|---------|--------|
| 缓存 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | - |
| 会话管理 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 计数器 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | - |
| 分布式锁 | - | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 限流 | - | - | ⭐⭐⭐⭐⭐ |
| 排行榜 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | - |

---

## 五、总结

**核心价值**：
- 🚀 **性能提升**：缓存减少数据库压力，响应速度提升50%+
- 🔒 **数据安全**：分布式锁防止并发问题，限流防止恶意请求
- 📊 **实时统计**：计数器、排行榜提供实时数据
- 🎯 **用户体验**：热门商品、搜索热词提升用户体验

**建议**：先从缓存、分布式锁、计数器开始，这三个场景收益最大且实现简单。

