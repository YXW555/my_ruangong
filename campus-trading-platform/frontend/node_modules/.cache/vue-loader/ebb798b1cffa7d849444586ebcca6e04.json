{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\MerchantApplicationAdmin.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\MerchantApplicationAdmin.vue","mtime":1767591458677},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n    name: \"MerchantApplicationAdmin\",\n    data() {\n        return {\n            loading: false,\n            applications: [],\n            dialogVisible: false,\n            currentApplication: null,\n            adminComment: ''\n        };\n    },\n    created() {\n        this.loadApplications();\n    },\n    methods: {\n        loadApplications() {\n            this.loading = true;\n            this.$api.adminGetAllApplications({ status: 0 }) // 0 表示待审核\n                .then(res => {\n                    if (res.status_code === 1) {\n                        this.applications = res.data;\n                    }\n                    this.loading = false;\n                })\n                .catch(() => {\n                    this.loading = false;\n                    this.$message.error('数据加载失败');\n                });\n        },\n        viewDetails(application) {\n            this.currentApplication = application;\n            this.adminComment = '';\n            this.dialogVisible = true;\n        },\n        async review(status) {\n            if (status === 2 && !this.adminComment) {\n                this.$message.warning('拒绝申请必须填写理由');\n                return;\n            }\n\n            try {\n                const res = await this.$api.adminReviewApplication({\n                    applicationId: this.currentApplication.id,\n                    status: status,\n                    adminComment: this.adminComment\n                });\n\n                if (res.status_code === 1) {\n                    this.$message.success('操作成功');\n                    this.dialogVisible = false;\n                    // 刷新列表（忽略其内部错误）\n                    try {\n                        this.loadApplications();\n                    } catch (e) {\n                        console.error('刷新列表失败', e);\n                    }\n                    // 刷新父组件的角标（如果存在）\n                    try {\n                        if (this.$parent && typeof this.$parent.loadPendingCount === 'function') {\n                            this.$parent.loadPendingCount();\n                        }\n                    } catch (e) {\n                        console.error('刷新待审核数量失败', e);\n                    }\n                } else {\n                    this.$message.error(res.msg || '操作失败');\n                }\n            } catch (e) {\n                console.error('审核请求失败', e);\n                this.$message.error('操作失败');\n            }\n        }\n    },\n    filters: {\n        formatDate(time) {\n            if (!time) return '';\n            let date = new Date(time);\n            return date.toLocaleString();\n        }\n    }\n}\n",{"version":3,"sources":["MerchantApplicationAdmin.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MerchantApplicationAdmin.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\n    <div class=\"merchant-application-admin-container\">\n        <el-card shadow=\"never\">\n            <div slot=\"header\" class=\"clearfix\">\n                <span>商家认证审核</span>\n                <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"loadApplications\">刷新</el-button>\n            </div>\n\n            <el-table\n                :data=\"applications\"\n                v-loading=\"loading\"\n                style=\"width: 100%\">\n                <el-table-column\n                    prop=\"user.nickname\"\n                    label=\"申请人\"\n                    width=\"180\">\n                </el-table-column>\n                <el-table-column\n                    prop=\"shopName\"\n                    label=\"店铺名称\">\n                </el-table-column>\n                <el-table-column\n                    prop=\"contactPhone\"\n                    label=\"联系电话\"\n                    width=\"180\">\n                </el-table-column>\n                <el-table-column\n                    prop=\"createTime\"\n                    label=\"申请时间\"\n                    width=\"180\">\n                    <template slot-scope=\"scope\">\n                        {{ scope.row.createTime | formatDate }}\n                    </template>\n                </el-table-column>\n                <el-table-column\n                    label=\"操作\"\n                    width=\"120\">\n                    <template slot-scope=\"scope\">\n                        <el-button type=\"primary\" size=\"mini\" @click=\"viewDetails(scope.row)\">查看详情</el-button>\n                    </template>\n                </el-table-column>\n            </el-table>\n        </el-card>\n\n        <!-- 详情对话框 -->\n        <el-dialog\n            title=\"审核商家认证申请\"\n            :visible.sync=\"dialogVisible\"\n            width=\"60%\"\n            @close=\"currentApplication = null\">\n            <div v-if=\"currentApplication\" class=\"detail-content\">\n                <el-descriptions :column=\"2\" border>\n                    <el-descriptions-item label=\"申请人\">{{ currentApplication.user.nickname }}</el-descriptions-item>\n                    <el-descriptions-item label=\"申请时间\">{{ currentApplication.createTime | formatDate }}</el-descriptions-item>\n                    <el-descriptions-item label=\"店铺名称\">{{ currentApplication.shopName }}</el-descriptions-item>\n                    <el-descriptions-item label=\"联系电话\">{{ currentApplication.contactPhone }}</el-descriptions-item>\n                    <el-descriptions-item label=\"联系地址\" :span=\"2\">{{ currentApplication.contactAddress }}</el-descriptions-item>\n                    <el-descriptions-item label=\"申请理由\" :span=\"2\">{{ currentApplication.applicationReason || '无' }}</el-descriptions-item>\n                </el-descriptions>\n\n                <el-divider>认证材料</el-divider>\n\n                <div class=\"image-gallery\">\n                    <div class=\"image-item\">\n                        <p>身份证正面</p>\n                        <el-image :src=\"currentApplication.idCardFront\" :preview-src-list=\"[currentApplication.idCardFront]\"></el-image>\n                    </div>\n                    <div class=\"image-item\">\n                        <p>身份证反面</p>\n                        <el-image :src=\"currentApplication.idCardBack\" :preview-src-list=\"[currentApplication.idCardBack]\"></el-image>\n                    </div>\n                    <div class=\"image-item\" v-if=\"currentApplication.businessLicense\">\n                        <p>营业执照</p>\n                        <el-image :src=\"currentApplication.businessLicense\" :preview-src-list=\"[currentApplication.businessLicense]\"></el-image>\n                    </div>\n                </div>\n\n                <el-divider>审核操作</el-divider>\n                <div class=\"review-actions\">\n                     <el-input\n                        v-model=\"adminComment\"\n                        type=\"textarea\"\n                        :rows=\"3\"\n                        placeholder=\"如果拒绝，请填写拒绝理由...\"\n                        style=\"margin-bottom: 20px;\">\n                    </el-input>\n                    <el-button type=\"success\" icon=\"el-icon-check\" @click=\"review(1)\">批准申请</el-button>\n                    <el-button type=\"danger\" icon=\"el-icon-close\" @click=\"review(2)\">拒绝申请</el-button>\n                </div>\n            </div>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"dialogVisible = false\">关闭</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: \"MerchantApplicationAdmin\",\n    data() {\n        return {\n            loading: false,\n            applications: [],\n            dialogVisible: false,\n            currentApplication: null,\n            adminComment: ''\n        };\n    },\n    created() {\n        this.loadApplications();\n    },\n    methods: {\n        loadApplications() {\n            this.loading = true;\n            this.$api.adminGetAllApplications({ status: 0 }) // 0 表示待审核\n                .then(res => {\n                    if (res.status_code === 1) {\n                        this.applications = res.data;\n                    }\n                    this.loading = false;\n                })\n                .catch(() => {\n                    this.loading = false;\n                    this.$message.error('数据加载失败');\n                });\n        },\n        viewDetails(application) {\n            this.currentApplication = application;\n            this.adminComment = '';\n            this.dialogVisible = true;\n        },\n        async review(status) {\n            if (status === 2 && !this.adminComment) {\n                this.$message.warning('拒绝申请必须填写理由');\n                return;\n            }\n\n            try {\n                const res = await this.$api.adminReviewApplication({\n                    applicationId: this.currentApplication.id,\n                    status: status,\n                    adminComment: this.adminComment\n                });\n\n                if (res.status_code === 1) {\n                    this.$message.success('操作成功');\n                    this.dialogVisible = false;\n                    // 刷新列表（忽略其内部错误）\n                    try {\n                        this.loadApplications();\n                    } catch (e) {\n                        console.error('刷新列表失败', e);\n                    }\n                    // 刷新父组件的角标（如果存在）\n                    try {\n                        if (this.$parent && typeof this.$parent.loadPendingCount === 'function') {\n                            this.$parent.loadPendingCount();\n                        }\n                    } catch (e) {\n                        console.error('刷新待审核数量失败', e);\n                    }\n                } else {\n                    this.$message.error(res.msg || '操作失败');\n                }\n            } catch (e) {\n                console.error('审核请求失败', e);\n                this.$message.error('操作失败');\n            }\n        }\n    },\n    filters: {\n        formatDate(time) {\n            if (!time) return '';\n            let date = new Date(time);\n            return date.toLocaleString();\n        }\n    }\n}\n</script>\n\n<style scoped>\n.merchant-application-admin-container {\n    padding: 20px;\n}\n.detail-content {\n    max-height: 60vh;\n    overflow-y: auto;\n}\n.image-gallery {\n    display: flex;\n    gap: 20px;\n    margin-top: 20px;\n}\n.image-item {\n    text-align: center;\n}\n.image-item p {\n    margin-bottom: 10px;\n    color: #606266;\n}\n.image-item .el-image {\n    width: 200px;\n    height: 120px;\n    border: 1px solid #ebeef5;\n    border-radius: 4px;\n}\n.review-actions {\n    text-align: center;\n    margin-top: 20px;\n}\n</style>\n"]}]}