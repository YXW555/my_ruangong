# 数据库导入 - 正确方法

## 问题分析

从错误信息看：
- ✅ 文件复制成功：`Successfully copied 17.9kB to campus-trading-mysql:/tmp/init.sql`
- ❌ MySQL 无法打开文件：`ERROR at line 1: Failed to open file '/tmp/init.sql', error: 2`
- ❌ 表数量为 0：`table_count: 0`

## 正确的导入方法

### 方法 1：使用管道导入（推荐）

```bash
cd /opt/campus-trading-platform

# 使用管道直接导入（不需要复制到容器内）
cat init.sql | sudo docker compose exec -T mysql mysql -u root -proot123456 second_hand_trading 2>&1
```

### 方法 2：使用标准输入重定向

```bash
cd /opt/campus-trading-platform

# 直接重定向文件
sudo docker compose exec -T mysql mysql -u root -proot123456 second_hand_trading < init.sql 2>&1
```

### 方法 3：在容器内执行（如果上面不行）

```bash
cd /opt/campus-trading-platform

# 1. 复制文件到容器
sudo docker cp init.sql campus-trading-mysql:/tmp/init.sql

# 2. 进入容器执行
sudo docker compose exec mysql bash -c "mysql -u root -proot123456 second_hand_trading < /tmp/init.sql" 2>&1
```

## 完整操作流程

```bash
cd /opt/campus-trading-platform

echo "=== 1. 验证文件存在 ==="
ls -lh init.sql

echo "=== 2. 使用管道导入（推荐方法）==="
cat init.sql | sudo docker compose exec -T mysql mysql -u root -proot123456 second_hand_trading 2>&1

echo "=== 3. 验证表是否创建 ==="
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SHOW TABLES;" 2>&1

echo "=== 4. 统计表数量 ==="
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT COUNT(*) as table_count FROM information_schema.tables WHERE table_schema = 'second_hand_trading';" 2>&1
```

## 如果还是失败

### 检查 SQL 文件内容

```bash
# 检查文件前几行
head -20 init.sql

# 检查文件是否有语法错误
sudo docker compose exec mysql mysql -u root -proot123456 -e "SELECT 1;" 2>&1
```

### 分步执行（找出具体错误）

```bash
# 只执行前 50 行，看是否有错误
head -50 init.sql | sudo docker compose exec -T mysql mysql -u root -proot123456 second_hand_trading 2>&1
```

