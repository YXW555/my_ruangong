{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\order.vue?vue&type=template&id=8b2a0244&scoped=true&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\order.vue","mtime":1767660868723},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\loaders\\templateLoader.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["\n<div>\n    <app-head></app-head>\n    <app-body>\n        <div class=\"order-container\" v-loading=\"isLoading\">\n            <el-card class=\"order-card\" shadow=\"hover\" v-if=\"orderInfo\">\n                <div slot=\"header\" class=\"card-header\">\n                    <h2 class=\"order-title\">\n                        <i class=\"el-icon-shopping-bag-2\"></i> 订单详情\n                    </h2>\n            </div>\n            \n                <!-- 订单信息 -->\n                <div class=\"order-info-section\">\n                    <div class=\"info-row\">\n                        <span class=\"info-label\">订单编号：</span>\n                        <span class=\"info-value\">{{ orderInfo.orderNumber }}</span>\n                        </div>\n                    <div class=\"info-row\">\n                        <span class=\"info-label\">订单状态：</span>\n                        <el-tag :type=\"getStatusType(orderInfo.orderStatus)\" size=\"medium\">\n                            {{ getStatusText(orderInfo.orderStatus) }}\n                    </el-tag>\n                        </div>\n                    <div class=\"info-row\">\n                        <span class=\"info-label\">支付状态：</span>\n                        <el-tag :type=\"orderInfo.paymentStatus === 1 ? 'success' : 'warning'\" size=\"medium\">\n                            {{ orderInfo.paymentStatus === 1 ? '已支付' : '待支付' }}\n                        </el-tag>\n                    </div>\n                    <!-- 资金状态（卖家视角，订单已完成时显示） -->\n                    <div class=\"info-row\" v-if=\"isSeller && orderInfo.orderStatus === 3 && orderInfo.paymentStatus === 1\">\n                        <span class=\"info-label\">资金状态：</span>\n                        <el-tag :type=\"getFundStatusType(orderInfo.fundStatus)\" size=\"medium\">\n                            {{ getFundStatusText(orderInfo.fundStatus) }}\n                        </el-tag>\n                        <span v-if=\"orderInfo.fundStatus === 0 && orderInfo.finishTime\" class=\"fund-hint\">\n                            （预计 {{ getFundReleaseDate(orderInfo.finishTime) }} 释放）\n                        </span>\n                    </div>\n                    <div class=\"info-row\">\n                        <span class=\"info-label\">订单金额：</span>\n                        <span class=\"info-value price\">¥{{ orderInfo.orderPrice }}</span>\n                    </div>\n                    <div class=\"info-row\" v-if=\"orderInfo.createTime\">\n                        <span class=\"info-label\">创建时间：</span>\n                        <span class=\"info-value\">{{ formatTime(orderInfo.createTime) }}</span>\n                    </div>\n                    <div class=\"info-row\" v-if=\"orderInfo.finishTime\">\n                        <span class=\"info-label\">完成时间：</span>\n                        <span class=\"info-value\">{{ formatTime(orderInfo.finishTime) }}</span>\n                </div>\n            </div>\n            \n                <!-- 商品信息 -->\n                <el-divider></el-divider>\n                <div class=\"product-info-section\" v-if=\"orderInfo.idleItem\">\n                    <h3 class=\"section-title\">商品信息</h3>\n                    <div class=\"product-card\">\n                    <el-image\n                            v-if=\"productImage\"\n                            :src=\"productImage\"\n                            fit=\"cover\"\n                            class=\"product-image\">\n                    </el-image>\n                        <div class=\"product-details\">\n                            <h4 class=\"product-name\">{{ orderInfo.idleItem.idleName }}</h4>\n                            <div class=\"product-price-info\">\n                                <span class=\"product-price\">¥{{ orderInfo.idleItem.idlePrice }}</span>\n                        </div>\n                    </div>\n                </div>\n                </div>\n\n                <!-- 卖家信息（买家视角） -->\n                <el-divider></el-divider>\n                <div class=\"seller-info-section\" v-if=\"orderInfo.idleItem && isBuyer\">\n                    <h3 class=\"section-title\">卖家信息</h3>\n                    <div class=\"seller-card\">\n                        <el-avatar \n                            v-if=\"sellerAvatar\"\n                            :src=\"sellerAvatar\" \n                            :size=\"50\"\n                            class=\"seller-avatar\">\n                        </el-avatar>\n                        <el-avatar \n                            v-else\n                            :size=\"50\"\n                            icon=\"el-icon-user-solid\"\n                            class=\"seller-avatar\">\n                        </el-avatar>\n                        <div class=\"seller-details\">\n                            <div class=\"seller-name\">\n                                <span class=\"seller-label\">卖家：</span>\n                                <span class=\"seller-value\">{{ sellerName || '未知卖家' }}</span>\n                            </div>\n                            <div class=\"seller-actions\">\n                    <el-button \n                                    type=\"primary\" \n                                    size=\"small\"\n                                    icon=\"el-icon-chat-line-round\"\n                                    @click=\"goToChat\">\n                                    联系卖家\n                    </el-button>\n                </div>\n                        </div>\n                    </div>\n                    </div>\n\n                <!-- 买家信息（卖家视角） -->\n                <el-divider></el-divider>\n                <div class=\"buyer-info-section\" v-if=\"orderInfo.user && isSeller\">\n                    <h3 class=\"section-title\">买家信息</h3>\n                    <div class=\"buyer-card\">\n                        <el-avatar \n                            v-if=\"buyerAvatar\"\n                            :src=\"buyerAvatar\" \n                            :size=\"50\"\n                            class=\"buyer-avatar\">\n                        </el-avatar>\n                        <el-avatar \n                            v-else\n                            :size=\"50\"\n                            icon=\"el-icon-user-solid\"\n                            class=\"buyer-avatar\">\n                        </el-avatar>\n                        <div class=\"buyer-details\">\n                            <div class=\"buyer-name\">\n                                <span class=\"buyer-label\">买家：</span>\n                                <span class=\"buyer-value\">{{ buyerName || '未知买家' }}</span>\n                            </div>\n                            <div class=\"buyer-actions\">\n                            <el-button\n                                    type=\"primary\"\n                                    size=\"small\"\n                                    icon=\"el-icon-chat-line-round\"\n                                    @click=\"goToChatWithBuyer\">\n                                    联系买家\n                            </el-button>\n                </div>\n                </div>\n                                </div>\n                                </div>\n\n                <!-- 交易地点导航（待发货/待收货时显示） -->\n                <el-divider></el-divider>\n                <div class=\"location-navigation-section\" v-if=\"showLocationNavigation\">\n                    <h3 class=\"section-title\">\n                        <i class=\"el-icon-location-outline\"></i> 交易地点导航\n                    </h3>\n                    <div class=\"location-info-card\">\n                        <div class=\"location-info-item full-width\">\n                            <span class=\"location-label\">卖家地址：</span>\n                            <span class=\"location-value\" v-if=\"sellerLocation\">{{ sellerLocation.formattedAddress || sellerLocation.address }}</span>\n                            <span class=\"location-value text-warning\" v-else>{{ orderInfo.idleItem.idlePlace || '未填写' }}</span>\n                </div>\n                        <div class=\"location-info-item full-width\">\n                            <span class=\"location-label\">买家地址：</span>\n                            <span class=\"location-value\" v-if=\"buyerLocation\">{{ buyerLocation.formattedAddress || buyerLocation.address }}</span>\n                            <span class=\"location-value text-warning\" v-else-if=\"buyerAddressText\">{{ buyerAddressText }}</span>\n                            <span class=\"location-value text-warning\" v-else>未填写或解析失败</span>\n                                </div>\n                        <div class=\"location-info-item\" v-if=\"distanceText\">\n                            <span class=\"location-label\">距离：</span>\n                            <span class=\"location-value\">{{ distanceText }}</span>\n                                </div>\n                        <div class=\"location-info-item\" v-if=\"distanceKm\">\n                            <span class=\"location-label\">建议：</span>\n                            <el-tag :type=\"distanceKm <= 3 ? 'success' : 'warning'\" size=\"small\">\n                                {{ distanceKm <= 3 ? '适合面交' : '建议快递' }}\n                            </el-tag>\n                            </div>\n                                </div>\n                    <el-alert\n                        v-if=\"!sellerLocation || !buyerLocation\"\n                        title=\"地址解析提示\"\n                        type=\"info\"\n                        :closable=\"false\"\n                        show-icon\n                        style=\"margin-bottom: 15px;\">\n                        <div slot=\"default\">\n                            <p style=\"margin: 0; line-height: 1.6; font-size: 13px;\">\n                                <strong>地址格式建议：</strong><br/>\n                                • 完整格式：城市+详细地址，例如：\"北京市清华大学\"、\"上海市复旦大学\"<br/>\n                                • 学校名称：可以直接填写学校名称，例如：\"清华大学\"、\"复旦大学\"<br/>\n                                • 详细地址：包含城市、区县、街道等，例如：\"北京市海淀区清华大学\"<br/>\n                                <span style=\"color: #909399;\">如果地址解析失败，请检查地址是否包含城市信息</span>\n                            </p>\n                                </div>\n                    </el-alert>\n                    <div class=\"map-container\" ref=\"mapContainer\" id=\"order-map-container\"></div>\n                    <div class=\"map-actions\">\n                        <!-- 买家视角：只显示导航到卖家 -->\n                        <el-button \n                            v-if=\"isBuyer\"\n                            type=\"primary\" \n                            size=\"small\"\n                            icon=\"el-icon-location\"\n                            @click=\"navigateToSeller\"\n                            :disabled=\"!sellerLocation && !(orderInfo.idleItem && orderInfo.idleItem.idlePlace)\">\n                            导航到卖家位置\n                        </el-button>\n                        <!-- 卖家视角：只显示导航到买家 -->\n                        <el-button \n                            v-if=\"isSeller\"\n                            type=\"success\" \n                            size=\"small\"\n                            icon=\"el-icon-location\"\n                            @click=\"navigateToBuyer\"\n                            :disabled=\"!buyerLocation && !buyerAddressText\">\n                            导航到买家位置\n                        </el-button>\n                        <el-button \n                            type=\"info\" \n                            size=\"small\"\n                            icon=\"el-icon-refresh\"\n                            @click=\"refreshMap\">\n                            刷新地图\n                        </el-button>\n                            </div>\n                </div>\n\n                <!-- 售后申请信息（卖家视角） -->\n                <el-divider></el-divider>\n                <div class=\"after-sale-section\" v-if=\"isSeller && afterSaleInfo\">\n                    <h3 class=\"section-title\">售后申请</h3>\n                    <el-alert\n                        :title=\"getAfterSaleStatusText(afterSaleInfo.applicationStatus)\"\n                        :type=\"getAfterSaleStatusType(afterSaleInfo.applicationStatus)\"\n                        :closable=\"false\"\n                        show-icon>\n                    </el-alert>\n                    <div class=\"after-sale-details\" style=\"margin-top: 15px;\">\n                        <el-descriptions :column=\"2\" border size=\"small\">\n                            <el-descriptions-item label=\"申请类型\">\n                                <el-tag size=\"small\">{{ getApplicationTypeText(afterSaleInfo.applicationType) }}</el-tag>\n                            </el-descriptions-item>\n                            <el-descriptions-item label=\"退款金额\">\n                                <span style=\"color: #f56c6c; font-weight: bold;\">¥{{ afterSaleInfo.refundAmount }}</span>\n                            </el-descriptions-item>\n                            <el-descriptions-item label=\"问题描述\" :span=\"2\">{{ afterSaleInfo.problemDescription }}</el-descriptions-item>\n                            <el-descriptions-item label=\"申请时间\" :span=\"2\">{{ formatTime(afterSaleInfo.createTime) }}</el-descriptions-item>\n                        </el-descriptions>\n                        \n                        <!-- 证据图片 -->\n                        <div v-if=\"afterSaleInfo.evidenceImages\" style=\"margin-top: 15px;\">\n                            <p style=\"margin-bottom: 10px;\"><strong>买家证据图片：</strong></p>\n                            <div class=\"evidence-images\">\n                                <el-image\n                                    v-for=\"(img, index) in getEvidenceImages(afterSaleInfo.evidenceImages)\"\n                                    :key=\"index\"\n                                    :src=\"img\"\n                                    :preview-src-list=\"getEvidenceImages(afterSaleInfo.evidenceImages)\"\n                                    fit=\"cover\"\n                                    class=\"evidence-image\">\n                                </el-image>\n                </div>\n                            </div>\n                </div>\n                </div>\n\n                <!-- 操作按钮 -->\n                <el-divider></el-divider>\n                <div class=\"action-buttons\">\n                    <!-- 买家操作 -->\n                    <template v-if=\"isBuyer\">\n                    <el-button \n                            v-if=\"orderInfo.orderStatus === 0 && orderInfo.paymentStatus === 0\"\n                        type=\"primary\" \n                            size=\"large\"\n                        icon=\"el-icon-wallet\" \n                            @click=\"goToPay\">\n                            立即支付\n                        </el-button>\n                    <el-button \n                            v-if=\"orderInfo.orderStatus === 2\"\n                        type=\"success\" \n                            size=\"large\"\n                        icon=\"el-icon-check\" \n                            @click=\"confirmReceive\">\n                            确认收货\n                        </el-button>\n                        <el-button \n                            v-if=\"orderInfo.orderStatus === 3\"\n                            type=\"warning\" \n                            size=\"large\"\n                            icon=\"el-icon-warning-outline\" \n                            @click=\"openAfterSaleDialog\">\n                            申请售后\n                        </el-button>\n                    </template>\n                    \n                    <!-- 卖家操作 -->\n                    <template v-if=\"isSeller\">\n                        <el-button \n                            v-if=\"afterSaleInfo && (afterSaleInfo.applicationStatus === 0 || afterSaleInfo.applicationStatus === 1 || afterSaleInfo.applicationStatus === 2)\"\n                            type=\"warning\" \n                            size=\"large\"\n                            icon=\"el-icon-s-check\" \n                            @click=\"openSellerReviewDialog\">\n                            审核售后申请\n                        </el-button>\n                        <el-button \n                            v-if=\"orderInfo.orderStatus === 1 && orderInfo.paymentStatus === 1\"\n                            type=\"warning\" \n                            size=\"large\"\n                            icon=\"el-icon-truck\" \n                            @click=\"confirmShip\">\n                            确认发货\n                        </el-button>\n                    </template>\n                    \n                    <el-button \n                        type=\"default\" \n                        size=\"large\"\n                        icon=\"el-icon-back\"\n                        @click=\"goBack\">\n                        返回\n                        </el-button>\n                    </div>\n            </el-card>\n\n            <!-- 订单不存在 -->\n            <el-card v-else class=\"order-card\" shadow=\"hover\">\n                <div class=\"empty-state\">\n                    <i class=\"el-icon-warning-outline\"></i>\n                    <p>订单不存在或已删除</p>\n                    <el-button type=\"primary\" @click=\"goBack\">返回</el-button>\n                </div>\n            </el-card>\n        </div>\n        <app-foot></app-foot>\n    </app-body>\n\n    <!-- 申请售后弹窗 -->\n            <el-dialog\n        title=\"申请售后\"\n        :visible.sync=\"afterSaleDialogVisible\"\n                width=\"600px\"\n        @close=\"resetAfterSaleForm\">\n        <el-form :model=\"afterSaleForm\" :rules=\"afterSaleRules\" ref=\"afterSaleForm\" label-width=\"100px\">\n            <el-form-item label=\"申请类型\" prop=\"applicationType\">\n                <el-select v-model=\"afterSaleForm.applicationType\" placeholder=\"请选择申请类型\" style=\"width: 100%\">\n                    <el-option label=\"质量问题\" :value=\"1\"></el-option>\n                    <el-option label=\"描述不符\" :value=\"2\"></el-option>\n                    <el-option label=\"未收到货\" :value=\"3\"></el-option>\n                    <el-option label=\"其他\" :value=\"4\"></el-option>\n                </el-select>\n            </el-form-item>\n            <el-form-item label=\"问题描述\" prop=\"problemDescription\">\n                <el-input\n                    type=\"textarea\"\n                    :rows=\"4\"\n                    v-model=\"afterSaleForm.problemDescription\"\n                    placeholder=\"请详细描述遇到的问题...\"\n                    maxlength=\"500\"\n                    show-word-limit>\n                </el-input>\n            </el-form-item>\n            <el-form-item label=\"证据图片\">\n                <el-upload\n                    class=\"evidence-uploader\"\n                    :action=\"'/api/file'\"\n                    :show-file-list=\"true\"\n                    :file-list=\"evidenceFileList\"\n                    :on-success=\"handleEvidenceSuccess\"\n                    :on-remove=\"handleEvidenceRemove\"\n                    :before-upload=\"beforeEvidenceUpload\"\n                    list-type=\"picture\"\n                    accept=\"image/*\"\n                    multiple>\n                    <el-button size=\"small\" type=\"primary\" icon=\"el-icon-upload\">上传图片</el-button>\n                    <div slot=\"tip\" class=\"el-upload__tip\">支持上传多张图片，每张不超过5MB</div>\n                </el-upload>\n            </el-form-item>\n            <el-form-item label=\"退款金额\">\n                <el-input-number\n                    v-model=\"afterSaleForm.refundAmount\"\n                    :precision=\"2\"\n                    :min=\"0\"\n                    :max=\"orderInfo ? orderInfo.orderPrice : 0\"\n                    style=\"width: 100%\">\n                </el-input-number>\n                <div style=\"color: #909399; font-size: 12px; margin-top: 5px;\">\n                    最多可申请退款：¥{{ orderInfo ? orderInfo.orderPrice : 0 }}\n                    </div>\n            </el-form-item>\n        </el-form>\n        <span slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"afterSaleDialogVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"submitAfterSale\" :loading=\"afterSaleSubmitting\">提 交</el-button>\n        </span>\n    </el-dialog>\n\n    <!-- 卖家审核售后申请弹窗 -->\n    <el-dialog\n        title=\"审核售后申请\"\n        :visible.sync=\"sellerReviewDialogVisible\"\n        width=\"600px\"\n        @close=\"resetSellerReviewForm\">\n        <el-form :model=\"sellerReviewForm\" :rules=\"sellerReviewRules\" ref=\"sellerReviewForm\" label-width=\"100px\">\n            <el-form-item label=\"申请类型\">\n                <el-input :value=\"getApplicationTypeText(afterSaleInfo && afterSaleInfo.applicationType)\" disabled></el-input>\n            </el-form-item>\n            <el-form-item label=\"退款金额\">\n                <el-input :value=\"'¥' + (afterSaleInfo && afterSaleInfo.refundAmount)\" disabled></el-input>\n            </el-form-item>\n            <el-form-item label=\"问题描述\">\n                <el-input type=\"textarea\" :value=\"afterSaleInfo && afterSaleInfo.problemDescription\" disabled :rows=\"3\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"审核结果\" prop=\"reviewResult\">\n                <el-radio-group v-model=\"sellerReviewForm.reviewResult\">\n                    <el-radio :label=\"1\">同意申请</el-radio>\n                    <el-radio :label=\"2\">拒绝申请</el-radio>\n                </el-radio-group>\n            </el-form-item>\n            <el-form-item label=\"拒绝原因\" prop=\"rejectReason\" v-if=\"sellerReviewForm.reviewResult === 2\">\n                        <el-input\n                            type=\"textarea\"\n                    :rows=\"4\"\n                    placeholder=\"请填写拒绝原因\"\n                    v-model=\"sellerReviewForm.rejectReason\"\n                            maxlength=\"200\"\n                            show-word-limit>\n                        </el-input>\n            </el-form-item>\n            <el-form-item label=\"卖家举证图片\">\n                <el-upload\n                    :action=\"'/api/file'\"\n                    list-type=\"picture-card\"\n                    :on-success=\"handleSellerEvidenceUploadSuccess\"\n                    :on-remove=\"handleSellerEvidenceUploadRemove\"\n                    :before-upload=\"beforeAfterSaleUpload\"\n                    :file-list=\"sellerEvidenceUploadList\"\n                    :limit=\"3\"\n                    accept=\"image/*\">\n                    <i class=\"el-icon-plus\"></i>\n                </el-upload>\n                <div slot=\"tip\" class=\"el-upload__tip\">最多上传3张图片，每张不超过5MB</div>\n            </el-form-item>\n        </el-form>\n        <span slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"sellerReviewDialogVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"submitSellerReview\" :loading=\"sellerReviewSubmitting\">提 交</el-button>\n        </span>\n            </el-dialog>\n\n    <!-- 空状态提示 -->\n    <el-card v-if=\"!isLoading && !orderInfo\" class=\"order-card\" shadow=\"hover\">\n        <el-empty description=\"订单不存在或加载失败\">\n            <el-button type=\"primary\" @click=\"$router.push('/index')\">返回首页</el-button>\n        </el-empty>\n    </el-card>\n</div>\n",null]}