{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\admin-announcement.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\admin-announcement.vue","mtime":1767612460977},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"D:/Git/my_ruangong/campus-trading-platform/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:/Git/my_ruangong/campus-trading-platform/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { quillEditor } from 'vue-quill-editor';\nimport 'quill/dist/quill.core.css';\nimport 'quill/dist/quill.snow.css';\nimport 'quill/dist/quill.bubble.css';\nexport default {\n  name: 'AdminAnnouncement',\n  data: function data() {\n    return {\n      form: {\n        title: '',\n        content: '',\n        isPinned: 0\n      },\n      submitting: false\n    };\n  },\n  components: {\n    quillEditor: quillEditor\n  },\n  computed: {\n    editorOption: function editorOption() {\n      return {\n        placeholder: '请输入公告内容（支持图片上传）',\n        modules: {\n          toolbar: {\n            container: [['bold', 'italic', 'underline'], [{\n              'header': [1, 2, 3, false]\n            }], [{\n              'list': 'ordered'\n            }, {\n              'list': 'bullet'\n            }], ['link', 'image']],\n            handlers: {\n              image: this.imageHandler\n            }\n          }\n        }\n      };\n    }\n  },\n  methods: {\n    imageHandler: function () {\n      var _imageHandler = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _this = this;\n\n        var input;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // create file input\n                input = document.createElement('input');\n                input.setAttribute('type', 'file');\n                input.setAttribute('accept', 'image/*');\n                input.click();\n                input.onchange = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n                  var file, formData, res, text, parsed, url, quill, range;\n                  return regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          file = input.files[0];\n\n                          if (file) {\n                            _context.next = 3;\n                            break;\n                          }\n\n                          return _context.abrupt(\"return\");\n\n                        case 3:\n                          formData = new FormData();\n                          formData.append('file', file);\n                          _context.prev = 5;\n                          _context.next = 8;\n                          return fetch('/api/file', {\n                            method: 'POST',\n                            body: formData\n                          });\n\n                        case 8:\n                          res = _context.sent;\n                          _context.next = 11;\n                          return res.text();\n\n                        case 11:\n                          text = _context.sent;\n                          parsed = {};\n\n                          try {\n                            parsed = JSON.parse(text);\n                          } catch (_unused) {\n                            parsed = {\n                              status_code: 1,\n                              data: text\n                            };\n                          }\n\n                          url = parsed && parsed.status_code === 1 ? parsed.data : text;\n                          quill = _this.$refs.quillEditor && _this.$refs.quillEditor.quill ? _this.$refs.quillEditor.quill : null;\n\n                          if (quill) {\n                            range = quill.getSelection();\n                            quill.insertEmbed(range ? range.index : 0, 'image', url);\n                          } else {\n                            // fallback append as plain img tag\n                            _this.form.content += \"<img src=\\\"\".concat(url, \"\\\" />\");\n                          }\n\n                          _context.next = 22;\n                          break;\n\n                        case 19:\n                          _context.prev = 19;\n                          _context.t0 = _context[\"catch\"](5);\n\n                          _this.$message.error('图片上传失败');\n\n                        case 22:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee, null, [[5, 19]]);\n                }));\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function imageHandler() {\n        return _imageHandler.apply(this, arguments);\n      }\n\n      return imageHandler;\n    }(),\n    submit: function submit() {\n      var _this2 = this;\n\n      if (!this.form.title || !this.form.content) {\n        this.$message.error('请填写标题和内容');\n        return;\n      }\n\n      this.submitting = true;\n      var payload = {\n        title: this.form.title,\n        content: this.form.content,\n        isPinned: this.form.isPinned ? 1 : 0\n      };\n      var apiCall = this.editId ? this.$api.updateAnnouncement(_objectSpread({\n        id: this.editId\n      }, payload)) : this.$api.addAnnouncement(payload);\n      apiCall.then(function (res) {\n        if (res.status_code === 1) {\n          _this2.$message.success('发布成功');\n\n          _this2.form.title = '';\n          _this2.form.content = '';\n          _this2.form.isPinned = 0;\n\n          _this2.$router.push('/announcements');\n        } else {\n          _this2.$message.error(res.msg || '发布失败');\n        }\n      }).catch(function () {\n        _this2.$message.error('网络错误');\n      }).finally(function () {\n        _this2.submitting = false;\n      });\n    }\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    // if editing (id passed), load existing announcement\n    var id = this.$route.query.id;\n\n    if (id) {\n      this.editId = id;\n      this.$api.getAnnouncement({\n        id: id\n      }).then(function (res) {\n        if (res.status_code === 1 && res.data) {\n          _this3.form.title = res.data.title;\n          _this3.form.content = res.data.content;\n          _this3.form.isPinned = res.data.isPinned === 1 ? 1 : 0;\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["admin-announcement.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"admin-announcement page-card\">\r\n    <h2>发布公告</h2>\r\n    <el-form :model=\"form\" label-width=\"80px\">\r\n      <el-form-item label=\"标题\">\r\n        <el-input v-model=\"form.title\" maxlength=\"128\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"内容\">\r\n        <quill-editor ref=\"quillEditor\" v-model=\"form.content\" :options=\"editorOption\" style=\"height:300px;\"></quill-editor>\r\n      </el-form-item>\r\n      <el-form-item label=\"置顶\">\r\n        <el-switch v-model=\"form.isPinned\"></el-switch>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"submit\" :loading=\"submitting\">发布</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { quillEditor } from 'vue-quill-editor';\r\nimport 'quill/dist/quill.core.css';\r\nimport 'quill/dist/quill.snow.css';\r\nimport 'quill/dist/quill.bubble.css';\r\n\r\nexport default {\r\n  name: 'AdminAnnouncement',\r\n  data() {\r\n    return {\r\n      form: {\r\n        title: '',\r\n        content: '',\r\n        isPinned: 0\r\n      },\r\n      submitting: false\r\n    };\r\n  },\r\n  components: {\r\n    quillEditor\r\n  },\r\n  computed: {\r\n    editorOption() {\r\n      return {\r\n        placeholder: '请输入公告内容（支持图片上传）',\r\n        modules: {\r\n          toolbar: {\r\n            container: [\r\n              ['bold', 'italic', 'underline'],\r\n              [{ 'header': [1, 2, 3, false] }],\r\n              [{ 'list': 'ordered'}, { 'list': 'bullet' }],\r\n              ['link', 'image']\r\n            ],\r\n            handlers: {\r\n              image: this.imageHandler\r\n            }\r\n          }\r\n        }\r\n      };\r\n    }\r\n  },\r\n  methods: {\r\n    async imageHandler() {\r\n      // create file input\r\n      const input = document.createElement('input');\r\n      input.setAttribute('type', 'file');\r\n      input.setAttribute('accept', 'image/*');\r\n      input.click();\r\n      input.onchange = async () => {\r\n        const file = input.files[0];\r\n        if (!file) return;\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        try {\r\n          const res = await fetch('/api/file', {\r\n            method: 'POST',\r\n            body: formData\r\n          });\r\n          const text = await res.text();\r\n          let parsed = {};\r\n          try { parsed = JSON.parse(text); } catch { parsed = { status_code: 1, data: text }; }\r\n          const url = parsed && parsed.status_code === 1 ? parsed.data : text;\r\n          const quill = this.$refs.quillEditor && this.$refs.quillEditor.quill ? this.$refs.quillEditor.quill : null;\r\n          if (quill) {\r\n            const range = quill.getSelection();\r\n            quill.insertEmbed(range ? range.index : 0, 'image', url);\r\n          } else {\r\n            // fallback append as plain img tag\r\n            this.form.content += `<img src=\"${url}\" />`;\r\n          }\r\n        } catch (e) {\r\n          this.$message.error('图片上传失败');\r\n        }\r\n      };\r\n    },\r\n    submit() {\r\n      if (!this.form.title || !this.form.content) {\r\n        this.$message.error('请填写标题和内容');\r\n        return;\r\n      }\r\n      this.submitting = true;\r\n      const payload = {\r\n        title: this.form.title,\r\n        content: this.form.content,\r\n        isPinned: this.form.isPinned ? 1 : 0\r\n      };\r\n      const apiCall = this.editId ? this.$api.updateAnnouncement({ id: this.editId, ...payload }) : this.$api.addAnnouncement(payload);\r\n      apiCall.then(res => {\r\n        if (res.status_code === 1) {\r\n          this.$message.success('发布成功');\r\n          this.form.title = '';\r\n          this.form.content = '';\r\n          this.form.isPinned = 0;\r\n          this.$router.push('/announcements');\r\n        } else {\r\n          this.$message.error(res.msg || '发布失败');\r\n        }\r\n      }).catch(() => {\r\n        this.$message.error('网络错误');\r\n      }).finally(() => {\r\n        this.submitting = false;\r\n      });\r\n    }\r\n  },\r\n  mounted() {\r\n    // if editing (id passed), load existing announcement\r\n    const id = this.$route.query.id;\r\n    if (id) {\r\n      this.editId = id;\r\n      this.$api.getAnnouncement({ id }).then(res => {\r\n        if (res.status_code === 1 && res.data) {\r\n          this.form.title = res.data.title;\r\n          this.form.content = res.data.content;\r\n          this.form.isPinned = res.data.isPinned === 1 ? 1 : 0;\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.admin-announcement {\r\n  max-width: 980px;\r\n  margin: 24px auto;\r\n  background: #ffffff;\r\n  border-radius: 8px;\r\n  padding: 28px;\r\n  box-shadow: 0 6px 18px rgba(24,39,75,0.08);\r\n}\r\n.admin-announcement h2{\r\n  font-size: 24px;\r\n  font-weight: 700;\r\n  color: #2d3a4b;\r\n  margin-bottom: 18px;\r\n}\r\n.admin-announcement .el-form {\r\n  background: transparent;\r\n}\r\n.admin-announcement .el-form-item {\r\n  margin-bottom: 18px;\r\n}\r\n.admin-announcement .el-input__inner {\r\n  background: #fafbfd;\r\n  border-radius: 6px;\r\n  border: 1px solid #e6eef8;\r\n}\r\n.admin-announcement .quill-editor {\r\n  border-radius: 6px;\r\n  overflow: hidden;\r\n  border: 1px solid #e6eef8;\r\n  background: #fafbfd;\r\n}\r\n.admin-announcement .el-switch {\r\n  vertical-align: middle;\r\n}\r\n.admin-announcement .el-button--primary {\r\n  background: linear-gradient(90deg,#409eff,#60aef6);\r\n  border-color: transparent;\r\n  box-shadow: 0 6px 12px rgba(64,158,255,0.12);\r\n}\r\n@media (max-width: 768px) {\r\n  .admin-announcement {\r\n    padding: 16px;\r\n    margin: 12px;\r\n  }\r\n  .admin-announcement h2 {\r\n    font-size: 20px;\r\n  }\r\n}\r\n</style>\r\n\r\n"],"sourceRoot":"src/components/page"}]}