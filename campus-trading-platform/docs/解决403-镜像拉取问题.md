# 解决 403 Forbidden - 镜像拉取问题

## 问题现象

镜像在 Docker Hub 上存在，但拉取时返回 403 Forbidden。

## 可能的原因

1. **需要登录 Docker Hub**（最常见）
   - 即使镜像公开，有时也需要登录才能拉取
   - 或者镜像可能是私有的

2. **网络问题**
   - 使用的镜像源（如 daocloud.io）可能有问题
   - 需要配置使用官方源或登录

3. **镜像权限问题**
   - 镜像可能是私有的，需要认证

## 解决方案

### 方案 1：登录 Docker Hub（推荐）

在服务器上登录 Docker Hub：

```bash
# 登录 Docker Hub
sudo docker login

# 输入用户名：yxw555
# 输入密码：你的 Docker Hub 密码或访问令牌

# 登录成功后，再拉取镜像
cd /opt/campus-trading-platform
sudo docker compose pull
```

### 方案 2：使用访问令牌登录

如果使用密码登录失败，可以使用访问令牌：

1. 在 Docker Hub 上生成访问令牌：
   - 登录 Docker Hub
   - Account Settings → Security → New Access Token

2. 使用令牌登录：
   ```bash
   sudo docker login -u yxw555 -p <你的访问令牌>
   ```

### 方案 3：配置 Docker 镜像源

如果网络问题导致无法拉取，可以配置国内镜像源：

```bash
# 创建或编辑 Docker daemon 配置
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://dockerproxy.com",
    "https://mirror.baidubce.com"
  ]
}
EOF

# 重启 Docker 服务
sudo systemctl daemon-reload
sudo systemctl restart docker

# 然后再拉取
cd /opt/campus-trading-platform
sudo docker compose pull
```

### 方案 4：直接使用官方源（如果镜像源有问题）

如果 daocloud.io 有问题，可以强制使用官方源：

```bash
# 临时使用官方源拉取
sudo docker pull docker.io/yxw555/campus-trading-backend:latest
sudo docker pull docker.io/yxw555/campus-trading-frontend:latest

# 然后启动服务
cd /opt/campus-trading-platform
sudo docker compose up -d
```

## 推荐操作流程

```bash
# 1. 登录 Docker Hub
sudo docker login
# 输入用户名：yxw555
# 输入密码：你的密码

# 2. 验证登录
sudo docker info | grep Username
# 应该显示：Username: yxw555

# 3. 进入项目目录
cd /opt/campus-trading-platform

# 4. 拉取镜像
sudo docker compose pull

# 5. 如果还是 403，尝试直接拉取
sudo docker pull yxw555/campus-trading-backend:latest
sudo docker pull yxw555/campus-trading-frontend:latest

# 6. 启动服务
sudo docker compose up -d

# 7. 查看状态
sudo docker compose ps
```

## 如果登录后还是 403

检查镜像是否是私有的：

1. 访问 Docker Hub：https://hub.docker.com/r/yxw555/campus-trading-backend/settings
2. 检查 "Visibility" 设置
3. 如果是私有的，确保登录的账号有权限

或者检查镜像标签是否存在：

```bash
# 检查 latest 标签是否存在
curl -s https://hub.docker.com/v2/repositories/yxw555/campus-trading-backend/tags/ | grep -o '"name":"latest"'
```

## 快速修复命令

```bash
# 一步到位：登录并拉取
sudo docker login && \
cd /opt/campus-trading-platform && \
sudo docker compose pull && \
sudo docker compose up -d && \
sudo docker compose ps
```

