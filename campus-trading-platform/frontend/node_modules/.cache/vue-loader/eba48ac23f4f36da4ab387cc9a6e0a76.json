{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\alipay-success.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\alipay-success.vue","mtime":1767056636466},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport AppHead from '../common/AppHeader.vue';\r\nimport AppBody from '../common/AppPageBody.vue';\r\nimport AppFoot from '../common/AppFoot.vue';\r\n\r\nexport default {\r\n  name: 'AlipaySuccess',\r\n  components: {\r\n      AppHead,\r\n      AppBody,\r\n      AppFoot\r\n  },\r\n  data() {\r\n      return {\r\n          orderNo: '未知订单',\r\n          price: '0.00',\r\n          orderId: '',\r\n          orderType: '',\r\n          isLoading: true, // 加载状态\r\n          hasError: false, // 错误状态\r\n          countdown: 10, // 自动跳转倒计时\r\n          timer: null // 倒计时定时器\r\n      }\r\n  },\r\n  mounted() {\r\n      this.parseUrlParams();\r\n      this.initCountdown(); // 初始化自动跳转\r\n  },\r\n  beforeDestroy() {\r\n      // 清除定时器\r\n      if (this.timer) clearInterval(this.timer);\r\n  },\r\n  methods: {\r\n      // 解析URL参数（增强健壮性）\r\n      parseUrlParams() {\r\n          try {\r\n              // 优先用路由参数，再用URL查询参数\r\n              const params = { ...this.$route.query, ...this.getUrlQueryParams() };\r\n              console.log('合并后的参数:', params);\r\n\r\n              // 赋值并校验\r\n              this.orderId = params.id || params.orderId || '';\r\n              this.orderNo = params.no || params.orderNumber || '未知订单';\r\n              this.orderType = params.type || 'normal';\r\n\r\n              // 处理价格格式\r\n              const priceNum = parseFloat(params.price || params.amount || 0);\r\n              this.price = isNaN(priceNum) ? '0.00' : priceNum.toFixed(2);\r\n\r\n              // 会员订单激活\r\n              if (this.orderType === 'membership' && this.orderNo !== '未知订单') {\r\n                  this.activateMembership();\r\n              }\r\n\r\n              this.isLoading = false; // 加载完成\r\n          } catch (error) {\r\n              console.error('解析URL参数出错:', error);\r\n              this.isLoading = false;\r\n              this.hasError = true;\r\n              this.$message.error('订单信息解析失败，请返回重试');\r\n          }\r\n      },\r\n      // 单独提取URL查询参数解析（兼容非路由场景）\r\n      getUrlQueryParams() {\r\n          const queryPart = window.location.href.split('?')[1] || '';\r\n          return queryPart.split('&').reduce((acc, item) => {\r\n              if (item.includes('=')) {\r\n                  const [key, value] = item.split('=');\r\n                  acc[key] = decodeURIComponent(value || '');\r\n              }\r\n              return acc;\r\n          }, {});\r\n      },\r\n      // 激活会员（增加错误提示）\r\n      async activateMembership() {\r\n          try {\r\n              const res = await this.$api.activateMembership({ orderNumber: this.orderNo });\r\n              if (res.status_code === 1) {\r\n                  this.$message.success('会员权益已成功开通！');\r\n                  await this.refreshUserInfo(); // 刷新用户信息（异步处理）\r\n              } else {\r\n                  this.$message.warning('会员开通延迟，请稍后查看会员页面');\r\n              }\r\n          } catch (err) {\r\n              console.error('会员激活失败:', err);\r\n              this.$message.warning('会员权益将稍后自动开通，请耐心等待');\r\n          }\r\n      },\r\n      // 刷新用户信息（单独封装）\r\n      async refreshUserInfo() {\r\n          if (!this.$globalData) return;\r\n          try {\r\n              const userRes = await this.$api.getUserInfo();\r\n              if (userRes.status_code === 1) {\r\n                  this.$globalData.userInfo = userRes.data;\r\n              }\r\n          } catch (err) {\r\n              console.error('刷新用户信息失败:', err);\r\n          }\r\n      },\r\n      // 查看订单（优化路由跳转）\r\n      goToOrder() {\r\n          if (!this.orderId) {\r\n              this.$message.error('订单ID不存在，无法查看订单详情');\r\n              return;\r\n          }\r\n          // 优先用路由跳转，兼容hash模式\r\n          this.$router.push({ path: '/order', query: { id: this.orderId } }).catch(err => {\r\n              // 路由跳转失败则用window.location\r\n              window.location.href = `${window.location.origin}/#/order?id=${this.orderId}`;\r\n          });\r\n      },\r\n      // 返回首页\r\n      goToHome() {\r\n          this.$router.push('/').catch(() => {\r\n              window.location.href = `${window.location.origin}/#/`;\r\n          });\r\n      },\r\n      // 查看会员\r\n      goToMembership() {\r\n          this.$router.push('/membership').catch(() => {\r\n              window.location.href = `${window.location.origin}/#/membership`;\r\n          });\r\n      },\r\n      // 自动跳转倒计时\r\n      initCountdown() {\r\n          this.timer = setInterval(() => {\r\n              this.countdown--;\r\n              if (this.countdown <= 0) {\r\n                  clearInterval(this.timer);\r\n                  this.goToHome();\r\n              }\r\n          }, 1000);\r\n      }\r\n  }\r\n}\r\n",{"version":3,"sources":["alipay-success.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0FA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"alipay-success.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\r\n  <div>\r\n      <app-head></app-head>\r\n      <app-body>\r\n          <div class=\"payment-success-container\">\r\n              <!-- 加载状态 -->\r\n              <div v-if=\"isLoading\" class=\"loading-container\">\r\n                  <el-loading-spinner></el-loading-spinner>\r\n                  <p>正在加载订单信息...</p >\r\n              </div>\r\n\r\n              <!-- 错误状态 -->\r\n              <div v-else-if=\"hasError\" class=\"error-card\">\r\n                  <div class=\"error-icon\">\r\n                      <i class=\"el-icon-circle-close\"></i>\r\n                  </div>\r\n                  <h1 class=\"error-title\">订单信息加载失败</h1>\r\n                  <p class=\"error-desc\">请返回重新操作，或联系客服协助处理</p >\r\n                  <el-button type=\"primary\" round @click=\"goToHome\" icon=\"el-icon-s-home\">返回首页</el-button>\r\n              </div>\r\n\r\n              <!-- 成功状态 -->\r\n              <div v-else class=\"success-card\">\r\n                  <div class=\"success-icon\">\r\n                      <i class=\"el-icon-circle-check\"></i>\r\n                  </div>\r\n                  <h1 class=\"success-title\">支付成功</h1>\r\n\r\n                  <!-- 订单信息 -->\r\n                  <div class=\"order-info\">\r\n                      <p class=\"order-number\">订单号: {{ orderNo || '未知订单' }}</p >\r\n                      <p class=\"order-amount\">支付金额: <span class=\"price\">¥{{ price }}</span></p >\r\n                  </div>\r\n\r\n                  <!-- 描述信息 -->\r\n                  <div class=\"success-description\">\r\n                      <p v-if=\"orderType === 'membership'\">\r\n                          会员订单支付成功，<span class=\"highlight\">会员权益已立即生效</span>！\r\n                      </p >\r\n                      <template v-else>\r\n                          <p>您的订单已支付成功，感谢您的购买！</p >\r\n                          <p>卖家将在<span class=\"highlight\">24小时内</span>为您处理订单~</p >\r\n                      </template>\r\n                  </div>\r\n\r\n                  <!-- 操作按钮 -->\r\n                  <div class=\"action-buttons\">\r\n                      <el-button\r\n                              v-if=\"orderType !== 'membership'\"\r\n                              type=\"primary\"\r\n                              round\r\n                              @click=\"goToOrder\"\r\n                              icon=\"el-icon-document\"\r\n                              :disabled=\"!orderId\"\r\n                              class=\"primary-btn\"\r\n                      >\r\n                          查看订单\r\n                      </el-button>\r\n                      <el-button\r\n                              v-if=\"orderType === 'membership'\"\r\n                              type=\"primary\"\r\n                              round\r\n                              @click=\"goToMembership\"\r\n                              icon=\"el-icon-star-on\"\r\n                              class=\"primary-btn\"\r\n                      >\r\n                          查看会员\r\n                      </el-button>\r\n                      <el-button\r\n                              round\r\n                              @click=\"goToHome\"\r\n                              icon=\"el-icon-s-home\"\r\n                              class=\"secondary-btn\"\r\n                      >\r\n                          返回首页\r\n                      </el-button>\r\n                  </div>\r\n\r\n                  <!-- 倒计时提示 -->\r\n                  <div class=\"auto-redirect\" v-if=\"countdown > 0\">\r\n                      <p>将在 <span class=\"countdown-number\">{{ countdown }}</span> 秒后自动返回首页</p >\r\n                  </div>\r\n              </div>\r\n          </div>\r\n          <app-foot></app-foot>\r\n      </app-body>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport AppHead from '../common/AppHeader.vue';\r\nimport AppBody from '../common/AppPageBody.vue';\r\nimport AppFoot from '../common/AppFoot.vue';\r\n\r\nexport default {\r\n  name: 'AlipaySuccess',\r\n  components: {\r\n      AppHead,\r\n      AppBody,\r\n      AppFoot\r\n  },\r\n  data() {\r\n      return {\r\n          orderNo: '未知订单',\r\n          price: '0.00',\r\n          orderId: '',\r\n          orderType: '',\r\n          isLoading: true, // 加载状态\r\n          hasError: false, // 错误状态\r\n          countdown: 10, // 自动跳转倒计时\r\n          timer: null // 倒计时定时器\r\n      }\r\n  },\r\n  mounted() {\r\n      this.parseUrlParams();\r\n      this.initCountdown(); // 初始化自动跳转\r\n  },\r\n  beforeDestroy() {\r\n      // 清除定时器\r\n      if (this.timer) clearInterval(this.timer);\r\n  },\r\n  methods: {\r\n      // 解析URL参数（增强健壮性）\r\n      parseUrlParams() {\r\n          try {\r\n              // 优先用路由参数，再用URL查询参数\r\n              const params = { ...this.$route.query, ...this.getUrlQueryParams() };\r\n              console.log('合并后的参数:', params);\r\n\r\n              // 赋值并校验\r\n              this.orderId = params.id || params.orderId || '';\r\n              this.orderNo = params.no || params.orderNumber || '未知订单';\r\n              this.orderType = params.type || 'normal';\r\n\r\n              // 处理价格格式\r\n              const priceNum = parseFloat(params.price || params.amount || 0);\r\n              this.price = isNaN(priceNum) ? '0.00' : priceNum.toFixed(2);\r\n\r\n              // 会员订单激活\r\n              if (this.orderType === 'membership' && this.orderNo !== '未知订单') {\r\n                  this.activateMembership();\r\n              }\r\n\r\n              this.isLoading = false; // 加载完成\r\n          } catch (error) {\r\n              console.error('解析URL参数出错:', error);\r\n              this.isLoading = false;\r\n              this.hasError = true;\r\n              this.$message.error('订单信息解析失败，请返回重试');\r\n          }\r\n      },\r\n      // 单独提取URL查询参数解析（兼容非路由场景）\r\n      getUrlQueryParams() {\r\n          const queryPart = window.location.href.split('?')[1] || '';\r\n          return queryPart.split('&').reduce((acc, item) => {\r\n              if (item.includes('=')) {\r\n                  const [key, value] = item.split('=');\r\n                  acc[key] = decodeURIComponent(value || '');\r\n              }\r\n              return acc;\r\n          }, {});\r\n      },\r\n      // 激活会员（增加错误提示）\r\n      async activateMembership() {\r\n          try {\r\n              const res = await this.$api.activateMembership({ orderNumber: this.orderNo });\r\n              if (res.status_code === 1) {\r\n                  this.$message.success('会员权益已成功开通！');\r\n                  await this.refreshUserInfo(); // 刷新用户信息（异步处理）\r\n              } else {\r\n                  this.$message.warning('会员开通延迟，请稍后查看会员页面');\r\n              }\r\n          } catch (err) {\r\n              console.error('会员激活失败:', err);\r\n              this.$message.warning('会员权益将稍后自动开通，请耐心等待');\r\n          }\r\n      },\r\n      // 刷新用户信息（单独封装）\r\n      async refreshUserInfo() {\r\n          if (!this.$globalData) return;\r\n          try {\r\n              const userRes = await this.$api.getUserInfo();\r\n              if (userRes.status_code === 1) {\r\n                  this.$globalData.userInfo = userRes.data;\r\n              }\r\n          } catch (err) {\r\n              console.error('刷新用户信息失败:', err);\r\n          }\r\n      },\r\n      // 查看订单（优化路由跳转）\r\n      goToOrder() {\r\n          if (!this.orderId) {\r\n              this.$message.error('订单ID不存在，无法查看订单详情');\r\n              return;\r\n          }\r\n          // 优先用路由跳转，兼容hash模式\r\n          this.$router.push({ path: '/order', query: { id: this.orderId } }).catch(err => {\r\n              // 路由跳转失败则用window.location\r\n              window.location.href = `${window.location.origin}/#/order?id=${this.orderId}`;\r\n          });\r\n      },\r\n      // 返回首页\r\n      goToHome() {\r\n          this.$router.push('/').catch(() => {\r\n              window.location.href = `${window.location.origin}/#/`;\r\n          });\r\n      },\r\n      // 查看会员\r\n      goToMembership() {\r\n          this.$router.push('/membership').catch(() => {\r\n              window.location.href = `${window.location.origin}/#/membership`;\r\n          });\r\n      },\r\n      // 自动跳转倒计时\r\n      initCountdown() {\r\n          this.timer = setInterval(() => {\r\n              this.countdown--;\r\n              if (this.countdown <= 0) {\r\n                  clearInterval(this.timer);\r\n                  this.goToHome();\r\n              }\r\n          }, 1000);\r\n      }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 全局容器 - 浅绿色主调背景 */\r\n.payment-success-container {\r\n  min-height: 85vh;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background: linear-gradient(120deg, #f0f9f2 0%, #e8f5e9 100%);\r\n  padding: 20px;\r\n}\r\n\r\n/* 加载状态样式 */\r\n.loading-container {\r\n  text-align: center;\r\n  color: #4a7c59;\r\n}\r\n.loading-container .el-loading-spinner {\r\n  font-size: 40px;\r\n  margin-bottom: 10px;\r\n  color: #66bb6a;\r\n}\r\n.loading-container p {\r\n  font-size: 16px;\r\n  margin-top: 15px;\r\n}\r\n\r\n/* 错误状态样式 - 搭配浅绿色主调的错误提示 */\r\n.error-card {\r\n  background-color: #ffffff;\r\n  border-radius: 16px;\r\n  box-shadow: 0 8px 24px rgba(102, 187, 106, 0.1);\r\n  padding: 50px 40px;\r\n  text-align: center;\r\n  width: 100%;\r\n  max-width: 500px;\r\n  border: 1px solid #e8f5e9;\r\n}\r\n.error-icon {\r\n  font-size: 80px;\r\n  color: #ef5350;\r\n  margin-bottom: 20px;\r\n  opacity: 0.8;\r\n}\r\n.error-title {\r\n  font-size: 28px;\r\n  color: #2e7d32;\r\n  margin-bottom: 10px;\r\n  font-weight: 600;\r\n}\r\n.error-desc {\r\n  color: #558b2f;\r\n  margin-bottom: 30px;\r\n  font-size: 16px;\r\n  line-height: 1.5;\r\n}\r\n\r\n/* 成功卡片样式 - 浅绿色主调核心样式 */\r\n.success-card {\r\n  background-color: #ffffff;\r\n  border-radius: 16px;\r\n  box-shadow: 0 8px 32px rgba(102, 187, 106, 0.15);\r\n  padding: 50px 40px;\r\n  text-align: center;\r\n  width: 100%;\r\n  max-width: 500px;\r\n  border: 1px solid #dcedc8;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n/* 卡片顶部装饰条 */\r\n.success-card::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 6px;\r\n  background: linear-gradient(90deg, #66bb6a 0%, #81c784 50%, #a5d6a7 100%);\r\n}\r\n.success-icon {\r\n  font-size: 90px;\r\n  color: #66bb6a;\r\n  margin-bottom: 25px;\r\n  animation: bounce 0.8s ease;\r\n  filter: drop-shadow(0 4px 8px rgba(102, 187, 106, 0.2));\r\n}\r\n.success-title {\r\n  font-size: 32px;\r\n  color: #2e7d32;\r\n  margin-bottom: 25px;\r\n  font-weight: 600;\r\n  letter-spacing: 0.5px;\r\n}\r\n.order-info {\r\n  background-color: #f9fcf9;\r\n  padding: 20px;\r\n  border-radius: 12px;\r\n  margin-bottom: 25px;\r\n  border: 1px solid #e8f5e9;\r\n  border-left: 4px solid #66bb6a;\r\n}\r\n.order-number, .order-amount {\r\n  margin: 12px 0;\r\n  color: #2e7d32;\r\n  font-size: 16px;\r\n}\r\n.price {\r\n  color: #2e7d32;\r\n  font-weight: 700;\r\n  font-size: 20px;\r\n}\r\n.success-description {\r\n  color: #4a7c59;\r\n  margin-bottom: 35px;\r\n  line-height: 1.8;\r\n  font-size: 16px;\r\n}\r\n.highlight {\r\n  color: #66bb6a;\r\n  font-weight: 600;\r\n}\r\n.action-buttons {\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 15px;\r\n  margin-bottom: 25px;\r\n  flex-wrap: wrap;\r\n}\r\n/* 主按钮样式 - 浅绿色系 */\r\n.primary-btn {\r\n  background-color: #66bb6a !important;\r\n  border-color: #66bb6a !important;\r\n  color: white !important;\r\n  padding: 12px 30px !important;\r\n  border-radius: 50px !important;\r\n  font-size: 15px !important;\r\n  font-weight: 500 !important;\r\n  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.25) !important;\r\n  transition: all 0.3s ease !important;\r\n}\r\n.primary-btn:hover {\r\n  background-color: #558b2f !important;\r\n  border-color: #558b2f !important;\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 6px 16px rgba(102, 187, 106, 0.3) !important;\r\n}\r\n.primary-btn:disabled {\r\n  background-color: #a5d6a7 !important;\r\n  border-color: #a5d6a7 !important;\r\n  box-shadow: none !important;\r\n  transform: none !important;\r\n}\r\n/* 次要按钮样式 */\r\n.secondary-btn {\r\n  background-color: #ffffff !important;\r\n  border-color: #c8e6c9 !important;\r\n  color: #2e7d32 !important;\r\n  padding: 12px 30px !important;\r\n  border-radius: 50px !important;\r\n  font-size: 15px !important;\r\n  font-weight: 500 !important;\r\n  transition: all 0.3s ease !important;\r\n}\r\n.secondary-btn:hover {\r\n  background-color: #f1f8e9 !important;\r\n  border-color: #a5d6a7 !important;\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(102, 187, 106, 0.15) !important;\r\n}\r\n/* 自动跳转样式 */\r\n.auto-redirect {\r\n  color: #81c784;\r\n  font-size: 14px;\r\n  margin-top: 10px;\r\n}\r\n.countdown-number {\r\n  color: #2e7d32;\r\n  font-weight: 700;\r\n  margin: 0 4px;\r\n  font-size: 15px;\r\n}\r\n\r\n/* 响应式优化 */\r\n@media (max-width: 768px) {\r\n  .success-card, .error-card {\r\n      padding: 35px 25px;\r\n      margin: 10px;\r\n  }\r\n  .success-icon, .error-icon {\r\n      font-size: 70px;\r\n  }\r\n  .success-title, .error-title {\r\n      font-size: 26px;\r\n  }\r\n  .action-buttons {\r\n      flex-direction: column;\r\n      gap: 12px;\r\n  }\r\n  .primary-btn, .secondary-btn {\r\n      width: 100%;\r\n  }\r\n}\r\n\r\n/* 成功图标动画 */\r\n@keyframes bounce {\r\n  0% { transform: scale(0.8); opacity: 0.7; }\r\n  50% { transform: scale(1.1); opacity: 1; }\r\n  100% { transform: scale(1); opacity: 1; }\r\n}\r\n\r\n/* 按钮点击反馈 */\r\n.el-button:focus {\r\n  outline: none !important;\r\n  box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.2) !important;\r\n}\r\n</style>"]}]}