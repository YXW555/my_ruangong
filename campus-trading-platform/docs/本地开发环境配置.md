# 本地开发环境配置

## 问题

修改了 `request.js` 后，本地开发环境无法正常运行，因为：
- 本地开发环境没有 Nginx 代理
- 直接使用 `/api` 路径无法访问后端

## 解决方案

### 已修复

1. **配置了 `vue.config.js` 的代理**
   - 开发环境：`/api` → `http://localhost:8081`
   - 生产环境：`/api` → Nginx 代理到后端

2. **统一使用 `/api` 路径**
   - 开发和生产环境都使用 `/api`
   - 通过 `vue.config.js` 的代理功能在开发环境转发请求

## 使用方法

### 本地开发

1. **启动后端服务**（使用 docker-compose）：
   ```bash
   cd campus-trading-platform
   docker-compose up -d
   ```

2. **启动前端开发服务器**：
   ```bash
   cd campus-trading-platform/frontend
   npm run serve
   ```

3. **访问**：
   - 前端：http://localhost:8080
   - 后端：http://localhost:8081
   - API 请求会自动通过代理转发

### 生产环境

1. **通过 CI/CD 自动部署**
2. **或手动部署**：
   ```bash
   docker-compose -f deploy/docker-compose.prod.yml up -d
   ```

## 配置说明

### vue.config.js

```javascript
devServer: {
    port: 8080,
    proxy: {
        '/api': {
            target: 'http://localhost:8081',  // 后端地址
            changeOrigin: true,
            pathRewrite: {
                '^/api': ''  // 去掉 /api 前缀
            }
        }
    }
}
```

### request.js

```javascript
// 统一使用 /api
const baseURL = process.env.VUE_APP_API_BASE_URL || '/api';
```

## 验证

### 本地开发环境

1. 启动服务后，打开 http://localhost:8080
2. 打开浏览器开发者工具（F12）
3. 查看 Network 标签
4. API 请求应该是：`http://localhost:8080/api/xxx`
5. 应该能正常返回数据

### 生产环境

1. 访问服务器 IP
2. API 请求应该是：`http://服务器IP/api/xxx`
3. 通过 Nginx 代理到后端

## 常见问题

### 问题 1：本地开发时 404

**检查**：
1. 后端服务是否启动：`docker-compose ps`
2. 后端端口是否正确：应该是 8081
3. 代理配置是否正确

### 问题 2：CORS 跨域错误

**解决**：`vue.config.js` 中的 `changeOrigin: true` 已经配置，应该不会有跨域问题。

### 问题 3：代理不生效

**解决**：
1. 重启前端开发服务器
2. 清除浏览器缓存
3. 检查 `vue.config.js` 配置是否正确

