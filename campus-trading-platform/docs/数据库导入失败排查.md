# 数据库导入失败排查

## 问题现象

执行导入命令后，`SHOW TABLES` 没有显示任何表，说明导入失败。

## 立即排查

在服务器上执行：

```bash
cd /opt/campus-trading-platform

# 1. 检查 SQL 文件是否有语法错误
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading < init.sql 2>&1

# 2. 查看 MySQL 错误日志
sudo docker compose logs mysql | tail -50

# 3. 手动测试导入（显示详细错误）
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading -e "source /docker-entrypoint-initdb.d/init.sql" 2>&1

# 或者直接执行 SQL 查看错误
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading < init.sql 2>&1 | grep -i error
```

## 常见原因和解决方案

### 原因 1：SQL 文件路径问题

**检查**：
```bash
# 检查文件是否在容器内
sudo docker compose exec mysql ls -la /docker-entrypoint-initdb.d/

# 如果文件不在容器内，需要复制进去
sudo docker cp init.sql campus-trading-mysql:/tmp/init.sql
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading < /tmp/init.sql
```

### 原因 2：SQL 语法错误

**检查**：
```bash
# 验证 SQL 语法
sudo docker compose exec mysql mysql -u root -proot123456 -e "source /tmp/init.sql" 2>&1
```

### 原因 3：数据库不存在

**检查**：
```bash
# 确认数据库存在
sudo docker compose exec mysql mysql -u root -proot123456 -e "SHOW DATABASES;"
```

### 原因 4：权限问题

**检查**：
```bash
# 使用 root 用户导入
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading < init.sql
```

## 完整排查和修复流程

```bash
cd /opt/campus-trading-platform

# 1. 检查文件是否存在且正确
file init.sql
head -5 init.sql

# 2. 检查数据库是否存在
sudo docker compose exec mysql mysql -u root -proot123456 -e "SHOW DATABASES;"

# 3. 如果数据库不存在，创建它
sudo docker compose exec mysql mysql -u root -proot123456 -e "CREATE DATABASE IF NOT EXISTS second_hand_trading;"

# 4. 复制文件到容器内
sudo docker cp init.sql campus-trading-mysql:/tmp/init.sql

# 5. 在容器内执行导入（显示详细输出）
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading -e "source /tmp/init.sql" 2>&1

# 6. 验证表是否创建
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SHOW TABLES;"
```

## 如果还是失败

查看详细的错误信息：

```bash
# 方法 1：直接执行并显示所有输出
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading < init.sql 2>&1

# 方法 2：进入 MySQL 容器手动执行
sudo docker compose exec mysql bash
mysql -u root -proot123456 second_hand_trading < /tmp/init.sql
# 查看错误信息
exit
```

