{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\DisputeManagement.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\DisputeManagement.vue","mtime":1767338000399},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n    name: 'DisputeManagement',\r\n    data() {\r\n        return {\r\n            disputes: [],\r\n            afterSales: [],\r\n            allItems: [], // 合并后的列表\r\n            loading: false,\r\n            currentPage: 1,\r\n            pageSize: 8,\r\n            total: 0,\r\n            filterStatus: null, // null=全部, 0=待处理, 2=已解决\r\n            filterType: null, // null=全部, 'dispute'=交易纠纷, 'afterSale'=售后申请\r\n            dialogVisible: false,\r\n            currentItem: null, // 当前查看的项目（可能是纠纷或售后）\r\n            handleForm: {\r\n                handleResult: 1,\r\n                handleDescription: ''\r\n            }\r\n        }\r\n    },\r\n    created() {\r\n        this.loadAllData();\r\n    },\r\n    filters: {\r\n        formatDate(dateStr) {\r\n            if (!dateStr) return '';\r\n            const date = new Date(dateStr);\r\n            return date.toLocaleString('zh-CN', {\r\n                year: 'numeric',\r\n                month: '2-digit',\r\n                day: '2-digit',\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n            });\r\n        }\r\n    },\r\n    methods: {\r\n        loadAllData() {\r\n            this.loading = true;\r\n            // 同时加载交易纠纷和售后申请\r\n            Promise.all([\r\n                this.loadDisputes(),\r\n                this.loadAfterSales()\r\n            ]).then(() => {\r\n                this.mergeItems();\r\n            }).finally(() => {\r\n                this.loading = false;\r\n            });\r\n        },\r\n        loadDisputes() {\r\n            return this.$api.adminGetDisputeList({\r\n                status: this.filterStatus,\r\n                page: this.currentPage,\r\n                nums: this.pageSize\r\n            }).then(res => {\r\n                console.log('加载纠纷列表响应:', res);\r\n                if (res.status_code === 1) {\r\n                    this.disputes = (res.data.list || []).map(item => {\r\n                        item.type = 'dispute';\r\n                        return item;\r\n                    });\r\n                    console.log('纠纷列表:', this.disputes);\r\n                } else {\r\n                    console.warn('加载纠纷列表失败:', res.msg);\r\n                    this.disputes = [];\r\n                }\r\n            }).catch(err => {\r\n                console.error('加载纠纷列表失败', err);\r\n                this.disputes = [];\r\n            });\r\n        },\r\n        loadAfterSales() {\r\n            return this.$api.getAdminPendingAfterSales({}).then(res => {\r\n                console.log('加载售后申请响应:', res);\r\n                if (res.status_code === 1) {\r\n                    this.afterSales = (res.data || []).map(item => {\r\n                        item.type = 'afterSale';\r\n                        return item;\r\n                    });\r\n                    console.log('售后申请列表:', this.afterSales);\r\n                } else {\r\n                    console.warn('加载售后申请失败:', res.msg);\r\n                    this.afterSales = [];\r\n                }\r\n            }).catch(err => {\r\n                console.error('加载售后申请失败', err);\r\n                this.afterSales = [];\r\n            });\r\n        },\r\n        mergeItems() {\r\n            let items = [];\r\n            \r\n            console.log('合并数据 - 纠纷数量:', this.disputes.length, '售后数量:', this.afterSales.length);\r\n            console.log('当前筛选条件 - 类型:', this.filterType, '状态:', this.filterStatus);\r\n            \r\n            // 添加交易纠纷\r\n            if (!this.filterType || this.filterType === 'dispute') {\r\n                items = items.concat(this.disputes);\r\n            }\r\n            \r\n            // 添加售后申请\r\n            if (!this.filterType || this.filterType === 'afterSale') {\r\n                items = items.concat(this.afterSales);\r\n            }\r\n            \r\n            console.log('合并后数量（筛选前）:', items.length);\r\n            \r\n            // 按状态筛选\r\n            if (this.filterStatus !== null) {\r\n                if (this.filterStatus === 0) {\r\n                    // 待处理：纠纷状态为0，售后状态为3或4\r\n                    items = items.filter(item => {\r\n                        if (item.type === 'dispute') {\r\n                            return item.disputeStatus === 0;\r\n                        } else {\r\n                            return item.applicationStatus === 3 || item.applicationStatus === 4;\r\n                        }\r\n                    });\r\n                } else if (this.filterStatus === 2) {\r\n                    // 已解决：纠纷状态为2，售后状态为5或6\r\n                    items = items.filter(item => {\r\n                        if (item.type === 'dispute') {\r\n                            return item.disputeStatus === 2;\r\n                        } else {\r\n                            return item.applicationStatus === 5 || item.applicationStatus === 6;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            \r\n            console.log('筛选后数量:', items.length);\r\n            \r\n            // 按时间排序\r\n            items.sort((a, b) => {\r\n                if (!a.createTime || !b.createTime) return 0;\r\n                return new Date(b.createTime) - new Date(a.createTime);\r\n            });\r\n            \r\n            this.allItems = items;\r\n            this.total = items.length;\r\n            \r\n            console.log('最终列表数量:', this.allItems.length);\r\n        },\r\n        handleStatusChange() {\r\n            this.currentPage = 1;\r\n            this.mergeItems();\r\n        },\r\n        handleTypeChange() {\r\n            this.currentPage = 1;\r\n            this.mergeItems();\r\n        },\r\n        handlePageChange(page) {\r\n            this.currentPage = page;\r\n            this.loadAllData();\r\n        },\r\n        viewDetails(item) {\r\n            // 如果是售后申请，需要获取完整详情（包含订单、买家、卖家信息）\r\n            if (item.type === 'afterSale') {\r\n                this.loading = true;\r\n                this.$api.getAdminAfterSaleDetail({ id: item.id }).then(res => {\r\n                    if (res.status_code === 1 && res.data) {\r\n                        res.data.type = 'afterSale';\r\n                        this.currentItem = res.data;\r\n                        this.handleForm.handleResult = 1;\r\n                        this.handleForm.handleDescription = '';\r\n                        this.dialogVisible = true;\r\n                    } else {\r\n                        this.$message.error('获取售后申请详情失败');\r\n                    }\r\n                }).catch(err => {\r\n                    console.error('获取售后申请详情失败', err);\r\n                    this.$message.error('获取售后申请详情失败');\r\n                }).finally(() => {\r\n                    this.loading = false;\r\n                });\r\n            } else {\r\n                // 交易纠纷直接使用列表数据\r\n                this.currentItem = item;\r\n                this.handleForm.handleResult = 1;\r\n                this.handleForm.handleDescription = '';\r\n                this.dialogVisible = true;\r\n            }\r\n        },\r\n        canHandle(item) {\r\n            if (item.type === 'dispute') {\r\n                return item.disputeStatus === 0;\r\n            } else {\r\n                return item.applicationStatus === 3 || item.applicationStatus === 4;\r\n            }\r\n        },\r\n        getItemStatusText(item) {\r\n            if (item.type === 'afterSale') {\r\n                const statuses = {\r\n                    0: '待卖家审核',\r\n                    1: '卖家已同意',\r\n                    2: '卖家已拒绝',\r\n                    3: '待管理员审核（卖家同意）',\r\n                    4: '待管理员审核（卖家拒绝）',\r\n                    5: '管理员已同意退款',\r\n                    6: '管理员已驳回'\r\n                };\r\n                return statuses[item.applicationStatus] || '未知状态';\r\n            } else {\r\n                return this.getStatusText(item.disputeStatus);\r\n            }\r\n        },\r\n        getItemStatusType(item) {\r\n            if (item.type === 'afterSale') {\r\n                if (item.applicationStatus === 3 || item.applicationStatus === 4) return 'warning';\r\n                if (item.applicationStatus === 5) return 'success';\r\n                if (item.applicationStatus === 6) return 'danger';\r\n                return 'info';\r\n            } else {\r\n                return this.getStatusType(item.disputeStatus);\r\n            }\r\n        },\r\n        getApplicationTypeText(type) {\r\n            const types = {\r\n                1: '质量问题',\r\n                2: '描述不符',\r\n                3: '未收到货',\r\n                4: '其他'\r\n            };\r\n            return types[type] || '未知';\r\n        },\r\n        getDialogTitle() {\r\n            if (!this.currentItem) return '详情';\r\n            if (this.currentItem.type === 'afterSale') {\r\n                return this.canHandle(this.currentItem) ? '处理售后申请' : '查看售后申请详情';\r\n            } else {\r\n                return this.currentItem.disputeStatus === 0 ? '处理交易纠纷' : '查看纠纷详情';\r\n            }\r\n        },\r\n        submitHandle() {\r\n            if (!this.handleForm.handleResult) {\r\n                this.$message.warning('请选择处理结果');\r\n                return;\r\n            }\r\n            \r\n            this.$confirm('确认提交处理结果？', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.$api.adminHandleDispute({\r\n                    id: this.currentItem.id,\r\n                    handleResult: this.handleForm.handleResult,\r\n                    handleDescription: this.handleForm.handleDescription\r\n                }).then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.$message.success('处理成功');\r\n                        this.dialogVisible = false;\r\n                        this.loadAllData();\r\n                    } else {\r\n                        this.$message.error(res.msg || '处理失败');\r\n                    }\r\n                }).catch(err => {\r\n                    console.error('处理纠纷失败', err);\r\n                    this.$message.error('处理失败');\r\n                });\r\n            }).catch(() => {});\r\n        },\r\n        submitAfterSaleHandle() {\r\n            if (!this.handleForm.handleResult) {\r\n                this.$message.warning('请选择处理结果');\r\n                return;\r\n            }\r\n            \r\n            if (this.handleForm.handleResult === 2 && !this.handleForm.handleDescription) {\r\n                this.$message.warning('驳回申请时必须填写驳回原因');\r\n                return;\r\n            }\r\n            \r\n            this.$confirm('确认提交处理结果？', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.$api.adminReviewAfterSale({\r\n                    id: this.currentItem.id,\r\n                    reviewResult: this.handleForm.handleResult,\r\n                    reason: this.handleForm.handleDescription\r\n                }).then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.$message.success('处理成功');\r\n                        this.dialogVisible = false;\r\n                        this.loadAllData();\r\n                    } else {\r\n                        this.$message.error(res.msg || '处理失败');\r\n                    }\r\n                }).catch(err => {\r\n                    console.error('处理售后申请失败', err);\r\n                    this.$message.error('处理失败');\r\n                });\r\n            }).catch(() => {});\r\n        },\r\n        getDisputeTypeText(type) {\r\n            const types = {\r\n                1: '商品描述不符',\r\n                2: '商品质量问题',\r\n                3: '未收到货',\r\n                4: '退款问题',\r\n                5: '其他'\r\n            };\r\n            return types[type] || '未知';\r\n        },\r\n        getStatusText(status) {\r\n            const statuses = {\r\n                0: '待处理',\r\n                1: '处理中',\r\n                2: '已解决',\r\n                3: '已关闭'\r\n            };\r\n            return statuses[status] || '未知';\r\n        },\r\n        getStatusType(status) {\r\n            const types = {\r\n                0: 'warning',\r\n                1: 'info',\r\n                2: 'success',\r\n                3: 'info'\r\n            };\r\n            return types[status] || '';\r\n        },\r\n        getHandleResultText(result) {\r\n            const results = {\r\n                1: '退款给买家',\r\n                2: '驳回申请',\r\n                3: '要求退货退款',\r\n                4: '警告用户',\r\n                5: '其他'\r\n            };\r\n            return results[result] || '未知';\r\n        },\r\n        getOrderStatusText(status) {\r\n            const statuses = {\r\n                0: '待确认',\r\n                1: '已确认',\r\n                2: '已发货',\r\n                3: '已完成',\r\n                4: '已取消'\r\n            };\r\n            return statuses[status] || '未知';\r\n        },\r\n        getEvidenceImages(imagesStr) {\r\n            if (!imagesStr) return [];\r\n            try {\r\n                return JSON.parse(imagesStr);\r\n            } catch (e) {\r\n                return [];\r\n            }\r\n        }\r\n    }\r\n}\r\n",{"version":3,"sources":["DisputeManagement.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DisputeManagement.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\r\n    <div class=\"dispute-management-container\">\r\n        <el-card shadow=\"never\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>交易纠纷与售后管理</span>\r\n                <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"loadAllData\">刷新</el-button>\r\n            </div>\r\n\r\n            <!-- 筛选条件 -->\r\n            <div class=\"filter-container\">\r\n                <el-radio-group v-model=\"filterStatus\" @change=\"handleStatusChange\" size=\"small\">\r\n                    <el-radio-button :label=\"null\">全部</el-radio-button>\r\n                    <el-radio-button :label=\"0\">待处理</el-radio-button>\r\n                    <el-radio-button :label=\"2\">已解决</el-radio-button>\r\n                </el-radio-group>\r\n                <el-radio-group v-model=\"filterType\" @change=\"handleTypeChange\" size=\"small\" style=\"margin-left: 20px;\">\r\n                    <el-radio-button :label=\"null\">全部类型</el-radio-button>\r\n                    <el-radio-button :label=\"'dispute'\">交易纠纷</el-radio-button>\r\n                    <el-radio-button :label=\"'afterSale'\">售后申请</el-radio-button>\r\n                </el-radio-group>\r\n            </div>\r\n\r\n            <!-- 空状态提示 -->\r\n            <div v-if=\"!loading && allItems.length === 0\" style=\"text-align: center; padding: 40px;\">\r\n                <el-empty description=\"暂无数据\">\r\n                    <el-button type=\"primary\" @click=\"loadAllData\">刷新</el-button>\r\n                </el-empty>\r\n            </div>\r\n\r\n            <!-- 纠纷和售后列表 -->\r\n            <el-table\r\n                v-else\r\n                :data=\"allItems\"\r\n                v-loading=\"loading\"\r\n                style=\"width: 100%\"\r\n                :header-cell-style=\"{ background: '#f5f7fa', color: '#303133', fontWeight: 'bold' }\"\r\n                border>\r\n                <el-table-column\r\n                    label=\"类型\"\r\n                    width=\"100\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-tag :type=\"scope.row.type === 'afterSale' ? 'warning' : 'primary'\" size=\"small\">\r\n                            {{ scope.row.type === 'afterSale' ? '售后申请' : '交易纠纷' }}\r\n                        </el-tag>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    prop=\"id\"\r\n                    label=\"ID\"\r\n                    width=\"80\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"订单号\"\r\n                    width=\"180\"\r\n                    show-overflow-tooltip>\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.order && scope.row.order.orderNumber }}\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"商品名称\"\r\n                    show-overflow-tooltip>\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.order && scope.row.order.idleItem && scope.row.order.idleItem.idleName }}\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"申请人\"\r\n                    width=\"120\">\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.type === 'afterSale' ? (scope.row.buyer && scope.row.buyer.nickname) : (scope.row.applicant && scope.row.applicant.nickname) }}\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"申请类型/纠纷类型\"\r\n                    width=\"140\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-tag size=\"small\" v-if=\"scope.row.type === 'afterSale'\">\r\n                            {{ getApplicationTypeText(scope.row.applicationType) }}\r\n                        </el-tag>\r\n                        <el-tag size=\"small\" v-else>\r\n                            {{ getDisputeTypeText(scope.row.disputeType) }}\r\n                        </el-tag>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"原因/描述\"\r\n                    show-overflow-tooltip\r\n                    min-width=\"200\">\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.type === 'afterSale' ? scope.row.problemDescription : scope.row.disputeReason }}\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"状态\"\r\n                    width=\"140\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-tag :type=\"getItemStatusType(scope.row)\" size=\"small\">\r\n                            {{ getItemStatusText(scope.row) }}\r\n                        </el-tag>\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    prop=\"createTime\"\r\n                    label=\"申请时间\"\r\n                    width=\"180\">\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.createTime | formatDate }}\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"操作\"\r\n                    width=\"120\"\r\n                    align=\"center\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button\r\n                            v-if=\"canHandle(scope.row)\"\r\n                            type=\"primary\"\r\n                            size=\"mini\"\r\n                            @click=\"viewDetails(scope.row)\">\r\n                            处理\r\n                        </el-button>\r\n                        <el-button\r\n                            v-else\r\n                            type=\"info\"\r\n                            size=\"mini\"\r\n                            @click=\"viewDetails(scope.row)\">\r\n                            查看\r\n                        </el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n\r\n            <!-- 分页 -->\r\n            <div class=\"pagination-container\">\r\n                <el-pagination\r\n                    @current-change=\"handlePageChange\"\r\n                    :current-page=\"currentPage\"\r\n                    :page-size=\"pageSize\"\r\n                    layout=\"total, prev, pager, next, jumper\"\r\n                    :total=\"total\">\r\n                </el-pagination>\r\n            </div>\r\n        </el-card>\r\n\r\n        <!-- 处理对话框 -->\r\n        <el-dialog\r\n            :title=\"getDialogTitle()\"\r\n            :visible.sync=\"dialogVisible\"\r\n            width=\"70%\"\r\n            @close=\"currentItem = null\">\r\n            <div v-if=\"currentItem\" class=\"item-detail\">\r\n                <!-- 售后申请详情 -->\r\n                <template v-if=\"currentItem.type === 'afterSale'\">\r\n                    <!-- 订单信息 -->\r\n                    <el-card shadow=\"never\" class=\"detail-section\">\r\n                        <div slot=\"header\">\r\n                            <span>订单信息</span>\r\n                        </div>\r\n                        <el-descriptions :column=\"2\" border>\r\n                            <el-descriptions-item label=\"订单号\">{{ currentItem.order && currentItem.order.orderNumber }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"订单金额\">¥{{ currentItem.order && currentItem.order.orderPrice }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"商品名称\">{{ currentItem.order && currentItem.order.idleItem && currentItem.order.idleItem.idleName }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"订单状态\">\r\n                                <el-tag size=\"small\">{{ getOrderStatusText(currentItem.order && currentItem.order.orderStatus) }}</el-tag>\r\n                            </el-descriptions-item>\r\n                            <el-descriptions-item label=\"支付状态\">\r\n                                <el-tag :type=\"currentItem.order && currentItem.order.paymentStatus ? 'success' : 'warning'\" size=\"small\">\r\n                                    {{ currentItem.order && currentItem.order.paymentStatus ? '已支付' : '未支付' }}\r\n                                </el-tag>\r\n                            </el-descriptions-item>\r\n                            <el-descriptions-item label=\"创建时间\">{{ currentItem.order && currentItem.order.createTime | formatDate }}</el-descriptions-item>\r\n                        </el-descriptions>\r\n                    </el-card>\r\n\r\n                    <!-- 售后申请信息 -->\r\n                    <el-card shadow=\"never\" class=\"detail-section\">\r\n                        <div slot=\"header\">\r\n                            <span>售后申请信息</span>\r\n                        </div>\r\n                        <el-descriptions :column=\"2\" border>\r\n                            <el-descriptions-item label=\"买家\">{{ currentItem.buyer && currentItem.buyer.nickname }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"卖家\">{{ currentItem.seller && currentItem.seller.nickname }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"申请类型\">\r\n                                <el-tag size=\"small\">{{ getApplicationTypeText(currentItem.applicationType) }}</el-tag>\r\n                            </el-descriptions-item>\r\n                            <el-descriptions-item label=\"申请状态\">\r\n                                <el-tag :type=\"getItemStatusType(currentItem)\" size=\"small\">\r\n                                    {{ getItemStatusText(currentItem) }}\r\n                                </el-tag>\r\n                            </el-descriptions-item>\r\n                            <el-descriptions-item label=\"退款金额\">\r\n                                <span style=\"color: #f56c6c; font-weight: bold;\">¥{{ currentItem.refundAmount }}</span>\r\n                            </el-descriptions-item>\r\n                            <el-descriptions-item label=\"申请时间\">{{ currentItem.createTime | formatDate }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"问题描述\" :span=\"2\">{{ currentItem.problemDescription }}</el-descriptions-item>\r\n                        </el-descriptions>\r\n\r\n                        <!-- 买家证据图片 -->\r\n                        <div v-if=\"currentItem.evidenceImages\" class=\"evidence-images\">\r\n                            <el-divider>买家证据图片</el-divider>\r\n                            <div class=\"image-list\">\r\n                                <el-image\r\n                                    v-for=\"(img, index) in getEvidenceImages(currentItem.evidenceImages)\"\r\n                                    :key=\"index\"\r\n                                    :src=\"img\"\r\n                                    :preview-src-list=\"getEvidenceImages(currentItem.evidenceImages)\"\r\n                                    fit=\"cover\"\r\n                                    class=\"evidence-image\">\r\n                                </el-image>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- 卖家审核信息 -->\r\n                        <div v-if=\"currentItem.sellerReviewTime\" style=\"margin-top: 20px;\">\r\n                            <el-divider>卖家审核信息</el-divider>\r\n                            <p><strong>审核结果：</strong>\r\n                                <el-tag :type=\"currentItem.sellerReviewResult === 1 ? 'success' : 'danger'\" size=\"small\">\r\n                                    {{ currentItem.sellerReviewResult === 1 ? '同意' : '拒绝' }}\r\n                                </el-tag>\r\n                            </p>\r\n                            <p v-if=\"currentItem.sellerRejectReason\"><strong>拒绝原因：</strong>{{ currentItem.sellerRejectReason }}</p>\r\n                            <p><strong>审核时间：</strong>{{ currentItem.sellerReviewTime | formatDate }}</p>\r\n                            <div v-if=\"currentItem.sellerEvidenceImages\" class=\"evidence-images\">\r\n                                <p><strong>卖家举证图片：</strong></p>\r\n                                <div class=\"image-list\">\r\n                                    <el-image\r\n                                        v-for=\"(img, index) in getEvidenceImages(currentItem.sellerEvidenceImages)\"\r\n                                        :key=\"index\"\r\n                                        :src=\"img\"\r\n                                        :preview-src-list=\"getEvidenceImages(currentItem.sellerEvidenceImages)\"\r\n                                        fit=\"cover\"\r\n                                        class=\"evidence-image\">\r\n                                    </el-image>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </el-card>\r\n\r\n                    <!-- 处理操作（待处理时显示） -->\r\n                    <el-card v-if=\"canHandle(currentItem)\" shadow=\"never\" class=\"detail-section\">\r\n                        <div slot=\"header\">\r\n                            <span>处理操作</span>\r\n                        </div>\r\n                        <el-form :model=\"handleForm\" label-width=\"120px\">\r\n                            <el-form-item label=\"处理结果\" required>\r\n                                <el-radio-group v-model=\"handleForm.handleResult\">\r\n                                    <el-radio :label=\"1\">同意退款</el-radio>\r\n                                    <el-radio :label=\"2\">驳回申请</el-radio>\r\n                                </el-radio-group>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"处理说明\" v-if=\"handleForm.handleResult === 2\" required>\r\n                                <el-input\r\n                                    type=\"textarea\"\r\n                                    :rows=\"4\"\r\n                                    v-model=\"handleForm.handleDescription\"\r\n                                    placeholder=\"请填写驳回原因\">\r\n                                </el-input>\r\n                            </el-form-item>\r\n                            <el-form-item>\r\n                                <el-button type=\"primary\" @click=\"submitAfterSaleHandle\">提交处理</el-button>\r\n                                <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n                            </el-form-item>\r\n                        </el-form>\r\n                    </el-card>\r\n\r\n                    <!-- 处理结果（已处理时显示） -->\r\n                    <el-card v-if=\"!canHandle(currentItem) && (currentItem.applicationStatus === 5 || currentItem.applicationStatus === 6)\" shadow=\"never\" class=\"detail-section\">\r\n                        <div slot=\"header\">\r\n                            <span>处理结果</span>\r\n                        </div>\r\n                        <el-descriptions :column=\"2\" border>\r\n                            <el-descriptions-item label=\"处理结果\">\r\n                                <el-tag :type=\"currentItem.applicationStatus === 5 ? 'success' : 'danger'\" size=\"small\">\r\n                                    {{ currentItem.applicationStatus === 5 ? '已同意退款' : '已驳回' }}\r\n                                </el-tag>\r\n                            </el-descriptions-item>\r\n                            <el-descriptions-item label=\"处理时间\">{{ currentItem.updateTime | formatDate }}</el-descriptions-item>\r\n                            <el-descriptions-item label=\"处理说明\" :span=\"2\">{{ currentItem.sellerRejectReason || '无' }}</el-descriptions-item>\r\n                        </el-descriptions>\r\n                    </el-card>\r\n                </template>\r\n\r\n                <!-- 交易纠纷详情 -->\r\n                <template v-else>\r\n                <!-- 订单信息 -->\r\n                <el-card shadow=\"never\" class=\"detail-section\">\r\n                    <div slot=\"header\">\r\n                        <span>订单信息</span>\r\n                    </div>\r\n                    <el-descriptions :column=\"2\" border>\r\n                        <el-descriptions-item label=\"订单号\">{{ currentItem.order && currentItem.order.orderNumber }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"订单金额\">¥{{ currentItem.order && currentItem.order.orderPrice }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"商品名称\">{{ currentItem.order && currentItem.order.idleItem && currentItem.order.idleItem.idleName }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"订单状态\">\r\n                            <el-tag size=\"small\">{{ getOrderStatusText(currentItem.order && currentItem.order.orderStatus) }}</el-tag>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"支付状态\">\r\n                            <el-tag :type=\"currentItem.order && currentItem.order.paymentStatus ? 'success' : 'warning'\" size=\"small\">\r\n                                {{ currentItem.order && currentItem.order.paymentStatus ? '已支付' : '未支付' }}\r\n                            </el-tag>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"创建时间\">{{ currentItem.order && currentItem.order.createTime | formatDate }}</el-descriptions-item>\r\n                    </el-descriptions>\r\n                </el-card>\r\n\r\n                <!-- 纠纷信息 -->\r\n                <el-card shadow=\"never\" class=\"detail-section\">\r\n                    <div slot=\"header\">\r\n                        <span>纠纷信息</span>\r\n                    </div>\r\n                    <el-descriptions :column=\"2\" border>\r\n                        <el-descriptions-item label=\"申请人\">{{ currentItem.applicant && currentItem.applicant.nickname }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"申请时间\">{{ currentItem.createTime | formatDate }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"纠纷类型\">\r\n                            <el-tag size=\"small\">{{ getDisputeTypeText(currentItem.disputeType) }}</el-tag>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"纠纷状态\">\r\n                            <el-tag :type=\"getStatusType(currentItem.disputeStatus)\" size=\"small\">\r\n                                {{ getStatusText(currentItem.disputeStatus) }}\r\n                            </el-tag>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"纠纷原因\" :span=\"2\">{{ currentItem.disputeReason }}</el-descriptions-item>\r\n                    </el-descriptions>\r\n\r\n                    <!-- 证据图片 -->\r\n                    <div v-if=\"currentItem.evidenceImages\" class=\"evidence-images\">\r\n                        <el-divider>证据图片</el-divider>\r\n                        <div class=\"image-list\">\r\n                            <el-image\r\n                                v-for=\"(img, index) in getEvidenceImages(currentItem.evidenceImages)\"\r\n                                :key=\"index\"\r\n                                :src=\"img\"\r\n                                :preview-src-list=\"getEvidenceImages(currentItem.evidenceImages)\"\r\n                                fit=\"cover\"\r\n                                class=\"evidence-image\">\r\n                            </el-image>\r\n                        </div>\r\n                    </div>\r\n                </el-card>\r\n\r\n                <!-- 处理结果（已处理时显示） -->\r\n                <el-card v-if=\"currentItem.disputeStatus === 2\" shadow=\"never\" class=\"detail-section\">\r\n                    <div slot=\"header\">\r\n                        <span>处理结果</span>\r\n                    </div>\r\n                    <el-descriptions :column=\"2\" border>\r\n                        <el-descriptions-item label=\"处理结果\">\r\n                            <el-tag type=\"success\" size=\"small\">{{ getHandleResultText(currentItem.handleResult) }}</el-tag>\r\n                        </el-descriptions-item>\r\n                        <el-descriptions-item label=\"处理时间\">{{ currentItem.handleTime | formatDate }}</el-descriptions-item>\r\n                        <el-descriptions-item label=\"处理说明\" :span=\"2\">{{ currentItem.handleDescription || '无' }}</el-descriptions-item>\r\n                    </el-descriptions>\r\n                </el-card>\r\n\r\n                <!-- 处理操作（待处理时显示） -->\r\n                <el-card v-if=\"currentItem.disputeStatus === 0\" shadow=\"never\" class=\"detail-section\">\r\n                    <div slot=\"header\">\r\n                        <span>处理操作</span>\r\n                    </div>\r\n                    <el-form :model=\"handleForm\" label-width=\"120px\">\r\n                        <el-form-item label=\"处理结果\" required>\r\n                            <el-radio-group v-model=\"handleForm.handleResult\">\r\n                                <el-radio :label=\"1\">退款给买家</el-radio>\r\n                                <el-radio :label=\"2\">驳回申请</el-radio>\r\n                                <el-radio :label=\"3\">要求退货退款</el-radio>\r\n                                <el-radio :label=\"4\">警告用户</el-radio>\r\n                                <el-radio :label=\"5\">其他</el-radio>\r\n                            </el-radio-group>\r\n                        </el-form-item>\r\n                        <el-form-item label=\"处理说明\">\r\n                            <el-input\r\n                                type=\"textarea\"\r\n                                :rows=\"4\"\r\n                                v-model=\"handleForm.handleDescription\"\r\n                                placeholder=\"请输入处理说明\">\r\n                            </el-input>\r\n                        </el-form-item>\r\n                        <el-form-item>\r\n                            <el-button type=\"primary\" @click=\"submitHandle\">提交处理</el-button>\r\n                            <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n                        </el-form-item>\r\n                    </el-form>\r\n                </el-card>\r\n                </template>\r\n            </div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: 'DisputeManagement',\r\n    data() {\r\n        return {\r\n            disputes: [],\r\n            afterSales: [],\r\n            allItems: [], // 合并后的列表\r\n            loading: false,\r\n            currentPage: 1,\r\n            pageSize: 8,\r\n            total: 0,\r\n            filterStatus: null, // null=全部, 0=待处理, 2=已解决\r\n            filterType: null, // null=全部, 'dispute'=交易纠纷, 'afterSale'=售后申请\r\n            dialogVisible: false,\r\n            currentItem: null, // 当前查看的项目（可能是纠纷或售后）\r\n            handleForm: {\r\n                handleResult: 1,\r\n                handleDescription: ''\r\n            }\r\n        }\r\n    },\r\n    created() {\r\n        this.loadAllData();\r\n    },\r\n    filters: {\r\n        formatDate(dateStr) {\r\n            if (!dateStr) return '';\r\n            const date = new Date(dateStr);\r\n            return date.toLocaleString('zh-CN', {\r\n                year: 'numeric',\r\n                month: '2-digit',\r\n                day: '2-digit',\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n            });\r\n        }\r\n    },\r\n    methods: {\r\n        loadAllData() {\r\n            this.loading = true;\r\n            // 同时加载交易纠纷和售后申请\r\n            Promise.all([\r\n                this.loadDisputes(),\r\n                this.loadAfterSales()\r\n            ]).then(() => {\r\n                this.mergeItems();\r\n            }).finally(() => {\r\n                this.loading = false;\r\n            });\r\n        },\r\n        loadDisputes() {\r\n            return this.$api.adminGetDisputeList({\r\n                status: this.filterStatus,\r\n                page: this.currentPage,\r\n                nums: this.pageSize\r\n            }).then(res => {\r\n                console.log('加载纠纷列表响应:', res);\r\n                if (res.status_code === 1) {\r\n                    this.disputes = (res.data.list || []).map(item => {\r\n                        item.type = 'dispute';\r\n                        return item;\r\n                    });\r\n                    console.log('纠纷列表:', this.disputes);\r\n                } else {\r\n                    console.warn('加载纠纷列表失败:', res.msg);\r\n                    this.disputes = [];\r\n                }\r\n            }).catch(err => {\r\n                console.error('加载纠纷列表失败', err);\r\n                this.disputes = [];\r\n            });\r\n        },\r\n        loadAfterSales() {\r\n            return this.$api.getAdminPendingAfterSales({}).then(res => {\r\n                console.log('加载售后申请响应:', res);\r\n                if (res.status_code === 1) {\r\n                    this.afterSales = (res.data || []).map(item => {\r\n                        item.type = 'afterSale';\r\n                        return item;\r\n                    });\r\n                    console.log('售后申请列表:', this.afterSales);\r\n                } else {\r\n                    console.warn('加载售后申请失败:', res.msg);\r\n                    this.afterSales = [];\r\n                }\r\n            }).catch(err => {\r\n                console.error('加载售后申请失败', err);\r\n                this.afterSales = [];\r\n            });\r\n        },\r\n        mergeItems() {\r\n            let items = [];\r\n            \r\n            console.log('合并数据 - 纠纷数量:', this.disputes.length, '售后数量:', this.afterSales.length);\r\n            console.log('当前筛选条件 - 类型:', this.filterType, '状态:', this.filterStatus);\r\n            \r\n            // 添加交易纠纷\r\n            if (!this.filterType || this.filterType === 'dispute') {\r\n                items = items.concat(this.disputes);\r\n            }\r\n            \r\n            // 添加售后申请\r\n            if (!this.filterType || this.filterType === 'afterSale') {\r\n                items = items.concat(this.afterSales);\r\n            }\r\n            \r\n            console.log('合并后数量（筛选前）:', items.length);\r\n            \r\n            // 按状态筛选\r\n            if (this.filterStatus !== null) {\r\n                if (this.filterStatus === 0) {\r\n                    // 待处理：纠纷状态为0，售后状态为3或4\r\n                    items = items.filter(item => {\r\n                        if (item.type === 'dispute') {\r\n                            return item.disputeStatus === 0;\r\n                        } else {\r\n                            return item.applicationStatus === 3 || item.applicationStatus === 4;\r\n                        }\r\n                    });\r\n                } else if (this.filterStatus === 2) {\r\n                    // 已解决：纠纷状态为2，售后状态为5或6\r\n                    items = items.filter(item => {\r\n                        if (item.type === 'dispute') {\r\n                            return item.disputeStatus === 2;\r\n                        } else {\r\n                            return item.applicationStatus === 5 || item.applicationStatus === 6;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            \r\n            console.log('筛选后数量:', items.length);\r\n            \r\n            // 按时间排序\r\n            items.sort((a, b) => {\r\n                if (!a.createTime || !b.createTime) return 0;\r\n                return new Date(b.createTime) - new Date(a.createTime);\r\n            });\r\n            \r\n            this.allItems = items;\r\n            this.total = items.length;\r\n            \r\n            console.log('最终列表数量:', this.allItems.length);\r\n        },\r\n        handleStatusChange() {\r\n            this.currentPage = 1;\r\n            this.mergeItems();\r\n        },\r\n        handleTypeChange() {\r\n            this.currentPage = 1;\r\n            this.mergeItems();\r\n        },\r\n        handlePageChange(page) {\r\n            this.currentPage = page;\r\n            this.loadAllData();\r\n        },\r\n        viewDetails(item) {\r\n            // 如果是售后申请，需要获取完整详情（包含订单、买家、卖家信息）\r\n            if (item.type === 'afterSale') {\r\n                this.loading = true;\r\n                this.$api.getAdminAfterSaleDetail({ id: item.id }).then(res => {\r\n                    if (res.status_code === 1 && res.data) {\r\n                        res.data.type = 'afterSale';\r\n                        this.currentItem = res.data;\r\n                        this.handleForm.handleResult = 1;\r\n                        this.handleForm.handleDescription = '';\r\n                        this.dialogVisible = true;\r\n                    } else {\r\n                        this.$message.error('获取售后申请详情失败');\r\n                    }\r\n                }).catch(err => {\r\n                    console.error('获取售后申请详情失败', err);\r\n                    this.$message.error('获取售后申请详情失败');\r\n                }).finally(() => {\r\n                    this.loading = false;\r\n                });\r\n            } else {\r\n                // 交易纠纷直接使用列表数据\r\n                this.currentItem = item;\r\n                this.handleForm.handleResult = 1;\r\n                this.handleForm.handleDescription = '';\r\n                this.dialogVisible = true;\r\n            }\r\n        },\r\n        canHandle(item) {\r\n            if (item.type === 'dispute') {\r\n                return item.disputeStatus === 0;\r\n            } else {\r\n                return item.applicationStatus === 3 || item.applicationStatus === 4;\r\n            }\r\n        },\r\n        getItemStatusText(item) {\r\n            if (item.type === 'afterSale') {\r\n                const statuses = {\r\n                    0: '待卖家审核',\r\n                    1: '卖家已同意',\r\n                    2: '卖家已拒绝',\r\n                    3: '待管理员审核（卖家同意）',\r\n                    4: '待管理员审核（卖家拒绝）',\r\n                    5: '管理员已同意退款',\r\n                    6: '管理员已驳回'\r\n                };\r\n                return statuses[item.applicationStatus] || '未知状态';\r\n            } else {\r\n                return this.getStatusText(item.disputeStatus);\r\n            }\r\n        },\r\n        getItemStatusType(item) {\r\n            if (item.type === 'afterSale') {\r\n                if (item.applicationStatus === 3 || item.applicationStatus === 4) return 'warning';\r\n                if (item.applicationStatus === 5) return 'success';\r\n                if (item.applicationStatus === 6) return 'danger';\r\n                return 'info';\r\n            } else {\r\n                return this.getStatusType(item.disputeStatus);\r\n            }\r\n        },\r\n        getApplicationTypeText(type) {\r\n            const types = {\r\n                1: '质量问题',\r\n                2: '描述不符',\r\n                3: '未收到货',\r\n                4: '其他'\r\n            };\r\n            return types[type] || '未知';\r\n        },\r\n        getDialogTitle() {\r\n            if (!this.currentItem) return '详情';\r\n            if (this.currentItem.type === 'afterSale') {\r\n                return this.canHandle(this.currentItem) ? '处理售后申请' : '查看售后申请详情';\r\n            } else {\r\n                return this.currentItem.disputeStatus === 0 ? '处理交易纠纷' : '查看纠纷详情';\r\n            }\r\n        },\r\n        submitHandle() {\r\n            if (!this.handleForm.handleResult) {\r\n                this.$message.warning('请选择处理结果');\r\n                return;\r\n            }\r\n            \r\n            this.$confirm('确认提交处理结果？', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.$api.adminHandleDispute({\r\n                    id: this.currentItem.id,\r\n                    handleResult: this.handleForm.handleResult,\r\n                    handleDescription: this.handleForm.handleDescription\r\n                }).then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.$message.success('处理成功');\r\n                        this.dialogVisible = false;\r\n                        this.loadAllData();\r\n                    } else {\r\n                        this.$message.error(res.msg || '处理失败');\r\n                    }\r\n                }).catch(err => {\r\n                    console.error('处理纠纷失败', err);\r\n                    this.$message.error('处理失败');\r\n                });\r\n            }).catch(() => {});\r\n        },\r\n        submitAfterSaleHandle() {\r\n            if (!this.handleForm.handleResult) {\r\n                this.$message.warning('请选择处理结果');\r\n                return;\r\n            }\r\n            \r\n            if (this.handleForm.handleResult === 2 && !this.handleForm.handleDescription) {\r\n                this.$message.warning('驳回申请时必须填写驳回原因');\r\n                return;\r\n            }\r\n            \r\n            this.$confirm('确认提交处理结果？', '提示', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning'\r\n            }).then(() => {\r\n                this.$api.adminReviewAfterSale({\r\n                    id: this.currentItem.id,\r\n                    reviewResult: this.handleForm.handleResult,\r\n                    reason: this.handleForm.handleDescription\r\n                }).then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.$message.success('处理成功');\r\n                        this.dialogVisible = false;\r\n                        this.loadAllData();\r\n                    } else {\r\n                        this.$message.error(res.msg || '处理失败');\r\n                    }\r\n                }).catch(err => {\r\n                    console.error('处理售后申请失败', err);\r\n                    this.$message.error('处理失败');\r\n                });\r\n            }).catch(() => {});\r\n        },\r\n        getDisputeTypeText(type) {\r\n            const types = {\r\n                1: '商品描述不符',\r\n                2: '商品质量问题',\r\n                3: '未收到货',\r\n                4: '退款问题',\r\n                5: '其他'\r\n            };\r\n            return types[type] || '未知';\r\n        },\r\n        getStatusText(status) {\r\n            const statuses = {\r\n                0: '待处理',\r\n                1: '处理中',\r\n                2: '已解决',\r\n                3: '已关闭'\r\n            };\r\n            return statuses[status] || '未知';\r\n        },\r\n        getStatusType(status) {\r\n            const types = {\r\n                0: 'warning',\r\n                1: 'info',\r\n                2: 'success',\r\n                3: 'info'\r\n            };\r\n            return types[status] || '';\r\n        },\r\n        getHandleResultText(result) {\r\n            const results = {\r\n                1: '退款给买家',\r\n                2: '驳回申请',\r\n                3: '要求退货退款',\r\n                4: '警告用户',\r\n                5: '其他'\r\n            };\r\n            return results[result] || '未知';\r\n        },\r\n        getOrderStatusText(status) {\r\n            const statuses = {\r\n                0: '待确认',\r\n                1: '已确认',\r\n                2: '已发货',\r\n                3: '已完成',\r\n                4: '已取消'\r\n            };\r\n            return statuses[status] || '未知';\r\n        },\r\n        getEvidenceImages(imagesStr) {\r\n            if (!imagesStr) return [];\r\n            try {\r\n                return JSON.parse(imagesStr);\r\n            } catch (e) {\r\n                return [];\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.dispute-management-container {\r\n    padding: 20px;\r\n}\r\n\r\n.filter-container {\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.pagination-container {\r\n    margin-top: 20px;\r\n    text-align: right;\r\n}\r\n\r\n.detail-section {\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.evidence-images {\r\n    margin-top: 20px;\r\n}\r\n\r\n.image-list {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 10px;\r\n}\r\n\r\n.evidence-image {\r\n    width: 150px;\r\n    height: 150px;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n}\r\n</style>\r\n\r\n"]}]}