{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\idle-details.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\idle-details.vue","mtime":1767677959135},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:/Git/my_ruangong/campus-trading-platform/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport AppHead from \"../common/AppHeader.vue\";\nimport AppBody from \"../common/AppPageBody.vue\";\nimport AppFoot from \"../common/AppFoot.vue\";\nexport default {\n  name: \"idle-details\",\n  components: {\n    AppHead: AppHead,\n    AppBody: AppBody,\n    AppFoot: AppFoot\n  },\n  data: function data() {\n    return {\n      messageContent: '',\n      toUser: null,\n      toMessage: null,\n      isReply: false,\n      replyData: {\n        toUserNickname: '',\n        toMessage: ''\n      },\n      messageList: [],\n      idleItemInfo: {\n        id: '',\n        idleName: '',\n        idleDetails: '',\n        pictureList: [],\n        idlePrice: 0,\n        idlePlace: '',\n        idleLabel: '',\n        idleStatus: -1,\n        userId: '',\n        user: {\n          avatar: '',\n          nickname: '',\n          signInTime: ''\n        }\n      },\n      isMaster: false,\n      isFavorite: true,\n      favoriteId: 0,\n      sellerRatingStats: null,\n      // 卖家信誉评分统计 {averageRating, ratingCount}\n      categories: {\n        '1': '数码科技',\n        '2': '生活用品',\n        '3': '运动相关',\n        '4': '图书笔记',\n        '5': '公告'\n      },\n      membershipStatus: null,\n      // 会员状态\n      // 购买地址选择相关\n      addressDialogVisible: false,\n      addressList: [],\n      selectedAddressId: null,\n      pendingBuyItem: null // 待购买的商品信息\n\n    };\n  },\n  computed: {\n    canPin: function canPin() {\n      // 检查用户是否是会员且可以置顶\n      return this.membershipStatus && this.membershipStatus.isValid && this.membershipStatus.canPin;\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    // 加载会员状态\n    this.loadMembershipStatus();\n    var id = this.$route.query.id;\n    this.$api.getIdleItem({\n      id: id\n    }).then(function (res) {\n      console.log(res);\n\n      if (res.data) {\n        var list = res.data.idleDetails.split(/\\r?\\n/);\n        var str = '';\n\n        for (var i = 0; i < list.length; i++) {\n          str += '<p>' + list[i] + '</p>';\n        }\n\n        res.data.idleDetails = str;\n        res.data.pictureList = JSON.parse(res.data.pictureList);\n        _this.idleItemInfo = res.data;\n        console.log(_this.idleItemInfo);\n\n        var userId = _this.getCookie('shUserId');\n\n        console.log('userid', userId);\n\n        if (userId == _this.idleItemInfo.userId) {\n          console.log('isMaster');\n          _this.isMaster = true;\n        }\n\n        _this.checkFavorite();\n\n        _this.getAllIdleMessage(); // 加载卖家信誉评分\n\n\n        _this.loadSellerRating();\n      }\n\n      $('html,body').animate({\n        scrollTop: 0\n      }, {\n        duration: 500,\n        easing: \"swing\"\n      });\n    });\n  },\n  methods: {\n    getCategoryName: function getCategoryName(label) {\n      return this.categories[label] || '其他';\n    },\n    getTagType: function getTagType(label) {\n      var types = {\n        '1': 'primary',\n        '2': 'success',\n        '3': 'warning',\n        '4': 'info',\n        '5': 'danger'\n      };\n      return types[label] || 'info';\n    },\n    getAllIdleMessage: function getAllIdleMessage() {\n      var _this2 = this;\n\n      this.$api.getAllIdleMessage({\n        idleId: this.idleItemInfo.id\n      }).then(function (res) {\n        console.log('getAllIdleMessage', res.data);\n\n        if (res.status_code === 1) {\n          _this2.messageList = res.data;\n        }\n      }).catch(function () {});\n    },\n    checkFavorite: function checkFavorite() {\n      var _this3 = this;\n\n      this.$api.checkFavorite({\n        idleId: this.idleItemInfo.id\n      }).then(function (res) {\n        if (!res.data) {\n          _this3.isFavorite = false;\n        } else {\n          _this3.favoriteId = res.data;\n        }\n      });\n    },\n    getCookie: function getCookie(cname) {\n      var name = cname + \"=\";\n      var ca = document.cookie.split(';');\n\n      for (var i = 0; i < ca.length; i++) {\n        var c = ca[i].trim();\n        if (c.indexOf(name) === 0) return c.substring(name.length, c.length);\n      }\n\n      return \"\";\n    },\n    startChat: function startChat() {\n      var userId = this.getCookie('shUserId');\n\n      if (!userId) {\n        this.$message.error(\"请先登录后再发起私聊\");\n        this.$router.push('/login');\n        return;\n      }\n\n      if (userId == this.idleItemInfo.userId) {\n        this.$message.info(\"这是您自己发布的闲置哦\");\n        return;\n      }\n\n      this.$router.push({\n        path: '/chat',\n        query: {\n          targetUserId: this.idleItemInfo.userId,\n          idleId: this.idleItemInfo.id\n        }\n      });\n    },\n    replyMessage: function replyMessage(index) {\n      $('html,body').animate({\n        scrollTop: $(\"#replyMessageLocation\").offset().top - 100\n      }, {\n        duration: 500,\n        easing: \"swing\"\n      });\n      this.isReply = true;\n      this.replyData.toUserNickname = this.messageList[index].fromU.nickname;\n      this.replyData.toMessage = this.messageList[index].content.substring(0, 10) + (this.messageList[index].content.length > 10 ? '...' : '');\n      this.toUser = this.messageList[index].userId;\n      this.toMessage = this.messageList[index].id;\n    },\n    changeStatus: function changeStatus(idle, status) {\n      var _this4 = this;\n\n      this.$api.updateIdleItem({\n        id: idle.id,\n        idleStatus: status\n      }).then(function (res) {\n        console.log(res);\n\n        if (res.status_code === 1) {\n          _this4.idleItemInfo.idleStatus = status;\n\n          _this4.$message({\n            message: status === 1 ? '商品已重新上架' : '商品已下架',\n            type: 'success'\n          });\n        } else {\n          _this4.$message.error(res.msg);\n        }\n      });\n    },\n    buyButton: function buyButton(idleItemInfo) {\n      // 检查是否登录\n      var userId = this.getCookie('shUserId');\n\n      if (!userId) {\n        this.$message.warning('请先登录后再购买');\n        this.$router.push('/login');\n        return;\n      } // 保存待购买的商品信息\n\n\n      this.pendingBuyItem = idleItemInfo; // 加载收货地址列表\n\n      this.loadAddressList();\n    },\n    // 加载收货地址列表\n    loadAddressList: function () {\n      var _loadAddressList = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _this5 = this;\n\n        var addressRes, defaultAddress;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return this.$api.getAddress();\n\n              case 3:\n                addressRes = _context.sent;\n\n                if (addressRes.status_code === 1 && addressRes.data) {\n                  this.addressList = addressRes.data;\n\n                  if (this.addressList.length > 0) {\n                    // 自动选择默认地址\n                    defaultAddress = this.addressList.find(function (addr) {\n                      return addr.defaultFlag;\n                    });\n                    this.selectedAddressId = defaultAddress ? defaultAddress.id : this.addressList[0].id; // 显示地址选择对话框\n\n                    this.addressDialogVisible = true;\n                  } else {\n                    // 没有收货地址，提示用户先添加\n                    this.$confirm('您还没有收货地址，请先添加收货地址', '提示', {\n                      confirmButtonText: '去添加',\n                      cancelButtonText: '取消',\n                      type: 'warning'\n                    }).then(function () {\n                      _this5.goToAddAddress();\n                    }).catch(function () {});\n                  }\n                } else {\n                  this.$message.error('加载地址列表失败');\n                }\n\n                _context.next = 11;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                console.error('加载地址列表异常:', _context.t0);\n                this.$message.error('网络错误，请稍后重试');\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 7]]);\n      }));\n\n      function loadAddressList() {\n        return _loadAddressList.apply(this, arguments);\n      }\n\n      return loadAddressList;\n    }(),\n    // 确认购买（使用选中的地址）\n    confirmBuyWithAddress: function () {\n      var _confirmBuyWithAddress = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _this6 = this;\n\n        var selectedAddress, orderRes, addressRes;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.selectedAddressId) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                this.$message.warning('请选择收货地址');\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                selectedAddress = this.addressList.find(function (addr) {\n                  return addr.id === _this6.selectedAddressId;\n                });\n\n                if (selectedAddress) {\n                  _context2.next = 7;\n                  break;\n                }\n\n                this.$message.error('地址信息错误');\n                return _context2.abrupt(\"return\");\n\n              case 7:\n                if (this.pendingBuyItem) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                this.$message.error('商品信息错误');\n                return _context2.abrupt(\"return\");\n\n              case 10:\n                _context2.prev = 10;\n                _context2.next = 13;\n                return this.$api.addOrder({\n                  idleId: this.pendingBuyItem.id,\n                  orderPrice: this.pendingBuyItem.idlePrice\n                });\n\n              case 13:\n                orderRes = _context2.sent;\n\n                if (!(orderRes.status_code === 1 && orderRes.data && orderRes.data.id)) {\n                  _context2.next = 26;\n                  break;\n                }\n\n                // 创建订单地址\n                console.log('准备创建订单地址，订单ID:', orderRes.data.id, '地址信息:', selectedAddress);\n                _context2.next = 18;\n                return this.$api.addOrderAddress({\n                  orderId: orderRes.data.id,\n                  consigneeName: selectedAddress.consigneeName,\n                  consigneePhone: selectedAddress.consigneePhone,\n                  detailAddress: selectedAddress.detailAddress\n                });\n\n              case 18:\n                addressRes = _context2.sent;\n                console.log('订单地址创建结果:', addressRes);\n\n                if (addressRes.status_code !== 1) {\n                  console.error('订单地址创建失败:', addressRes);\n                  this.$message.warning('订单创建成功，但地址保存失败，请在订单详情页补充地址信息');\n                } // 关闭对话框\n\n\n                this.addressDialogVisible = false;\n                this.pendingBuyItem = null; // 请求单订单碳减排估算并弹窗提示（弱提示）\n\n                this.$api.getOrderCarbon({\n                  orderId: orderRes.data.id\n                }).then(function (carRes) {\n                  if (carRes.status_code === 1 && carRes.data) {\n                    var kg = carRes.data.carbonKg || carRes.data.carbonKg === 0 ? carRes.data.carbonKg : null;\n                    var kwh = carRes.data.equivalentKwh || carRes.data.equivalentKwh === 0 ? carRes.data.equivalentKwh : null;\n\n                    if (kg !== null) {\n                      _this6.$message({\n                        message: \"\\u4EA4\\u6613\\u6210\\u529F\\uFF01\\u672C\\u6B21\\u4EA4\\u6613\\u51CF\\u5C11\\u78B3\\u6392\\u653E\\u7EA6 \".concat(kg, \" kg\\uFF08\\u7EA6 \").concat(kwh, \" kWh\\uFF09\"),\n                        type: 'success'\n                      });\n                    } else {\n                      _this6.$message.success('订单创建成功！');\n                    }\n                  } else {\n                    _this6.$message.success('订单创建成功！');\n                  }\n                }).catch(function () {\n                  _this6.$message.success('订单创建成功！');\n                }).finally(function () {\n                  console.log('订单创建成功，跳转到订单页面，订单ID:', orderRes.data.id);\n\n                  _this6.$router.push({\n                    path: '/order',\n                    query: {\n                      id: orderRes.data.id\n                    }\n                  }).catch(function (err) {\n                    console.error('路由跳转失败:', err);\n\n                    _this6.$message.error('跳转失败，请刷新页面重试');\n                  });\n                });\n                _context2.next = 28;\n                break;\n\n              case 26:\n                console.error('订单创建失败:', orderRes);\n                this.$message.error(orderRes.msg || '订单创建失败，请稍后重试');\n\n              case 28:\n                _context2.next = 34;\n                break;\n\n              case 30:\n                _context2.prev = 30;\n                _context2.t0 = _context2[\"catch\"](10);\n                console.error('创建订单异常:', _context2.t0);\n                this.$message.error('网络错误，请稍后重试');\n\n              case 34:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[10, 30]]);\n      }));\n\n      function confirmBuyWithAddress() {\n        return _confirmBuyWithAddress.apply(this, arguments);\n      }\n\n      return confirmBuyWithAddress;\n    }(),\n    // 跳转到添加地址页面\n    goToAddAddress: function goToAddAddress() {\n      this.addressDialogVisible = false;\n      this.$router.push({\n        path: '/me',\n        query: {\n          tab: 'address'\n        }\n      });\n    },\n    loadMembershipStatus: function loadMembershipStatus() {\n      var _this7 = this;\n\n      this.$api.getMembershipStatus().then(function (res) {\n        if (res.status_code === 1) {\n          _this7.membershipStatus = res.data;\n        }\n      }).catch(function () {// 静默失败\n      });\n    },\n    handlePinItem: function handlePinItem() {\n      var _this8 = this;\n\n      if (!this.canPin) {\n        this.$message.warning('您还不是会员，无法使用置顶功能！');\n        this.$router.push('/membership');\n        return;\n      }\n\n      if (this.idleItemInfo.isPinned) {\n        // 取消置顶：调用后端 unpin 接口\n        this.$confirm('确认取消置顶吗？', '取消置顶', {\n          confirmButtonText: '确认',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          _this8.$api.unpinItem({\n            idleItemId: _this8.idleItemInfo.id\n          }).then(function (res) {\n            if (res.status_code === 1) {\n              _this8.$message.success('已取消置顶'); // 刷新商品信息\n\n\n              _this8.$api.getIdleItem({\n                id: _this8.idleItemInfo.id\n              }).then(function (refreshRes) {\n                if (refreshRes.data) {\n                  refreshRes.data.pictureList = JSON.parse(refreshRes.data.pictureList);\n                  _this8.idleItemInfo = refreshRes.data;\n                }\n              }); // 刷新会员状态\n\n\n              _this8.loadMembershipStatus();\n            } else {\n              _this8.$message.error(res.msg || '取消置顶失败');\n            }\n          }).catch(function () {\n            _this8.$message.error('网络错误，请稍后重试');\n          });\n        }).catch(function () {});\n        return;\n      } // 置顶商品\n\n\n      this.$confirm('置顶商品可以让您的商品在列表中优先显示，是否确认置顶？', '确认置顶', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'info'\n      }).then(function () {\n        // 默认置顶7天\n        _this8.$api.pinItem({\n          idleItemId: _this8.idleItemInfo.id,\n          durationDays: 7\n        }).then(function (res) {\n          if (res.status_code === 1) {\n            _this8.$message.success('置顶成功！'); // 刷新商品信息\n\n\n            _this8.$api.getIdleItem({\n              id: _this8.idleItemInfo.id\n            }).then(function (refreshRes) {\n              if (refreshRes.data) {\n                refreshRes.data.pictureList = JSON.parse(refreshRes.data.pictureList);\n                _this8.idleItemInfo = refreshRes.data;\n              }\n            }); // 刷新会员状态\n\n\n            _this8.loadMembershipStatus();\n          } else {\n            _this8.$message.error(res.msg || '置顶失败');\n          }\n        }).catch(function () {\n          _this8.$message.error('网络错误，请稍后重试');\n        });\n      }).catch(function () {});\n    },\n    favoriteButton: function favoriteButton(idleItemInfo) {\n      var _this9 = this;\n\n      if (this.isFavorite) {\n        this.$api.deleteFavorite({\n          id: this.favoriteId\n        }).then(function (res) {\n          console.log(res);\n\n          if (res.status_code === 1) {\n            _this9.$message({\n              message: '已取消购物车！',\n              type: 'success'\n            });\n\n            _this9.isFavorite = false;\n          } else {\n            _this9.$message.error(res.msg);\n          }\n        }).catch(function (e) {});\n      } else {\n        this.$api.addFavorite({\n          idleId: idleItemInfo.id\n        }).then(function (res) {\n          console.log(res);\n\n          if (res.status_code === 1) {\n            _this9.$message({\n              message: '已加入购物车！',\n              type: 'success'\n            });\n\n            _this9.isFavorite = true;\n            _this9.favoriteId = res.data;\n          } else {\n            _this9.$message.error(res.msg);\n          }\n        }).catch(function (e) {});\n      }\n    },\n    cancelReply: function cancelReply() {\n      this.isReply = false;\n      this.toUser = this.idleItemInfo.userId;\n      this.toMessage = null;\n      this.replyData.toUserNickname = '';\n      this.replyData.toMessage = '';\n    },\n    sendMessage: function sendMessage() {\n      var _this10 = this;\n\n      var content = this.messageContent.trim();\n\n      if (this.toUser == null) {\n        this.toUser = this.idleItemInfo.userId;\n      }\n\n      if (content) {\n        var contentList = content.split(/\\r?\\n/);\n        var contenHtml = contentList[0];\n\n        for (var i = 1; i < contentList.length; i++) {\n          contenHtml += '<br>' + contentList[i];\n        }\n\n        this.$api.sendMessage({\n          idleId: this.idleItemInfo.id,\n          content: contenHtml,\n          toUser: this.toUser,\n          toMessage: this.toMessage\n        }).then(function (res) {\n          if (res.status_code === 1) {\n            _this10.$message({\n              message: '留言成功！',\n              type: 'success'\n            });\n\n            _this10.messageContent = '';\n\n            _this10.cancelReply();\n\n            _this10.getAllIdleMessage();\n          } else {\n            _this10.$message.error(\"留言失败！\" + res.msg);\n          }\n        }).catch(function () {\n          _this10.$message.error(\"留言失败！\");\n        });\n      } else {\n        this.$message.error(\"留言为空！\");\n      }\n    },\n    loadSellerRating: function loadSellerRating() {\n      var _this11 = this;\n\n      if (!this.idleItemInfo.userId) {\n        return;\n      }\n\n      this.$api.getSellerStats({\n        sellerId: this.idleItemInfo.userId\n      }).then(function (res) {\n        if (res.status_code === 1 && res.data) {\n          // 确保评分是数字类型，保留一位小数\n          var avgRating = parseFloat(res.data.averageRating || 0);\n          _this11.sellerRatingStats = {\n            averageRating: avgRating > 0 ? avgRating : 0,\n            ratingCount: res.data.ratingCount || 0\n          };\n        } else {\n          _this11.sellerRatingStats = null;\n        }\n      }).catch(function () {\n        _this11.sellerRatingStats = null;\n      });\n    }\n  }\n};",{"version":3,"sources":["idle-details.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div>\n        <app-head></app-head>\n        <app-body>\n            <div class=\"idle-details-container\">\n                <!-- 商品详情卡片 -->\n                <el-card class=\"product-card\" shadow=\"hover\">\n                    <!-- 用户信息与价格区域 -->\n                    <div class=\"details-header\">\n                        <div class=\"details-header-user-info\">\n                            <el-avatar \n                                :size=\"80\" \n                                :src=\"idleItemInfo.user.avatar\" \n                                class=\"user-avatar\">\n                            </el-avatar>\n                            <div class=\"user-info-text\">\n                                <div class=\"details-header-user-info-nickname\">{{idleItemInfo.user.nickname}}</div>\n                                <div class=\"details-header-user-info-time\">\n                                    <i class=\"el-icon-time\"></i> {{idleItemInfo.user.signInTime.substring(0,10)}} 加入平台\n                                </div>\n                                <div class=\"details-header-user-info-rating\" v-if=\"sellerRatingStats\">\n                                    <el-rate\n                                        v-model=\"sellerRatingStats.averageRating\"\n                                        disabled\n                                        show-score\n                                        text-color=\"#ff9900\"\n                                        score-template=\"{value}\">\n                                    </el-rate>\n                                    <span class=\"rating-count\">({{sellerRatingStats.ratingCount}}条评价)</span>\n                                </div>\n                                <div class=\"details-header-user-info-rating\" v-else-if=\"sellerRatingStats === null\">\n                                    <span class=\"no-rating\">暂无评价</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"details-header-buy\" :class=\"{'owner-controls': isMaster}\">\n                            <div v-show=\"idleItemInfo.idlePrice !== 0\" class=\"product-price\">\n                                <span class=\"price-symbol\">¥</span>{{idleItemInfo.idlePrice}}\n                            </div>\n                            <div v-if=\"!isMaster && idleItemInfo.idleStatus!==1\" class=\"product-status\">\n                                <i class=\"el-icon-warning-outline\"></i> 闲置已下架或删除\n                            </div>\n                            <div class=\"action-buttons\">\n                                <el-button \n                                    v-show=\"idleItemInfo.idlePrice > 0\" \n                                    v-if=\"!isMaster && idleItemInfo.idleStatus===1\" \n                                    type=\"danger\" \n                                    icon=\"el-icon-shopping-cart-2\" \n                                    round \n                                    @click=\"buyButton(idleItemInfo)\">\n                                    立即购买\n                                </el-button>\n                                <el-button \n                                    v-show=\"idleItemInfo.idlePrice > 0\" \n                                    v-if=\"!isMaster && idleItemInfo.idleStatus===1\" \n                                    :type=\"isFavorite ? 'warning' : 'primary'\" \n                                    :icon=\"isFavorite ? 'el-icon-star-on' : 'el-icon-star-off'\" \n                                    round \n                                    @click=\"favoriteButton(idleItemInfo)\">\n                                    {{isFavorite ? '取消购物车' : '加入购物车'}}\n                                </el-button>\n                                <el-button\n                                        v-if=\"!isMaster && idleItemInfo.idleStatus===1\"\n                                        type=\"primary\"\n                                        icon=\"el-icon-chat-dot-round\"\n                                        round\n                                        @click=\"startChat\">\n                                    私聊\n                                </el-button>\n                                <el-button \n                                    v-if=\"isMaster && idleItemInfo.idleStatus===1\" \n                                    type=\"danger\" \n                                    icon=\"el-icon-download\" \n                                    round \n                                    @click=\"changeStatus(idleItemInfo,2)\">\n                                    下架\n                                </el-button>\n                                <el-button \n                                    v-if=\"isMaster && idleItemInfo.idleStatus===2\" \n                                    type=\"success\" \n                                    icon=\"el-icon-upload2\" \n                                    round \n                                    @click=\"changeStatus(idleItemInfo,1)\">\n                                    重新上架\n                                </el-button>\n                                <el-button \n                                    v-if=\"isMaster && idleItemInfo.idleStatus===1 && canPin\" \n                                    :type=\"idleItemInfo.isPinned ? 'warning' : 'primary'\" \n                                    :icon=\"idleItemInfo.isPinned ? 'el-icon-top' : 'el-icon-top'\" \n                                    round \n                                    @click=\"handlePinItem\">\n                                    {{idleItemInfo.isPinned ? '取消置顶' : '置顶商品'}}\n                                </el-button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- 分隔线 -->\n                    <el-divider></el-divider>\n\n                    <!-- 商品详情区域 -->\n                    <div class=\"details-info\">\n                        <div class=\"details-info-title\">\n                            <span class=\"product-name\">{{idleItemInfo.idleName}}</span>\n                            <el-tag \n                                v-if=\"idleItemInfo.isPinned\" \n                                type=\"warning\" \n                                size=\"small\" \n                                class=\"pin-tag\">\n                                <i class=\"el-icon-top\"></i> 置顶中\n                            </el-tag>\n                            <el-tag \n                                v-if=\"idleItemInfo.idleLabel\" \n                                :type=\"getTagType(idleItemInfo.idleLabel)\" \n                                size=\"medium\" \n                                class=\"product-tag\">\n                                {{getCategoryName(idleItemInfo.idleLabel)}}\n                            </el-tag>\n                        </div>\n                        \n                        <div class=\"product-location\" v-if=\"idleItemInfo.idlePlace\">\n                            <i class=\"el-icon-location\"></i> {{idleItemInfo.idlePlace}}\n                        </div>\n                        \n                        <div class=\"details-info-main\" v-html=\"idleItemInfo.idleDetails\">\n                            {{idleItemInfo.idleDetails}}\n                        </div>\n                    </div>\n\n                    <!-- 商品图片区域 -->\n                    <div class=\"details-picture\">\n                        <el-carousel \n                            v-if=\"idleItemInfo.pictureList && idleItemInfo.pictureList.length > 0\" \n                            :interval=\"4000\" \n                            type=\"card\" \n                            height=\"400px\" \n                            indicator-position=\"outside\"\n                            class=\"image-carousel\">\n                            <el-carousel-item v-for=\"(imgUrl, i) in idleItemInfo.pictureList\" :key=\"i\">\n                                <el-image \n                                    :src=\"imgUrl\" \n                                    fit=\"contain\" \n                                    class=\"carousel-image\"\n                                    :preview-src-list=\"idleItemInfo.pictureList\">\n                                </el-image>\n                            </el-carousel-item>\n                        </el-carousel>\n                        \n                        <div v-else class=\"no-images\">\n                            <i class=\"el-icon-picture-outline\"></i>\n                            <p>暂无图片</p>\n                        </div>\n                    </div>\n                </el-card>\n\n                <!-- 留言板区域 -->\n                <el-card class=\"message-card\" shadow=\"hover\" id=\"replyMessageLocation\">\n                    <div slot=\"header\" class=\"message-header\">\n                        <span><i class=\"el-icon-chat-line-round\"></i> 留言板</span>\n                        <el-badge :value=\"messageList.length\" :max=\"99\" class=\"message-badge\" type=\"primary\"/>\n                    </div>\n                    \n                    <!-- 发送留言区域 -->\n                    <div class=\"message-send\">\n                        <div v-if=\"isReply\" class=\"reply-info\">\n                            <el-tag type=\"info\" closable @close=\"cancelReply\">\n                                回复：{{replyData.toMessage}} @{{replyData.toUserNickname}}\n                            </el-tag>\n                        </div>\n                        <el-input\n                                type=\"textarea\"\n                                :rows=\"3\"\n                                placeholder=\"在此留言提问...\"\n                                v-model=\"messageContent\"\n                                maxlength=\"200\"\n                                show-word-limit\n                                class=\"message-input\">\n                        </el-input>\n                        <div class=\"message-send-button\">\n                            <el-button type=\"primary\" icon=\"el-icon-s-promotion\" @click=\"sendMessage\" round>发送留言</el-button>\n                        </div>\n                    </div>\n                    \n                    <!-- 留言列表 -->\n                    <div class=\"message-list\">\n                        <div v-if=\"messageList.length === 0\" class=\"no-messages\">\n                            <i class=\"el-icon-chat-dot-square\"></i>\n                            <p>暂无留言，快来留言吧!</p>\n                        </div>\n                        \n                        <el-timeline v-else>\n                            <el-timeline-item\n                                v-for=\"(mes, index) in messageList\"\n                                :key=\"index\"\n                                :timestamp=\"mes.createTime\"\n                                placement=\"top\"\n                                :color=\"index % 2 === 0 ? '#409EFF' : '#67C23A'\">\n                                \n                                <el-card class=\"message-item-card\" shadow=\"hover\">\n                                    <div class=\"message-container-list\">\n                                        <div class=\"message-container-list-left\">\n                                            <el-avatar\n                                                :size=\"50\"\n                                                :src=\"mes.fromU.avatar\"\n                                                class=\"message-avatar\">\n                                            </el-avatar>\n                                            <div class=\"message-container-list-text\">\n                                                <div class=\"message-nickname\">\n                                                    {{mes.fromU.nickname}}\n                                                    <span v-if=\"mes.toU.nickname\" class=\"reply-to\">\n                                                        回复 <strong>@{{mes.toU.nickname}}</strong>：\n                                                        <span class=\"quoted-message\">{{mes.toM.content.substring(0,10)}}{{mes.toM.content.length>10?'...':''}}</span>\n                                                    </span>\n                                                </div>\n                                                <div class=\"message-content\" v-html=\"mes.content\">{{mes.content}}</div>\n                                            </div>\n                                        </div>\n                                        <div class=\"message-container-list-right\">\n                                            <el-button type=\"text\" icon=\"el-icon-chat-dot-round\" @click=\"replyMessage(index)\">回复</el-button>\n                                        </div>\n                                    </div>\n                                </el-card>\n                            </el-timeline-item>\n                        </el-timeline>\n                    </div>\n                </el-card>\n            </div>\n            <app-foot></app-foot>\n        </app-body>\n        \n        <!-- 购买时选择收货地址对话框 -->\n        <el-dialog\n            title=\"选择收货地址\"\n            :visible.sync=\"addressDialogVisible\"\n            width=\"600px\"\n            :close-on-click-modal=\"false\">\n            <div v-if=\"addressList.length > 0\">\n                <el-radio-group v-model=\"selectedAddressId\" style=\"width: 100%;\">\n                    <div \n                        v-for=\"address in addressList\" \n                        :key=\"address.id\"\n                        class=\"address-option\"\n                        :class=\"{'selected': selectedAddressId === address.id}\">\n                        <el-radio :label=\"address.id\" style=\"width: 100%;\">\n                            <div class=\"address-option-content\">\n                                <div class=\"address-header\">\n                                    <span class=\"address-name\">{{ address.consigneeName }}</span>\n                                    <span class=\"address-phone\">{{ address.consigneePhone }}</span>\n                                    <el-tag v-if=\"address.defaultFlag\" size=\"small\" type=\"success\" style=\"margin-left: 10px;\">默认</el-tag>\n                                </div>\n                                <div class=\"address-detail\">\n                                    <i class=\"el-icon-location\"></i>\n                                    {{ address.detailAddress }}\n                                </div>\n                            </div>\n                        </el-radio>\n                    </div>\n                </el-radio-group>\n            </div>\n            <div v-else class=\"no-address-tip\">\n                <i class=\"el-icon-warning\"></i>\n                <p>您还没有收货地址，请先添加收货地址</p>\n                <el-button type=\"primary\" @click=\"goToAddAddress\">去添加地址</el-button>\n            </div>\n            <div slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"addressDialogVisible = false\">取 消</el-button>\n                <el-button \n                    type=\"primary\" \n                    @click=\"confirmBuyWithAddress\"\n                    :disabled=\"!selectedAddressId && addressList.length > 0\">\n                    确认购买\n                </el-button>\n            </div>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\n    import AppHead from '../common/AppHeader.vue';\n    import AppBody from '../common/AppPageBody.vue'\n    import AppFoot from '../common/AppFoot.vue'\n\n    export default {\n        name: \"idle-details\",\n        components: {\n            AppHead,\n            AppBody,\n            AppFoot\n        },\n        data() {\n            return {\n                messageContent:'',\n                toUser:null,\n                toMessage:null,\n                isReply:false,\n                replyData:{\n                    toUserNickname:'',\n                    toMessage:''\n                },\n                messageList:[],\n                idleItemInfo:{\n                    id:'',\n                    idleName:'',\n                    idleDetails:'',\n                    pictureList:[],\n                    idlePrice:0,\n                    idlePlace:'',\n                    idleLabel:'',\n                    idleStatus:-1,\n                    userId:'',\n                    user:{\n                        avatar:'',\n                        nickname:'',\n                        signInTime:''\n                    },\n                },\n                isMaster:false,\n                isFavorite:true,\n                favoriteId:0,\n                sellerRatingStats: null, // 卖家信誉评分统计 {averageRating, ratingCount}\n                categories: {\n                    '1': '数码科技',\n                    '2': '生活用品',\n                    '3': '运动相关',\n                    '4': '图书笔记',\n                    '5': '公告'\n                },\n                membershipStatus: null, // 会员状态\n                // 购买地址选择相关\n                addressDialogVisible: false,\n                addressList: [],\n                selectedAddressId: null,\n                pendingBuyItem: null // 待购买的商品信息\n            };\n        },\n        computed: {\n            canPin() {\n                // 检查用户是否是会员且可以置顶\n                return this.membershipStatus && this.membershipStatus.isValid && this.membershipStatus.canPin;\n            }\n        },\n        created(){\n            // 加载会员状态\n            this.loadMembershipStatus();\n            \n            let id=this.$route.query.id;\n            this.$api.getIdleItem({\n                id:id\n            }).then(res=>{\n                console.log(res);\n                if(res.data){\n                    let list=res.data.idleDetails.split(/\\r?\\n/);\n                    let str='';\n                    for(let i=0;i<list.length;i++){\n                        str+='<p>'+list[i]+'</p>';\n                    }\n                    res.data.idleDetails=str;\n                    res.data.pictureList=JSON.parse(res.data.pictureList);\n                    this.idleItemInfo=res.data;\n                    console.log(this.idleItemInfo);\n                    let userId=this.getCookie('shUserId');\n                    console.log('userid',userId)\n                    if(userId == this.idleItemInfo.userId){\n                        console.log('isMaster');\n                        this.isMaster=true;\n                    }\n                    this.checkFavorite();\n                    this.getAllIdleMessage();\n                    // 加载卖家信誉评分\n                    this.loadSellerRating();\n                }\n                $('html,body').animate({\n                    scrollTop: 0\n                }, {duration: 500, easing: \"swing\"});\n            });\n        },\n        methods: {\n            getCategoryName(label) {\n                return this.categories[label] || '其他';\n            },\n            getTagType(label) {\n                const types = {\n                    '1': 'primary',\n                    '2': 'success',\n                    '3': 'warning',\n                    '4': 'info',\n                    '5': 'danger'\n                };\n                return types[label] || 'info';\n            },\n            getAllIdleMessage(){\n                this.$api.getAllIdleMessage({\n                    idleId:this.idleItemInfo.id\n                }).then(res=>{\n                    console.log('getAllIdleMessage',res.data);\n                    if(res.status_code===1){\n                        this.messageList=res.data;\n                    }\n                }).catch(()=>{\n                })\n            },\n            checkFavorite(){\n                this.$api.checkFavorite({\n                    idleId:this.idleItemInfo.id\n                }).then(res=>{\n                    if(!res.data){\n                        this.isFavorite=false;\n                    }else {\n                        this.favoriteId=res.data;\n                    }\n                })\n            },\n            getCookie(cname){\n                var name = cname + \"=\";\n                var ca = document.cookie.split(';');\n                for(var i=0; i<ca.length; i++)\n                {\n                    var c = ca[i].trim();\n                    if (c.indexOf(name)===0) return c.substring(name.length,c.length);\n                }\n                return \"\";\n            },\n            startChat(){\n                const userId = this.getCookie('shUserId');\n                if(!userId){\n                    this.$message.error(\"请先登录后再发起私聊\");\n                    this.$router.push('/login');\n                    return;\n                }\n                if(userId == this.idleItemInfo.userId){\n                    this.$message.info(\"这是您自己发布的闲置哦\");\n                    return;\n                }\n                this.$router.push({\n                    path:'/chat',\n                    query:{\n                        targetUserId:this.idleItemInfo.userId,\n                        idleId:this.idleItemInfo.id\n                    }\n                });\n            },\n            replyMessage(index){\n                $('html,body').animate({\n                    scrollTop: $(\"#replyMessageLocation\").offset().top-100\n                }, {duration: 500, easing: \"swing\"});\n                this.isReply=true;\n                this.replyData.toUserNickname=this.messageList[index].fromU.nickname;\n                this.replyData.toMessage=this.messageList[index].content.substring(0,10)+(this.messageList[index].content.length>10?'...':'');\n                this.toUser=this.messageList[index].userId;\n                this.toMessage=this.messageList[index].id;\n            },\n            changeStatus(idle,status){\n                this.$api.updateIdleItem({\n                    id:idle.id,\n                    idleStatus:status\n                }).then(res=>{\n                    console.log(res);\n                    if(res.status_code===1){\n                        this.idleItemInfo.idleStatus=status;\n                        this.$message({\n                            message: status === 1 ? '商品已重新上架' : '商品已下架',\n                            type: 'success'\n                        });\n                    }else {\n                        this.$message.error(res.msg)\n                    }\n                });\n            },\n            buyButton(idleItemInfo){\n                // 检查是否登录\n                const userId = this.getCookie('shUserId');\n                if(!userId){\n                    this.$message.warning('请先登录后再购买');\n                    this.$router.push('/login');\n                    return;\n                }\n\n                // 保存待购买的商品信息\n                this.pendingBuyItem = idleItemInfo;\n                \n                // 加载收货地址列表\n                this.loadAddressList();\n            },\n            // 加载收货地址列表\n            async loadAddressList() {\n                try {\n                    const addressRes = await this.$api.getAddress();\n                    if (addressRes.status_code === 1 && addressRes.data) {\n                        this.addressList = addressRes.data;\n                        \n                        if (this.addressList.length > 0) {\n                            // 自动选择默认地址\n                            const defaultAddress = this.addressList.find(addr => addr.defaultFlag);\n                            this.selectedAddressId = defaultAddress ? defaultAddress.id : this.addressList[0].id;\n                            // 显示地址选择对话框\n                            this.addressDialogVisible = true;\n                        } else {\n                            // 没有收货地址，提示用户先添加\n                            this.$confirm('您还没有收货地址，请先添加收货地址', '提示', {\n                                confirmButtonText: '去添加',\n                                cancelButtonText: '取消',\n                                type: 'warning'\n                            }).then(() => {\n                                this.goToAddAddress();\n                            }).catch(() => {});\n                        }\n                    } else {\n                        this.$message.error('加载地址列表失败');\n                    }\n                } catch (e) {\n                    console.error('加载地址列表异常:', e);\n                    this.$message.error('网络错误，请稍后重试');\n                }\n            },\n            // 确认购买（使用选中的地址）\n            async confirmBuyWithAddress() {\n                if (!this.selectedAddressId) {\n                    this.$message.warning('请选择收货地址');\n                    return;\n                }\n                \n                const selectedAddress = this.addressList.find(addr => addr.id === this.selectedAddressId);\n                if (!selectedAddress) {\n                    this.$message.error('地址信息错误');\n                    return;\n                }\n                \n                if (!this.pendingBuyItem) {\n                    this.$message.error('商品信息错误');\n                    return;\n                }\n                \n                try {\n                    // 创建订单\n                    const orderRes = await this.$api.addOrder({\n                        idleId: this.pendingBuyItem.id,\n                        orderPrice: this.pendingBuyItem.idlePrice,\n                    });\n                    \n                    if (orderRes.status_code === 1 && orderRes.data && orderRes.data.id) {\n                        // 创建订单地址\n                        console.log('准备创建订单地址，订单ID:', orderRes.data.id, '地址信息:', selectedAddress);\n                        const addressRes = await this.$api.addOrderAddress({\n                            orderId: orderRes.data.id,\n                            consigneeName: selectedAddress.consigneeName,\n                            consigneePhone: selectedAddress.consigneePhone,\n                            detailAddress: selectedAddress.detailAddress\n                        });\n                        \n                        console.log('订单地址创建结果:', addressRes);\n                        if (addressRes.status_code !== 1) {\n                            console.error('订单地址创建失败:', addressRes);\n                            this.$message.warning('订单创建成功，但地址保存失败，请在订单详情页补充地址信息');\n                        }\n                        \n                        // 关闭对话框\n                        this.addressDialogVisible = false;\n                        this.pendingBuyItem = null;\n\n                        // 请求单订单碳减排估算并弹窗提示（弱提示）\n                        this.$api.getOrderCarbon({ orderId: orderRes.data.id }).then(carRes => {\n                            if (carRes.status_code === 1 && carRes.data) {\n                                const kg = carRes.data.carbonKg || carRes.data.carbonKg === 0 ? carRes.data.carbonKg : null;\n                                const kwh = carRes.data.equivalentKwh || carRes.data.equivalentKwh === 0 ? carRes.data.equivalentKwh : null;\n                                if (kg !== null) {\n                                    this.$message({\n                                        message: `交易成功！本次交易减少碳排放约 ${kg} kg（约 ${kwh} kWh）`,\n                                        type: 'success'\n                                    });\n                                } else {\n                                    this.$message.success('订单创建成功！');\n                                }\n                            } else {\n                                this.$message.success('订单创建成功！');\n                            }\n                        }).catch(() => {\n                            this.$message.success('订单创建成功！');\n                        }).finally(() => {\n                            console.log('订单创建成功，跳转到订单页面，订单ID:', orderRes.data.id);\n                            this.$router.push({path: '/order', query: {id: orderRes.data.id}}).catch(err => {\n                                console.error('路由跳转失败:', err);\n                                this.$message.error('跳转失败，请刷新页面重试');\n                            });\n                        });\n                    } else {\n                        console.error('订单创建失败:', orderRes);\n                        this.$message.error(orderRes.msg || '订单创建失败，请稍后重试');\n                    }\n                } catch (e) {\n                    console.error('创建订单异常:', e);\n                    this.$message.error('网络错误，请稍后重试');\n                }\n            },\n            // 跳转到添加地址页面\n            goToAddAddress() {\n                this.addressDialogVisible = false;\n                this.$router.push({path: '/me', query: {tab: 'address'}});\n            },\n            loadMembershipStatus() {\n                this.$api.getMembershipStatus().then(res => {\n                    if (res.status_code === 1) {\n                        this.membershipStatus = res.data;\n                    }\n                }).catch(() => {\n                    // 静默失败\n                });\n            },\n            handlePinItem() {\n                if (!this.canPin) {\n                    this.$message.warning('您还不是会员，无法使用置顶功能！');\n                    this.$router.push('/membership');\n                    return;\n                }\n\n                if (this.idleItemInfo.isPinned) {\n                    // 取消置顶：调用后端 unpin 接口\n                    this.$confirm('确认取消置顶吗？', '取消置顶', {\n                        confirmButtonText: '确认',\n                        cancelButtonText: '取消',\n                        type: 'warning'\n                    }).then(() => {\n                        this.$api.unpinItem({ idleItemId: this.idleItemInfo.id }).then(res => {\n                            if (res.status_code === 1) {\n                                this.$message.success('已取消置顶');\n                                // 刷新商品信息\n                                this.$api.getIdleItem({ id: this.idleItemInfo.id }).then(refreshRes => {\n                                    if (refreshRes.data) {\n                                        refreshRes.data.pictureList = JSON.parse(refreshRes.data.pictureList);\n                                        this.idleItemInfo = refreshRes.data;\n                                    }\n                                });\n                                // 刷新会员状态\n                                this.loadMembershipStatus();\n                            } else {\n                                this.$message.error(res.msg || '取消置顶失败');\n                            }\n                        }).catch(() => {\n                            this.$message.error('网络错误，请稍后重试');\n                        });\n                    }).catch(() => {});\n                    return;\n                }\n\n                // 置顶商品\n                this.$confirm('置顶商品可以让您的商品在列表中优先显示，是否确认置顶？', '确认置顶', {\n                    confirmButtonText: '确认',\n                    cancelButtonText: '取消',\n                    type: 'info'\n                }).then(() => {\n                    // 默认置顶7天\n                    this.$api.pinItem({\n                        idleItemId: this.idleItemInfo.id,\n                        durationDays: 7\n                    }).then(res => {\n                        if (res.status_code === 1) {\n                            this.$message.success('置顶成功！');\n                            // 刷新商品信息\n                            this.$api.getIdleItem({\n                                id: this.idleItemInfo.id\n                            }).then(refreshRes => {\n                                if (refreshRes.data) {\n                                    refreshRes.data.pictureList = JSON.parse(refreshRes.data.pictureList);\n                                    this.idleItemInfo = refreshRes.data;\n                                }\n                            });\n                            // 刷新会员状态\n                            this.loadMembershipStatus();\n                        } else {\n                            this.$message.error(res.msg || '置顶失败');\n                        }\n                    }).catch(() => {\n                        this.$message.error('网络错误，请稍后重试');\n                    });\n                }).catch(() => {});\n            },\n            favoriteButton(idleItemInfo){\n                if(this.isFavorite){\n                    this.$api.deleteFavorite({\n                        id: this.favoriteId\n                    }).then(res=>{\n                        console.log(res);\n                        if(res.status_code===1){\n                            this.$message({\n                                message: '已取消购物车！',\n                                type: 'success'\n                            });\n                            this.isFavorite=false;\n                        }else {\n                            this.$message.error(res.msg)\n                        }\n                    }).catch(e=>{\n                    })\n                }else {\n                    this.$api.addFavorite({\n                        idleId:idleItemInfo.id\n                    }).then(res=>{\n                        console.log(res);\n                        if(res.status_code===1){\n                            this.$message({\n                                message: '已加入购物车！',\n                                type: 'success'\n                            });\n                            this.isFavorite=true;\n                            this.favoriteId=res.data;\n                        }else {\n                            this.$message.error(res.msg)\n                        }\n                    }).catch(e=>{\n                    })\n                }\n            },\n            cancelReply(){\n                this.isReply=false;\n                this.toUser=this.idleItemInfo.userId;\n                this.toMessage=null;\n                this.replyData.toUserNickname='';\n                this.replyData.toMessage='';\n            },\n            sendMessage(){\n                let content=this.messageContent.trim();\n                if(this.toUser==null){\n                    this.toUser=this.idleItemInfo.userId;\n                }\n                if(content){\n                    let contentList=content.split(/\\r?\\n/);\n                    let contenHtml=contentList[0];\n                    for(let i=1;i<contentList.length;i++){\n                        contenHtml+='<br>'+contentList[i];\n                    }\n                    this.$api.sendMessage({\n                        idleId:this.idleItemInfo.id,\n                        content:contenHtml,\n                        toUser:this.toUser,\n                        toMessage:this.toMessage\n                    }).then(res=>{\n                        if(res.status_code===1){\n                            this.$message({\n                                message: '留言成功！',\n                                type: 'success'\n                            });\n                            this.messageContent='';\n                            this.cancelReply();\n                            this.getAllIdleMessage();\n                        }else {\n                            this.$message.error(\"留言失败！\"+res.msg);\n                        }\n                    }).catch(()=>{\n                        this.$message.error(\"留言失败！\");\n                    });\n\n                }else{\n                    this.$message.error(\"留言为空！\");\n                }\n            },\n            loadSellerRating() {\n                if (!this.idleItemInfo.userId) {\n                    return;\n                }\n                this.$api.getSellerStats({\n                    sellerId: this.idleItemInfo.userId\n                }).then(res => {\n                    if (res.status_code === 1 && res.data) {\n                        // 确保评分是数字类型，保留一位小数\n                        const avgRating = parseFloat(res.data.averageRating || 0);\n                        this.sellerRatingStats = {\n                            averageRating: avgRating > 0 ? avgRating : 0,\n                            ratingCount: res.data.ratingCount || 0\n                        };\n                    } else {\n                        this.sellerRatingStats = null;\n                    }\n                }).catch(() => {\n                    this.sellerRatingStats = null;\n                });\n            }\n        },\n    }\n</script>\n\n<style scoped>\n    .idle-details-container {\n        min-height: 85vh;\n        padding: 20px 0;\n    }\n\n    /* 商品卡片样式 */\n    .product-card, .message-card {\n        margin-bottom: 30px;\n        border-radius: 8px;\n        overflow: hidden;\n    }\n    \n    /* 用户信息与价格区域 */\n    .details-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 10px 0;\n        flex-wrap: wrap;\n    }\n\n    .details-header-user-info {\n        display: flex;\n        align-items: center;\n    }\n\n    .user-avatar {\n        box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n        border: 2px solid #fff;\n    }\n\n    .user-info-text {\n        margin-left: 15px;\n    }\n\n    .details-header-user-info-nickname {\n        font-weight: 600;\n        font-size: 18px;\n        margin-bottom: 10px;\n        color: #303133;\n    }\n\n    .details-header-user-info-time {\n        font-size: 14px;\n        color: #909399;\n        display: flex;\n        align-items: center;\n        margin-top: 8px;\n    }\n\n    .details-header-user-info-time i {\n        margin-right: 5px;\n    }\n\n    .details-header-user-info-rating {\n        margin-top: 8px;\n        display: flex;\n        align-items: center;\n        font-size: 14px;\n    }\n\n    .rating-count {\n        margin-left: 8px;\n        color: #909399;\n        font-size: 13px;\n    }\n\n    .no-rating {\n        color: #c0c4cc;\n        font-size: 13px;\n    }\n\n    .details-header-buy {\n        display: flex;\n        flex-direction: column;\n        align-items: flex-end;\n    }\n\n    .owner-controls {\n        align-items: center;\n    }\n\n    .product-price {\n        font-size: 24px;\n        font-weight: 700;\n        color: #f56c6c;\n        margin-bottom: 15px;\n    }\n\n    .price-symbol {\n        font-size: 16px;\n        font-weight: normal;\n        margin-right: 2px;\n    }\n\n    .product-status {\n        color: #f56c6c;\n        font-size: 16px;\n        margin-bottom: 15px;\n        display: flex;\n        align-items: center;\n    }\n\n    .product-status i {\n        margin-right: 5px;\n    }\n\n    .action-buttons {\n        display: flex;\n        gap: 10px;\n    }\n\n    /* 商品详情区域 */\n    .details-info {\n        padding: 20px 0;\n    }\n\n    .details-info-title {\n        display: flex;\n        align-items: center;\n        margin-bottom: 15px;\n    }\n\n    .product-name {\n        font-size: 24px;\n        font-weight: 600;\n        color: #303133;\n        margin-right: 10px;\n    }\n\n    .product-tag {\n        margin-left: 10px;\n    }\n    \n    .pin-tag {\n        margin-left: 10px;\n        background: #ffc107;\n        color: #fff;\n        border: none;\n    }\n    \n    .pin-tag i {\n        margin-right: 4px;\n    }\n\n    .product-location {\n        font-size: 14px;\n        color: #606266;\n        margin-bottom: 20px;\n        display: flex;\n        align-items: center;\n    }\n\n    .product-location i {\n        margin-right: 5px;\n        color: #e6a23c;\n    }\n\n    .details-info-main {\n        font-size: 16px;\n        color: #606266;\n        line-height: 1.8;\n        background-color: #f8f9fa;\n        padding: 20px;\n        border-radius: 4px;\n        margin-bottom: 20px;\n    }\n\n    /* 商品图片区域 */\n    .details-picture {\n        margin: 10px 0 30px;\n    }\n\n    .image-carousel {\n        margin: 0 auto;\n    }\n\n    .carousel-image {\n        height: 100%;\n        width: 100%;\n    }\n\n    .no-images {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        background-color: #f5f7fa;\n        height: 300px;\n        color: #909399;\n        border-radius: 4px;\n    }\n\n    .no-images i {\n        font-size: 50px;\n        margin-bottom: 10px;\n    }\n    \n    /* 留言板样式 */\n    .message-header {\n        display: flex;\n        align-items: center;\n        font-size: 18px;\n        font-weight: 600;\n    }\n\n    .message-badge {\n        margin-left: 10px;\n    }\n\n    .message-send {\n        margin-bottom: 30px;\n    }\n\n    .reply-info {\n        margin-bottom: 10px;\n    }\n\n    .message-input {\n        margin-bottom: 10px;\n    }\n\n    .message-send-button {\n        display: flex;\n        justify-content: flex-end;\n    }\n\n    /* 留言列表样式 */\n    .message-list {\n        padding: 10px 0;\n    }\n\n    .no-messages {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        height: 150px;\n        color: #909399;\n    }\n\n    .no-messages i {\n        font-size: 40px;\n        margin-bottom: 10px;\n    }\n\n    .message-item-card {\n        margin-bottom: 10px;\n    }\n\n    .message-container-list {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-start;\n    }\n\n    .message-container-list-left {\n        display: flex;\n        flex: 1;\n    }\n\n    .message-avatar {\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        border: 2px solid #fff;\n    }\n\n    .message-container-list-text {\n        margin-left: 15px;\n        flex: 1;\n    }\n\n    .message-nickname {\n        font-weight: 600;\n        font-size: 16px;\n        color: #303133;\n        margin-bottom: 8px;\n    }\n\n    .reply-to {\n        font-size: 14px;\n        font-weight: normal;\n        color: #606266;\n    }\n\n    .quoted-message {\n        color: #909399;\n        font-style: italic;\n    }\n\n    .message-content {\n        font-size: 15px;\n        color: #606266;\n        margin-bottom: 10px;\n        line-height: 1.6;\n        word-break: break-word;\n    }\n\n    .message-container-list-right {\n        min-width: 60px;\n        display: flex;\n        justify-content: flex-end;\n        margin-left: 15px;\n    }\n\n    /* 响应式调整 */\n    @media (max-width: 768px) {\n        .details-header {\n            flex-direction: column;\n            align-items: flex-start;\n        }\n\n        .details-header-buy {\n            margin-top: 20px;\n            align-items: flex-start;\n            width: 100%;\n        }\n\n        .action-buttons {\n            flex-wrap: wrap;\n            margin-top: 10px;\n        }\n\n        .message-container-list {\n            flex-direction: column;\n        }\n\n        .message-container-list-right {\n            margin-top: 10px;\n            margin-left: 0;\n            align-self: flex-end;\n        }\n    }\n    \n    /* 地址选择对话框样式 */\n    .address-option {\n        margin-bottom: 15px;\n        padding: 15px;\n        border: 2px solid #e4e7ed;\n        border-radius: 8px;\n        transition: all 0.3s;\n        cursor: pointer;\n    }\n    \n    .address-option:hover {\n        border-color: #409EFF;\n        background-color: #f0f9ff;\n    }\n    \n    .address-option.selected {\n        border-color: #409EFF;\n        background-color: #ecf5ff;\n    }\n    \n    .address-option-content {\n        margin-left: 20px;\n    }\n    \n    .address-header {\n        display: flex;\n        align-items: center;\n        margin-bottom: 8px;\n    }\n    \n    .address-name {\n        font-weight: 600;\n        font-size: 16px;\n        color: #303133;\n        margin-right: 15px;\n    }\n    \n    .address-phone {\n        color: #606266;\n        font-size: 14px;\n    }\n    \n    .address-detail {\n        color: #606266;\n        font-size: 14px;\n        line-height: 1.6;\n        display: flex;\n        align-items: flex-start;\n    }\n    \n    .address-detail i {\n        margin-right: 5px;\n        color: #409EFF;\n        margin-top: 2px;\n    }\n    \n    .no-address-tip {\n        text-align: center;\n        padding: 40px 20px;\n    }\n    \n    .no-address-tip i {\n        font-size: 48px;\n        color: #e6a23c;\n        margin-bottom: 15px;\n    }\n    \n    .no-address-tip p {\n        color: #606266;\n        font-size: 16px;\n        margin-bottom: 20px;\n    }\n</style>"],"sourceRoot":"src/components/page"}]}