{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\order.vue?vue&type=style&index=0&id=8b2a0244&scoped=true&lang=css&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\order.vue","mtime":1767660868723},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\css-loader\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.order-container {\n    min-height: 85vh;\n    padding: 20px 0;\n}\n\n.order-card {\n    max-width: 900px;\n    margin: 0 auto;\n    border-radius: 12px;\n}\n\n.card-header {\n    padding: 20px;\n    border-bottom: 1px solid #f0f2f5;\n}\n\n.order-title {\n    font-size: 24px;\n    font-weight: 600;\n    color: #303133;\n    margin: 0;\n    display: flex;\n    align-items: center;\n}\n\n.order-title i {\n    margin-right: 10px;\n    color: #409EFF;\n    font-size: 28px;\n}\n\n.order-info-section {\n    padding: 20px;\n}\n\n.info-row {\n    display: flex;\n    align-items: center;\n    margin-bottom: 20px;\n    font-size: 16px;\n}\n\n.info-label {\n    width: 120px;\n    color: #606266;\n    font-weight: 500;\n}\n\n.info-value {\n    color: #303133;\n    flex: 1;\n}\n\n.info-value.price {\n    font-size: 24px;\n    font-weight: 700;\n    color: #f56c6c;\n}\n\n.section-title {\n    font-size: 18px;\n    font-weight: 600;\n    color: #303133;\n    margin-bottom: 15px;\n}\n\n.product-info-section {\n    padding: 20px;\n}\n\n.product-card {\n    display: flex;\n    padding: 20px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    gap: 20px;\n}\n\n.product-image {\n    width: 120px;\n    height: 120px;\n    border-radius: 8px;\n    flex-shrink: 0;\n}\n\n.product-details {\n    flex: 1;\n}\n\n.product-name {\n    font-size: 18px;\n    font-weight: 600;\n    color: #303133;\n    margin: 0 0 15px 0;\n}\n\n.product-price-info {\n    margin-top: 10px;\n}\n\n.product-price {\n    font-size: 22px;\n    font-weight: 700;\n    color: #f56c6c;\n}\n\n.seller-info-section {\n    padding: 20px;\n}\n\n.seller-card {\n    display: flex;\n    padding: 20px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    gap: 20px;\n    align-items: center;\n}\n\n.seller-avatar {\n    flex-shrink: 0;\n}\n\n.seller-details {\n    flex: 1;\n}\n\n.seller-name {\n    font-size: 16px;\n    margin-bottom: 15px;\n}\n\n.seller-label {\n    color: #606266;\n    font-weight: 500;\n}\n\n.seller-value {\n    color: #303133;\n    font-weight: 600;\n    font-size: 18px;\n}\n\n.seller-actions {\n    display: flex;\n    gap: 10px;\n}\n\n.buyer-info-section {\n    padding: 20px;\n}\n\n.buyer-card {\n    display: flex;\n    padding: 20px;\n    background: #f8f9fa;\n    border-radius: 8px;\n    gap: 20px;\n    align-items: center;\n}\n\n.buyer-avatar {\n    flex-shrink: 0;\n}\n\n.buyer-details {\n    flex: 1;\n}\n\n.buyer-name {\n    font-size: 16px;\n    margin-bottom: 15px;\n}\n\n.buyer-label {\n    color: #606266;\n    font-weight: 500;\n}\n\n.buyer-value {\n    color: #303133;\n    font-weight: 600;\n    font-size: 18px;\n}\n\n.buyer-actions {\n    display: flex;\n    gap: 10px;\n}\n\n.action-buttons {\n    padding: 20px;\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 60px 20px;\n    color: #909399;\n}\n\n.empty-state i {\n    font-size: 64px;\n    margin-bottom: 20px;\n    color: #c0c4cc;\n}\n\n.empty-state p {\n        font-size: 16px;\n    margin-bottom: 30px;\n}\n\n.fund-hint {\n    margin-left: 10px;\n    color: #909399;\n    font-size: 12px;\n}\n\n/* 地图相关样式 */\n.location-navigation-section {\n    margin-top: 20px;\n    padding: 20px;\n}\n\n.location-info-card {\n    display: flex;\n    gap: 20px;\n    margin-bottom: 15px;\n    padding: 15px;\n    background: #f5f7fa;\n    border-radius: 8px;\n    flex-wrap: wrap;\n}\n\n.location-info-item.full-width {\n    width: 100%;\n    margin-bottom: 8px;\n}\n\n.location-info-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.location-label {\n    color: #606266;\n        font-size: 14px;\n    }\n    \n.location-value {\n    color: #303133;\n    font-weight: 600;\n        font-size: 16px;\n    }\n    \n.location-value.text-warning {\n    color: #E6A23C;\n    font-weight: normal;\n}\n\n.map-container {\n    width: 100%;\n    height: 400px;\n    border-radius: 8px;\n    overflow: hidden;\n    margin-bottom: 15px;\n    border: 1px solid #e4e7ed;\n}\n\n.map-actions {\n    display: flex;\n        justify-content: center;\n    gap: 10px;\n    flex-wrap: wrap;\n}\n\n@media (max-width: 768px) {\n    .order-container {\n        padding: 10px;\n    }\n    \n    .product-card {\n        flex-direction: column;\n    }\n\n    .product-image {\n        width: 100%;\n        height: 200px;\n    }\n}\n",{"version":3,"sources":["order.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAs8CA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"order.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n    <div>\n        <app-head></app-head>\n        <app-body>\n            <div class=\"order-container\" v-loading=\"isLoading\">\n                <el-card class=\"order-card\" shadow=\"hover\" v-if=\"orderInfo\">\n                    <div slot=\"header\" class=\"card-header\">\n                        <h2 class=\"order-title\">\n                            <i class=\"el-icon-shopping-bag-2\"></i> 订单详情\n                        </h2>\n                </div>\n                \n                    <!-- 订单信息 -->\n                    <div class=\"order-info-section\">\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">订单编号：</span>\n                            <span class=\"info-value\">{{ orderInfo.orderNumber }}</span>\n                            </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">订单状态：</span>\n                            <el-tag :type=\"getStatusType(orderInfo.orderStatus)\" size=\"medium\">\n                                {{ getStatusText(orderInfo.orderStatus) }}\n                        </el-tag>\n                            </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">支付状态：</span>\n                            <el-tag :type=\"orderInfo.paymentStatus === 1 ? 'success' : 'warning'\" size=\"medium\">\n                                {{ orderInfo.paymentStatus === 1 ? '已支付' : '待支付' }}\n                            </el-tag>\n                        </div>\n                        <!-- 资金状态（卖家视角，订单已完成时显示） -->\n                        <div class=\"info-row\" v-if=\"isSeller && orderInfo.orderStatus === 3 && orderInfo.paymentStatus === 1\">\n                            <span class=\"info-label\">资金状态：</span>\n                            <el-tag :type=\"getFundStatusType(orderInfo.fundStatus)\" size=\"medium\">\n                                {{ getFundStatusText(orderInfo.fundStatus) }}\n                            </el-tag>\n                            <span v-if=\"orderInfo.fundStatus === 0 && orderInfo.finishTime\" class=\"fund-hint\">\n                                （预计 {{ getFundReleaseDate(orderInfo.finishTime) }} 释放）\n                            </span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">订单金额：</span>\n                            <span class=\"info-value price\">¥{{ orderInfo.orderPrice }}</span>\n                        </div>\n                        <div class=\"info-row\" v-if=\"orderInfo.createTime\">\n                            <span class=\"info-label\">创建时间：</span>\n                            <span class=\"info-value\">{{ formatTime(orderInfo.createTime) }}</span>\n                        </div>\n                        <div class=\"info-row\" v-if=\"orderInfo.finishTime\">\n                            <span class=\"info-label\">完成时间：</span>\n                            <span class=\"info-value\">{{ formatTime(orderInfo.finishTime) }}</span>\n                    </div>\n                </div>\n                \n                    <!-- 商品信息 -->\n                    <el-divider></el-divider>\n                    <div class=\"product-info-section\" v-if=\"orderInfo.idleItem\">\n                        <h3 class=\"section-title\">商品信息</h3>\n                        <div class=\"product-card\">\n                        <el-image\n                                v-if=\"productImage\"\n                                :src=\"productImage\"\n                                fit=\"cover\"\n                                class=\"product-image\">\n                        </el-image>\n                            <div class=\"product-details\">\n                                <h4 class=\"product-name\">{{ orderInfo.idleItem.idleName }}</h4>\n                                <div class=\"product-price-info\">\n                                    <span class=\"product-price\">¥{{ orderInfo.idleItem.idlePrice }}</span>\n                            </div>\n                        </div>\n                    </div>\n                    </div>\n\n                    <!-- 卖家信息（买家视角） -->\n                    <el-divider></el-divider>\n                    <div class=\"seller-info-section\" v-if=\"orderInfo.idleItem && isBuyer\">\n                        <h3 class=\"section-title\">卖家信息</h3>\n                        <div class=\"seller-card\">\n                            <el-avatar \n                                v-if=\"sellerAvatar\"\n                                :src=\"sellerAvatar\" \n                                :size=\"50\"\n                                class=\"seller-avatar\">\n                            </el-avatar>\n                            <el-avatar \n                                v-else\n                                :size=\"50\"\n                                icon=\"el-icon-user-solid\"\n                                class=\"seller-avatar\">\n                            </el-avatar>\n                            <div class=\"seller-details\">\n                                <div class=\"seller-name\">\n                                    <span class=\"seller-label\">卖家：</span>\n                                    <span class=\"seller-value\">{{ sellerName || '未知卖家' }}</span>\n                                </div>\n                                <div class=\"seller-actions\">\n                        <el-button \n                                        type=\"primary\" \n                                        size=\"small\"\n                                        icon=\"el-icon-chat-line-round\"\n                                        @click=\"goToChat\">\n                                        联系卖家\n                        </el-button>\n                    </div>\n                            </div>\n                        </div>\n                        </div>\n\n                    <!-- 买家信息（卖家视角） -->\n                    <el-divider></el-divider>\n                    <div class=\"buyer-info-section\" v-if=\"orderInfo.user && isSeller\">\n                        <h3 class=\"section-title\">买家信息</h3>\n                        <div class=\"buyer-card\">\n                            <el-avatar \n                                v-if=\"buyerAvatar\"\n                                :src=\"buyerAvatar\" \n                                :size=\"50\"\n                                class=\"buyer-avatar\">\n                            </el-avatar>\n                            <el-avatar \n                                v-else\n                                :size=\"50\"\n                                icon=\"el-icon-user-solid\"\n                                class=\"buyer-avatar\">\n                            </el-avatar>\n                            <div class=\"buyer-details\">\n                                <div class=\"buyer-name\">\n                                    <span class=\"buyer-label\">买家：</span>\n                                    <span class=\"buyer-value\">{{ buyerName || '未知买家' }}</span>\n                                </div>\n                                <div class=\"buyer-actions\">\n                                <el-button\n                                        type=\"primary\"\n                                        size=\"small\"\n                                        icon=\"el-icon-chat-line-round\"\n                                        @click=\"goToChatWithBuyer\">\n                                        联系买家\n                                </el-button>\n                    </div>\n                    </div>\n                                    </div>\n                                    </div>\n\n                    <!-- 交易地点导航（待发货/待收货时显示） -->\n                    <el-divider></el-divider>\n                    <div class=\"location-navigation-section\" v-if=\"showLocationNavigation\">\n                        <h3 class=\"section-title\">\n                            <i class=\"el-icon-location-outline\"></i> 交易地点导航\n                        </h3>\n                        <div class=\"location-info-card\">\n                            <div class=\"location-info-item full-width\">\n                                <span class=\"location-label\">卖家地址：</span>\n                                <span class=\"location-value\" v-if=\"sellerLocation\">{{ sellerLocation.formattedAddress || sellerLocation.address }}</span>\n                                <span class=\"location-value text-warning\" v-else>{{ orderInfo.idleItem.idlePlace || '未填写' }}</span>\n                    </div>\n                            <div class=\"location-info-item full-width\">\n                                <span class=\"location-label\">买家地址：</span>\n                                <span class=\"location-value\" v-if=\"buyerLocation\">{{ buyerLocation.formattedAddress || buyerLocation.address }}</span>\n                                <span class=\"location-value text-warning\" v-else-if=\"buyerAddressText\">{{ buyerAddressText }}</span>\n                                <span class=\"location-value text-warning\" v-else>未填写或解析失败</span>\n                                    </div>\n                            <div class=\"location-info-item\" v-if=\"distanceText\">\n                                <span class=\"location-label\">距离：</span>\n                                <span class=\"location-value\">{{ distanceText }}</span>\n                                    </div>\n                            <div class=\"location-info-item\" v-if=\"distanceKm\">\n                                <span class=\"location-label\">建议：</span>\n                                <el-tag :type=\"distanceKm <= 3 ? 'success' : 'warning'\" size=\"small\">\n                                    {{ distanceKm <= 3 ? '适合面交' : '建议快递' }}\n                                </el-tag>\n                                </div>\n                                    </div>\n                        <el-alert\n                            v-if=\"!sellerLocation || !buyerLocation\"\n                            title=\"地址解析提示\"\n                            type=\"info\"\n                            :closable=\"false\"\n                            show-icon\n                            style=\"margin-bottom: 15px;\">\n                            <div slot=\"default\">\n                                <p style=\"margin: 0; line-height: 1.6; font-size: 13px;\">\n                                    <strong>地址格式建议：</strong><br/>\n                                    • 完整格式：城市+详细地址，例如：\"北京市清华大学\"、\"上海市复旦大学\"<br/>\n                                    • 学校名称：可以直接填写学校名称，例如：\"清华大学\"、\"复旦大学\"<br/>\n                                    • 详细地址：包含城市、区县、街道等，例如：\"北京市海淀区清华大学\"<br/>\n                                    <span style=\"color: #909399;\">如果地址解析失败，请检查地址是否包含城市信息</span>\n                                </p>\n                                    </div>\n                        </el-alert>\n                        <div class=\"map-container\" ref=\"mapContainer\" id=\"order-map-container\"></div>\n                        <div class=\"map-actions\">\n                            <!-- 买家视角：只显示导航到卖家 -->\n                            <el-button \n                                v-if=\"isBuyer\"\n                                type=\"primary\" \n                                size=\"small\"\n                                icon=\"el-icon-location\"\n                                @click=\"navigateToSeller\"\n                                :disabled=\"!sellerLocation && !(orderInfo.idleItem && orderInfo.idleItem.idlePlace)\">\n                                导航到卖家位置\n                            </el-button>\n                            <!-- 卖家视角：只显示导航到买家 -->\n                            <el-button \n                                v-if=\"isSeller\"\n                                type=\"success\" \n                                size=\"small\"\n                                icon=\"el-icon-location\"\n                                @click=\"navigateToBuyer\"\n                                :disabled=\"!buyerLocation && !buyerAddressText\">\n                                导航到买家位置\n                            </el-button>\n                            <el-button \n                                type=\"info\" \n                                size=\"small\"\n                                icon=\"el-icon-refresh\"\n                                @click=\"refreshMap\">\n                                刷新地图\n                            </el-button>\n                                </div>\n                    </div>\n\n                    <!-- 售后申请信息（卖家视角） -->\n                    <el-divider></el-divider>\n                    <div class=\"after-sale-section\" v-if=\"isSeller && afterSaleInfo\">\n                        <h3 class=\"section-title\">售后申请</h3>\n                        <el-alert\n                            :title=\"getAfterSaleStatusText(afterSaleInfo.applicationStatus)\"\n                            :type=\"getAfterSaleStatusType(afterSaleInfo.applicationStatus)\"\n                            :closable=\"false\"\n                            show-icon>\n                        </el-alert>\n                        <div class=\"after-sale-details\" style=\"margin-top: 15px;\">\n                            <el-descriptions :column=\"2\" border size=\"small\">\n                                <el-descriptions-item label=\"申请类型\">\n                                    <el-tag size=\"small\">{{ getApplicationTypeText(afterSaleInfo.applicationType) }}</el-tag>\n                                </el-descriptions-item>\n                                <el-descriptions-item label=\"退款金额\">\n                                    <span style=\"color: #f56c6c; font-weight: bold;\">¥{{ afterSaleInfo.refundAmount }}</span>\n                                </el-descriptions-item>\n                                <el-descriptions-item label=\"问题描述\" :span=\"2\">{{ afterSaleInfo.problemDescription }}</el-descriptions-item>\n                                <el-descriptions-item label=\"申请时间\" :span=\"2\">{{ formatTime(afterSaleInfo.createTime) }}</el-descriptions-item>\n                            </el-descriptions>\n                            \n                            <!-- 证据图片 -->\n                            <div v-if=\"afterSaleInfo.evidenceImages\" style=\"margin-top: 15px;\">\n                                <p style=\"margin-bottom: 10px;\"><strong>买家证据图片：</strong></p>\n                                <div class=\"evidence-images\">\n                                    <el-image\n                                        v-for=\"(img, index) in getEvidenceImages(afterSaleInfo.evidenceImages)\"\n                                        :key=\"index\"\n                                        :src=\"img\"\n                                        :preview-src-list=\"getEvidenceImages(afterSaleInfo.evidenceImages)\"\n                                        fit=\"cover\"\n                                        class=\"evidence-image\">\n                                    </el-image>\n                    </div>\n                                </div>\n                    </div>\n                    </div>\n\n                    <!-- 操作按钮 -->\n                    <el-divider></el-divider>\n                    <div class=\"action-buttons\">\n                        <!-- 买家操作 -->\n                        <template v-if=\"isBuyer\">\n                        <el-button \n                                v-if=\"orderInfo.orderStatus === 0 && orderInfo.paymentStatus === 0\"\n                            type=\"primary\" \n                                size=\"large\"\n                            icon=\"el-icon-wallet\" \n                                @click=\"goToPay\">\n                                立即支付\n                            </el-button>\n                        <el-button \n                                v-if=\"orderInfo.orderStatus === 2\"\n                            type=\"success\" \n                                size=\"large\"\n                            icon=\"el-icon-check\" \n                                @click=\"confirmReceive\">\n                                确认收货\n                            </el-button>\n                            <el-button \n                                v-if=\"orderInfo.orderStatus === 3\"\n                                type=\"warning\" \n                                size=\"large\"\n                                icon=\"el-icon-warning-outline\" \n                                @click=\"openAfterSaleDialog\">\n                                申请售后\n                            </el-button>\n                        </template>\n                        \n                        <!-- 卖家操作 -->\n                        <template v-if=\"isSeller\">\n                            <el-button \n                                v-if=\"afterSaleInfo && (afterSaleInfo.applicationStatus === 0 || afterSaleInfo.applicationStatus === 1 || afterSaleInfo.applicationStatus === 2)\"\n                                type=\"warning\" \n                                size=\"large\"\n                                icon=\"el-icon-s-check\" \n                                @click=\"openSellerReviewDialog\">\n                                审核售后申请\n                            </el-button>\n                            <el-button \n                                v-if=\"orderInfo.orderStatus === 1 && orderInfo.paymentStatus === 1\"\n                                type=\"warning\" \n                                size=\"large\"\n                                icon=\"el-icon-truck\" \n                                @click=\"confirmShip\">\n                                确认发货\n                            </el-button>\n                        </template>\n                        \n                        <el-button \n                            type=\"default\" \n                            size=\"large\"\n                            icon=\"el-icon-back\"\n                            @click=\"goBack\">\n                            返回\n                            </el-button>\n                        </div>\n                </el-card>\n\n                <!-- 订单不存在 -->\n                <el-card v-else class=\"order-card\" shadow=\"hover\">\n                    <div class=\"empty-state\">\n                        <i class=\"el-icon-warning-outline\"></i>\n                        <p>订单不存在或已删除</p>\n                        <el-button type=\"primary\" @click=\"goBack\">返回</el-button>\n                    </div>\n                </el-card>\n            </div>\n            <app-foot></app-foot>\n        </app-body>\n\n        <!-- 申请售后弹窗 -->\n                <el-dialog\n            title=\"申请售后\"\n            :visible.sync=\"afterSaleDialogVisible\"\n                    width=\"600px\"\n            @close=\"resetAfterSaleForm\">\n            <el-form :model=\"afterSaleForm\" :rules=\"afterSaleRules\" ref=\"afterSaleForm\" label-width=\"100px\">\n                <el-form-item label=\"申请类型\" prop=\"applicationType\">\n                    <el-select v-model=\"afterSaleForm.applicationType\" placeholder=\"请选择申请类型\" style=\"width: 100%\">\n                        <el-option label=\"质量问题\" :value=\"1\"></el-option>\n                        <el-option label=\"描述不符\" :value=\"2\"></el-option>\n                        <el-option label=\"未收到货\" :value=\"3\"></el-option>\n                        <el-option label=\"其他\" :value=\"4\"></el-option>\n                    </el-select>\n                </el-form-item>\n                <el-form-item label=\"问题描述\" prop=\"problemDescription\">\n                    <el-input\n                        type=\"textarea\"\n                        :rows=\"4\"\n                        v-model=\"afterSaleForm.problemDescription\"\n                        placeholder=\"请详细描述遇到的问题...\"\n                        maxlength=\"500\"\n                        show-word-limit>\n                    </el-input>\n                </el-form-item>\n                <el-form-item label=\"证据图片\">\n                    <el-upload\n                        class=\"evidence-uploader\"\n                        :action=\"'/api/file'\"\n                        :show-file-list=\"true\"\n                        :file-list=\"evidenceFileList\"\n                        :on-success=\"handleEvidenceSuccess\"\n                        :on-remove=\"handleEvidenceRemove\"\n                        :before-upload=\"beforeEvidenceUpload\"\n                        list-type=\"picture\"\n                        accept=\"image/*\"\n                        multiple>\n                        <el-button size=\"small\" type=\"primary\" icon=\"el-icon-upload\">上传图片</el-button>\n                        <div slot=\"tip\" class=\"el-upload__tip\">支持上传多张图片，每张不超过5MB</div>\n                    </el-upload>\n                </el-form-item>\n                <el-form-item label=\"退款金额\">\n                    <el-input-number\n                        v-model=\"afterSaleForm.refundAmount\"\n                        :precision=\"2\"\n                        :min=\"0\"\n                        :max=\"orderInfo ? orderInfo.orderPrice : 0\"\n                        style=\"width: 100%\">\n                    </el-input-number>\n                    <div style=\"color: #909399; font-size: 12px; margin-top: 5px;\">\n                        最多可申请退款：¥{{ orderInfo ? orderInfo.orderPrice : 0 }}\n                        </div>\n                </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"afterSaleDialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"submitAfterSale\" :loading=\"afterSaleSubmitting\">提 交</el-button>\n            </span>\n        </el-dialog>\n\n        <!-- 卖家审核售后申请弹窗 -->\n        <el-dialog\n            title=\"审核售后申请\"\n            :visible.sync=\"sellerReviewDialogVisible\"\n            width=\"600px\"\n            @close=\"resetSellerReviewForm\">\n            <el-form :model=\"sellerReviewForm\" :rules=\"sellerReviewRules\" ref=\"sellerReviewForm\" label-width=\"100px\">\n                <el-form-item label=\"申请类型\">\n                    <el-input :value=\"getApplicationTypeText(afterSaleInfo && afterSaleInfo.applicationType)\" disabled></el-input>\n                </el-form-item>\n                <el-form-item label=\"退款金额\">\n                    <el-input :value=\"'¥' + (afterSaleInfo && afterSaleInfo.refundAmount)\" disabled></el-input>\n                </el-form-item>\n                <el-form-item label=\"问题描述\">\n                    <el-input type=\"textarea\" :value=\"afterSaleInfo && afterSaleInfo.problemDescription\" disabled :rows=\"3\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"审核结果\" prop=\"reviewResult\">\n                    <el-radio-group v-model=\"sellerReviewForm.reviewResult\">\n                        <el-radio :label=\"1\">同意申请</el-radio>\n                        <el-radio :label=\"2\">拒绝申请</el-radio>\n                    </el-radio-group>\n                </el-form-item>\n                <el-form-item label=\"拒绝原因\" prop=\"rejectReason\" v-if=\"sellerReviewForm.reviewResult === 2\">\n                            <el-input\n                                type=\"textarea\"\n                        :rows=\"4\"\n                        placeholder=\"请填写拒绝原因\"\n                        v-model=\"sellerReviewForm.rejectReason\"\n                                maxlength=\"200\"\n                                show-word-limit>\n                            </el-input>\n                </el-form-item>\n                <el-form-item label=\"卖家举证图片\">\n                    <el-upload\n                        :action=\"'/api/file'\"\n                        list-type=\"picture-card\"\n                        :on-success=\"handleSellerEvidenceUploadSuccess\"\n                        :on-remove=\"handleSellerEvidenceUploadRemove\"\n                        :before-upload=\"beforeAfterSaleUpload\"\n                        :file-list=\"sellerEvidenceUploadList\"\n                        :limit=\"3\"\n                        accept=\"image/*\">\n                        <i class=\"el-icon-plus\"></i>\n                    </el-upload>\n                    <div slot=\"tip\" class=\"el-upload__tip\">最多上传3张图片，每张不超过5MB</div>\n                </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"sellerReviewDialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"submitSellerReview\" :loading=\"sellerReviewSubmitting\">提 交</el-button>\n            </span>\n                </el-dialog>\n\n        <!-- 空状态提示 -->\n        <el-card v-if=\"!isLoading && !orderInfo\" class=\"order-card\" shadow=\"hover\">\n            <el-empty description=\"订单不存在或加载失败\">\n                <el-button type=\"primary\" @click=\"$router.push('/index')\">返回首页</el-button>\n            </el-empty>\n        </el-card>\n    </div>\n</template>\n\n<script>\n    import AppHead from '../common/AppHeader.vue';\n    import AppBody from '../common/AppPageBody.vue';\n    import AppFoot from '../common/AppFoot.vue';\n    import { \n        initMap, \n        geocodeAddress, \n        addMarker, \n        calculateDistance, \n        formatDistance, \n        fitMapView, \n        openNavigation \n    } from '../../utils/mapUtil';\n\n    export default {\n        name: \"order\",\n        components: {\n            AppHead,\n            AppBody,\n            AppFoot\n        },\n        data() {\n            return {\n                isLoading: false,\n                orderInfo: null,\n                productImage: '',\n                sellerName: '',\n                sellerAvatar: '',\n                buyerName: '',\n                buyerAvatar: '',\n                currentUserId: null,\n                isBuyer: false,\n                isSeller: false,\n                // 申请售后相关\n                afterSaleDialogVisible: false,\n                afterSaleSubmitting: false,\n                afterSaleForm: {\n                    applicationType: null,\n                    problemDescription: '',\n                    refundAmount: 0,\n                    evidenceImages: []\n                },\n                evidenceFileList: [],\n                afterSaleRules: {\n                    applicationType: [\n                        { required: true, message: '请选择申请类型', trigger: 'change' }\n                    ],\n                    problemDescription: [\n                        { required: true, message: '请填写问题描述', trigger: 'blur' },\n                        { min: 10, max: 500, message: '问题描述长度在10到500个字符', trigger: 'blur' }\n                    ]\n                },\n                afterSaleInfo: null, // 售后申请信息\n                // 卖家审核售后相关\n                sellerReviewDialogVisible: false,\n                sellerReviewSubmitting: false,\n                sellerReviewForm: {\n                    reviewResult: 1,\n                    rejectReason: '',\n                    sellerEvidenceImages: []\n                },\n                sellerReviewRules: {\n                    reviewResult: [\n                        { required: true, message: '请选择审核结果', trigger: 'change' }\n                    ],\n                    rejectReason: [\n                        { required: true, message: '拒绝申请时必须填写拒绝原因', trigger: 'blur' }\n                    ]\n                },\n                sellerEvidenceUploadList: [],\n                // 地图相关\n                map: null,\n                sellerLocation: null, // 卖家位置 {lng, lat, address}\n                buyerLocation: null, // 买家位置 {lng, lat, address}\n                buyerAddressText: '', // 买家地址原始文本（即使解析失败也显示）\n                distanceKm: null, // 距离（公里）\n                distanceText: '', // 距离文本\n                geocoder: null // 地址解析器\n            };\n        },\n        computed: {\n            // 是否显示交易地点导航（待发货或待收货时显示）\n            showLocationNavigation() {\n                if (!this.orderInfo) return false;\n                // 订单状态：1-待发货，2-待收货\n                // 且已支付\n                return (this.orderInfo.orderStatus === 1 || this.orderInfo.orderStatus === 2) \n                    && this.orderInfo.paymentStatus === 1\n                    && this.orderInfo.idleItem \n                    && this.orderInfo.idleItem.idlePlace;\n            }\n        },\n        created() {\n            this.currentUserId = this.getCookie('shUserId');\n            this.loadOrderInfo();\n        },\n        mounted() {\n            // 等待DOM更新后再初始化地图\n            this.$nextTick(() => {\n                if (this.showLocationNavigation) {\n                    this.initMap();\n                }\n            });\n        },\n        watch: {\n            showLocationNavigation(newVal) {\n                if (newVal) {\n                    this.$nextTick(() => {\n                        this.initMap();\n                    });\n                        } else {\n                    this.destroyMap();\n                }\n            }\n        },\n        methods: {\n            loadOrderInfo() {\n                const orderId = this.$route.query.id;\n                if (!orderId) {\n                    this.$message.error('订单ID不存在');\n                    this.$router.push('/index');\n                    return;\n                }\n\n                this.isLoading = true;\n                this.$api.getOrder({ id: orderId }).then(res => {\n                    if (res.status_code === 1 && res.data) {\n                        this.orderInfo = res.data;\n                        \n                        // 判断当前用户是买家还是卖家\n                        if (this.currentUserId) {\n                            const currentUserIdNum = parseInt(this.currentUserId);\n                            this.isBuyer = this.orderInfo.userId === currentUserIdNum;\n                            this.isSeller = this.orderInfo.idleItem && \n                                          this.orderInfo.idleItem.userId === currentUserIdNum;\n                        }\n                        \n                        // 处理商品图片\n                        if (this.orderInfo.idleItem && this.orderInfo.idleItem.pictureList) {\n                            try {\n                                const pictureList = JSON.parse(this.orderInfo.idleItem.pictureList);\n                                if (pictureList && pictureList.length > 0) {\n                                    this.productImage = pictureList[0];\n                                }\n                            } catch (e) {\n                                console.error('解析商品图片失败:', e);\n                            }\n                        }\n                        \n                        // 处理卖家信息\n                        if (this.orderInfo.idleItem) {\n                            if (this.orderInfo.idleItem.user) {\n                                this.sellerName = this.orderInfo.idleItem.user.nickname || '未知卖家';\n                                this.sellerAvatar = this.orderInfo.idleItem.user.avatar || '';\n                            } else if (this.orderInfo.idleItem.userId) {\n                                // 如果没有user对象，但有userId，尝试获取用户信息\n                                this.loadSellerInfo(this.orderInfo.idleItem.userId);\n                            }\n                        }\n                        \n                        // 加载售后申请信息\n                        this.loadAfterSaleInfo();\n                        \n                        // 处理买家信息\n                        if (this.orderInfo.user) {\n                            this.buyerName = this.orderInfo.user.nickname || '未知买家';\n                            this.buyerAvatar = this.orderInfo.user.avatar || '';\n                        }\n                        \n                        // 加载买家地址（无论是否显示地图都需要加载，用于显示）\n                        this.loadBuyerAddressForDisplay();\n                        \n                        // 如果显示地图，初始化地图\n                        if (this.showLocationNavigation) {\n                            this.$nextTick(() => {\n                                this.initMap();\n                            });\n                        }\n                    } else {\n                        this.$message.error(res.msg || '订单不存在');\n                        this.orderInfo = null;\n                    }\n                }).catch(e => {\n                    console.error('获取订单信息失败:', e);\n                    this.$message.error('获取订单信息失败');\n                    this.orderInfo = null;\n                }).finally(() => {\n                    this.isLoading = false;\n                });\n            },\n            goToPay() {\n                if (!this.orderInfo || !this.orderInfo.id) {\n                    this.$message.error('订单信息不存在');\n                    return;\n                }\n\n                // 确认支付\n                this.$confirm('确认支付 ¥' + this.orderInfo.orderPrice + ' 吗？', '确认支付', {\n                    confirmButtonText: '确认支付',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    // 调用模拟支付接口\n                    this.$api.simulatePay({\n                        orderId: this.orderInfo.id\n                    }).then(res => {\n                        if (res.status_code === 1) {\n                            this.$message.success('支付成功！');\n                            // 跳转到支付成功页面\n                            this.$router.push({\n                                path: '/alipay/pay',\n                                query: {\n                                    orderNumber: this.orderInfo.orderNumber,\n                                    price: this.orderInfo.orderPrice,\n                                    orderId: this.orderInfo.id\n                                }\n                            });\n                        } else {\n                            this.$message.error(res.msg || '支付失败，请稍后重试');\n                        }\n                    }).catch(e => {\n                        console.error('支付失败:', e);\n                        this.$message.error('支付失败，请稍后重试');\n                    });\n                }).catch(() => {\n                    // 用户取消支付\n                });\n            },\n            goBack() {\n                this.$router.go(-1);\n            },\n            loadSellerInfo(userId) {\n                // 如果后端没有返回user信息，可以尝试通过API获取\n                // 这里暂时不实现，因为通常后端应该返回完整的user信息\n                console.log('卖家ID:', userId);\n            },\n            getCookie(cname) {\n                const name = cname + \"=\";\n                const ca = document.cookie.split(';');\n                for (let i = 0; i < ca.length; i++) {\n                    let c = ca[i].trim();\n                    if (c.indexOf(name) === 0) return c.substring(name.length, c.length);\n                }\n                return \"\";\n            },\n            goToChat() {\n                if (!this.orderInfo || !this.orderInfo.idleItem) {\n                    this.$message.error('商品信息不存在');\n                    return;\n                }\n                const sellerId = this.orderInfo.idleItem.userId;\n                const idleId = this.orderInfo.idleItem.id;\n                if (!sellerId) {\n                    this.$message.error('卖家信息不存在');\n                    return;\n                }\n                // 跳转到私信页面\n                this.$router.push({\n                    path: '/chat',\n                    query: {\n                        targetUserId: sellerId,\n                        idleId: idleId\n                    }\n                });\n            },\n            goToChatWithBuyer() {\n                if (!this.orderInfo || !this.orderInfo.userId) {\n                    this.$message.error('买家信息不存在');\n                    return;\n                }\n                const buyerId = this.orderInfo.userId;\n                const idleId = this.orderInfo.idleItem ? this.orderInfo.idleItem.id : null;\n                // 跳转到私信页面\n                this.$router.push({\n                    path: '/chat',\n                    query: {\n                        targetUserId: buyerId,\n                        idleId: idleId\n                    }\n                });\n            },\n            confirmShip() {\n                this.$confirm('确认已发货吗？', '确认发货', {\n                    confirmButtonText: '确认',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    this.$api.updateOrder({\n                        id: this.orderInfo.id,\n                        orderStatus: 2 // 待收货\n                    }).then(res => {\n                    if (res.status_code === 1) {\n                            this.$message.success('发货成功！');\n                            this.loadOrderInfo(); // 刷新订单信息\n                        } else {\n                            this.$message.error(res.msg || '发货失败');\n                        }\n                    }).catch(e => {\n                        console.error('发货失败:', e);\n                        this.$message.error('发货失败，请稍后重试');\n                    });\n                }).catch(() => {});\n            },\n            confirmReceive() {\n                this.$confirm('确认已收到商品吗？', '确认收货', {\n                    confirmButtonText: '确认',\n                            cancelButtonText: '取消',\n                            type: 'warning'\n                        }).then(() => {\n                            this.$api.updateOrder({\n                        id: this.orderInfo.id,\n                        orderStatus: 3 // 已完成\n                            }).then(res => {\n                                if (res.status_code === 1) {\n                            this.$message.success('确认收货成功！');\n                            this.loadOrderInfo(); // 刷新订单信息\n                        } else {\n                            this.$message.error(res.msg || '确认收货失败');\n                        }\n                    }).catch(e => {\n                        console.error('确认收货失败:', e);\n                        this.$message.error('确认收货失败，请稍后重试');\n                    });\n                }).catch(() => {});\n            },\n            getStatusType(status) {\n                const types = {\n                    0: 'warning',  // 待付款\n                    1: 'info',     // 待发货\n                    2: 'primary',  // 待收货\n                    3: 'success',  // 已完成\n                    4: 'danger'    // 已取消\n                };\n                return types[status] || 'info';\n            },\n            getStatusText(status) {\n                const texts = {\n                    0: '待付款',\n                    1: '待发货',\n                    2: '待收货',\n                    3: '已完成',\n                    4: '已取消'\n                };\n                return texts[status] || '未知状态';\n            },\n            formatTime(time) {\n                if (!time) return '';\n                return time.toString().substring(0, 19).replace('T', ' ');\n            },\n            openAfterSaleDialog() {\n                // 检查是否已有售后申请\n                if (this.orderInfo && this.orderInfo.id) {\n                    this.$api.getAfterSaleByOrderId({ orderId: this.orderInfo.id }).then(res => {\n                        if (res.status_code === 1 && res.data) {\n                            this.$message.warning('该订单已有售后申请，请勿重复申请');\n                        } else {\n                            // 初始化表单\n                            this.afterSaleForm.refundAmount = this.orderInfo ? this.orderInfo.orderPrice : 0;\n                            this.afterSaleDialogVisible = true;\n                        }\n                    }).catch(e => {\n                        console.error('检查售后申请失败:', e);\n                        this.afterSaleForm.refundAmount = this.orderInfo ? this.orderInfo.orderPrice : 0;\n                        this.afterSaleDialogVisible = true;\n                    });\n                }\n            },\n            resetAfterSaleForm() {\n                if (this.$refs.afterSaleForm) {\n                    this.$refs.afterSaleForm.resetFields();\n                }\n                this.afterSaleForm = {\n                    applicationType: null,\n                    problemDescription: '',\n                    refundAmount: 0,\n                    evidenceImages: []\n                };\n                this.evidenceFileList = [];\n            },\n            beforeAfterSaleUpload(file) {\n                const isImage = file.type.startsWith('image/');\n                const isLt5M = file.size / 1024 / 1024 < 5;\n\n                if (!isImage) {\n                    this.$message.error('只能上传图片文件!');\n                    return false;\n                }\n                if (!isLt5M) {\n                    this.$message.error('图片大小不能超过 5MB!');\n                    return false;\n                }\n                return true;\n            },\n            beforeEvidenceUpload(file) {\n                const isImage = file.type.startsWith('image/');\n                const isLt5M = file.size / 1024 / 1024 < 5;\n\n                if (!isImage) {\n                    this.$message.error('只能上传图片文件!');\n                    return false;\n                }\n                if (!isLt5M) {\n                    this.$message.error('图片大小不能超过5MB!');\n                    return false;\n                }\n                return true;\n            },\n            handleEvidenceSuccess(res, file) {\n                let imageUrl = '';\n                if (res.status_code === 1 && res.data) {\n                    imageUrl = res.data;\n                } else if (typeof res === 'string') {\n                    try {\n                        const parsed = JSON.parse(res);\n                        if (parsed.status_code === 1 && parsed.data) {\n                            imageUrl = parsed.data;\n                        }\n                    } catch (e) {\n                        console.error('解析上传响应失败:', e);\n                    }\n                }\n                \n                if (imageUrl) {\n                    this.afterSaleForm.evidenceImages.push(imageUrl);\n                    this.$message.success('图片上传成功');\n                } else {\n                    this.$message.error('图片上传失败');\n                }\n            },\n            handleEvidenceRemove(file, fileList) {\n                // 从证据图片列表中移除\n                if (file.response && file.response.data) {\n                    const index = this.afterSaleForm.evidenceImages.indexOf(file.response.data);\n                    if (index > -1) {\n                        this.afterSaleForm.evidenceImages.splice(index, 1);\n                    }\n                } else if (file.url) {\n                    const index = this.afterSaleForm.evidenceImages.indexOf(file.url);\n                    if (index > -1) {\n                        this.afterSaleForm.evidenceImages.splice(index, 1);\n                    }\n                }\n            },\n            submitAfterSale() {\n                this.$refs.afterSaleForm.validate((valid) => {\n                    if (!valid) {\n                        return false;\n                    }\n\n                    if (this.afterSaleForm.evidenceImages.length === 0) {\n                        this.$message.warning('请至少上传一张证据图片');\n                        return;\n                    }\n\n                    this.afterSaleSubmitting = true;\n                    const formData = {\n                        orderId: this.orderInfo.id,\n                        applicationType: this.afterSaleForm.applicationType,\n                        problemDescription: this.afterSaleForm.problemDescription,\n                        evidenceImages: JSON.stringify(this.afterSaleForm.evidenceImages),\n                        refundAmount: this.afterSaleForm.refundAmount\n                    };\n\n                    this.$api.applyAfterSale(formData).then(res => {\n                                if (res.status_code === 1) {\n                            this.$message.success('售后申请提交成功，等待卖家审核');\n                            this.afterSaleDialogVisible = false;\n                            this.loadOrderInfo(); // 刷新订单信息\n                        } else {\n                            this.$message.error(res.msg || '申请失败，请稍后重试');\n                        }\n                    }).catch(e => {\n                        console.error('提交售后申请失败:', e);\n                        this.$message.error('申请失败，请稍后重试');\n                    }).finally(() => {\n                        this.afterSaleSubmitting = false;\n                    });\n                });\n            },\n            loadAfterSaleInfo() {\n                if (!this.orderInfo || !this.orderInfo.id) return;\n                this.$api.getAfterSaleByOrderId({ orderId: this.orderInfo.id }).then(res => {\n                    if (res.status_code === 1 && res.data) {\n                        this.afterSaleInfo = res.data;\n                } else {\n                        this.afterSaleInfo = null;\n                    }\n                }).catch(e => {\n                    console.error('加载售后申请信息失败:', e);\n                    this.afterSaleInfo = null;\n                });\n            },\n            openSellerReviewDialog() {\n                if (!this.afterSaleInfo) {\n                    this.$message.warning('售后申请信息不存在');\n                    return;\n                }\n                this.sellerReviewForm.reviewResult = 1;\n                this.sellerReviewForm.rejectReason = '';\n                this.sellerReviewForm.sellerEvidenceImages = [];\n                this.sellerEvidenceUploadList = [];\n                this.sellerReviewDialogVisible = true;\n            },\n            resetSellerReviewForm() {\n                if (this.$refs.sellerReviewForm) {\n                    this.$refs.sellerReviewForm.resetFields();\n                }\n                this.sellerReviewForm = {\n                    reviewResult: 1,\n                    rejectReason: '',\n                    sellerEvidenceImages: []\n                };\n                this.sellerEvidenceUploadList = [];\n            },\n            handleSellerEvidenceUploadSuccess(response, file, fileList) {\n                if (response.status_code === 1 && response.data) {\n                    this.sellerReviewForm.sellerEvidenceImages.push(response.data);\n                    this.$message.success('图片上传成功');\n                    } else {\n                    this.$message.error('图片上传失败');\n                }\n            },\n            handleSellerEvidenceUploadRemove(file, fileList) {\n                if (file.response && file.response.data) {\n                    const index = this.sellerReviewForm.sellerEvidenceImages.indexOf(file.response.data);\n                    if (index > -1) {\n                        this.sellerReviewForm.sellerEvidenceImages.splice(index, 1);\n                    }\n                } else if (file.url) {\n                    const index = this.sellerReviewForm.sellerEvidenceImages.indexOf(file.url);\n                    if (index > -1) {\n                        this.sellerReviewForm.sellerEvidenceImages.splice(index, 1);\n                    }\n                }\n            },\n            submitSellerReview() {\n                this.$refs.sellerReviewForm.validate((valid) => {\n                    if (!valid) {\n                        return false;\n                    }\n                    \n                    if (this.sellerReviewForm.reviewResult === 2 && !this.sellerReviewForm.rejectReason) {\n                        this.$message.warning('拒绝申请时必须填写拒绝原因');\n                    return;\n                }\n                    \n                    this.sellerReviewSubmitting = true;\n                    const formData = {\n                        id: this.afterSaleInfo.id,\n                        reviewResult: this.sellerReviewForm.reviewResult,\n                        rejectReason: this.sellerReviewForm.rejectReason || null,\n                        sellerEvidenceImages: this.sellerReviewForm.sellerEvidenceImages.length > 0 \n                            ? JSON.stringify(this.sellerReviewForm.sellerEvidenceImages) \n                            : null\n                    };\n                    \n                    this.$api.reviewAfterSale(formData).then(res => {\n                    if (res.status_code === 1) {\n                            this.$message.success('审核成功');\n                            this.sellerReviewDialogVisible = false;\n                            this.loadAfterSaleInfo(); // 刷新售后申请信息\n                            this.loadOrderInfo(); // 刷新订单信息\n                    } else {\n                            this.$message.error(res.msg || '审核失败，请稍后重试');\n                    }\n                }).catch(e => {\n                        console.error('审核售后申请失败:', e);\n                        this.$message.error('审核失败，请稍后重试');\n                    }).finally(() => {\n                        this.sellerReviewSubmitting = false;\n                    });\n                });\n            },\n            getAfterSaleStatusText(status) {\n                const statuses = {\n                    0: '待卖家审核',\n                    1: '卖家已同意',\n                    2: '卖家已拒绝',\n                    3: '待管理员审核（卖家同意）',\n                    4: '待管理员审核（卖家拒绝）',\n                    5: '管理员已同意退款',\n                    6: '管理员已驳回'\n                };\n                return statuses[status] || '未知状态';\n            },\n            getAfterSaleStatusType(status) {\n                if (status === 0 || status === 3 || status === 4) return 'warning';\n                if (status === 1 || status === 5) return 'success';\n                if (status === 2 || status === 6) return 'error';\n                return 'info';\n            },\n            getApplicationTypeText(type) {\n                const types = {\n                    1: '质量问题',\n                    2: '描述不符',\n                    3: '未收到货',\n                    4: '其他'\n                };\n                return types[type] || '未知';\n            },\n            getEvidenceImages(imagesStr) {\n                if (!imagesStr) return [];\n                try {\n                    return JSON.parse(imagesStr);\n                } catch (e) {\n                    return [];\n                }\n            },\n            getFundStatusText(status) {\n                if (status === null || status === undefined) {\n                    return '未知';\n                }\n                const statuses = {\n                    0: '平台担保中',\n                    1: '已释放给卖家'\n                };\n                return statuses[status] || '未知';\n            },\n            getFundStatusType(status) {\n                if (status === null || status === undefined) {\n                    return 'info';\n                }\n                if (status === 0) {\n                    return 'warning'; // 平台担保中\n                } else if (status === 1) {\n                    return 'success'; // 已释放\n                }\n                return 'info';\n            },\n            getFundReleaseDate(finishTime) {\n                if (!finishTime) return '';\n                try {\n                    const finish = new Date(finishTime);\n                    const releaseDate = new Date(finish);\n                    releaseDate.setDate(releaseDate.getDate() + 7); // 加7天\n                    return releaseDate.toLocaleDateString('zh-CN', {\n                        year: 'numeric',\n                        month: '2-digit',\n                        day: '2-digit'\n                    });\n                } catch (e) {\n                    return '';\n                }\n            },\n            // ========== 地图相关方法 ==========\n            // 初始化地图\n            async initMap() {\n                if (!this.$refs.mapContainer) {\n                    console.warn('地图容器不存在，等待DOM更新');\n                    return;\n                }\n                \n                // 确保容器有高度\n                const container = document.getElementById('order-map-container');\n                if (!container) {\n                    console.error('找不到地图容器元素');\n                    return;\n                }\n                \n                try {\n                    // 销毁旧地图\n                    if (this.map) {\n                        this.map.destroy();\n                        this.map = null;\n                    }\n                    \n                    console.log('开始初始化地图，容器ID: order-map-container');\n                    \n                    // 动态加载地图API并创建地图实例\n                    this.map = await initMap('order-map-container', {\n                        zoom: 13\n                    });\n                    \n                    console.log('地图实例创建成功:', this.map);\n                    \n                    // 等待地图加载完成\n                    this.map.on('complete', () => {\n                        console.log('地图加载完成，开始解析地址');\n                        // 解析地址并显示标记\n                        this.geocodeAddresses();\n                    });\n                    \n                    // 如果地图已经加载完成，直接解析地址\n                    if (this.map.getStatus() === 'complete') {\n                        console.log('地图已加载完成，直接解析地址');\n                        this.geocodeAddresses();\n                    }\n                } catch (e) {\n                    console.error('地图初始化失败:', e);\n                    this.$message.error('地图初始化失败: ' + e.message);\n                }\n            },\n            // 解析地址\n            async geocodeAddresses() {\n                if (!this.map) {\n                    console.error('地图实例不存在，无法解析地址');\n                    return;\n                }\n                \n                console.log('开始解析地址，地图实例:', this.map);\n                \n                // 解析卖家地址\n                const sellerAddress = this.orderInfo.idleItem.idlePlace;\n                if (sellerAddress) {\n                    try {\n                        console.log('开始解析卖家地址:', sellerAddress);\n                        const sellerLoc = await geocodeAddress(sellerAddress);\n                        console.log('卖家地址解析成功，位置:', sellerLoc);\n                        this.sellerLocation = sellerLoc;\n                        \n                        // 添加标记\n                        const sellerMarker = addMarker(this.map, sellerLoc, '卖家位置', 'seller');\n                        if (sellerMarker) {\n                            console.log('卖家标记已添加:', sellerMarker);\n                            // 立即调整到卖家位置（如果只有卖家地址）\n                            // 不等待，直接设置，确保地图显示正确位置\n                            this.map.setCenter([sellerLoc.lng, sellerLoc.lat]);\n                            this.map.setZoom(15);\n                            console.log('地图已调整到卖家位置:', [sellerLoc.lng, sellerLoc.lat]);\n                } else {\n                            console.error('卖家标记添加失败');\n                        }\n                    } catch (e) {\n                        console.error('卖家地址解析失败:', e);\n                        this.$message.warning('卖家地址解析失败: ' + e.message);\n                    }\n                } else {\n                    console.warn('卖家未填写发货地址');\n                }\n                \n                // 解析买家地址\n                const buyerAddress = await this.loadBuyerAddress();\n                if (buyerAddress) {\n                    try {\n                        console.log('开始解析买家地址:', buyerAddress);\n                        const buyerLoc = await geocodeAddress(buyerAddress);\n                        console.log('买家地址解析成功，位置:', buyerLoc);\n                        this.buyerLocation = buyerLoc;\n                        \n                        // 添加标记\n                        const buyerMarker = addMarker(this.map, buyerLoc, '买家位置', 'buyer');\n                        if (buyerMarker) {\n                            console.log('买家标记已添加:', buyerMarker);\n                            \n                            // 更新地图视野（包含两个位置）\n                            // 立即更新，不延迟\n                            this.updateMapView();\n                            \n                            // 计算距离\n                            this.calculateDistance();\n                            console.log('距离计算完成');\n                        } else {\n                            console.error('买家标记添加失败');\n                        }\n                    } catch (e) {\n                        console.error('买家地址解析失败:', e);\n                        this.$message.warning('买家地址解析失败，但已显示原始地址');\n                    }\n                } else {\n                    console.warn('买家地址为空');\n                }\n            },\n            // 加载买家地址（用于地图解析）\n            async loadBuyerAddress() {\n                try {\n                    console.log('开始加载买家地址，订单ID:', this.orderInfo.id);\n                    const res = await this.$api.getOrderAddress({ orderId: this.orderInfo.id });\n                    console.log('获取订单地址API响应:', res);\n                    if (res.status_code === 1 && res.data) {\n                        if (res.data.detailAddress) {\n                            console.log('找到买家地址:', res.data.detailAddress);\n                            // 保存原始地址文本，即使解析失败也显示\n                            this.buyerAddressText = res.data.detailAddress;\n                            return res.data.detailAddress;\n                    } else {\n                            console.warn('订单地址数据存在，但detailAddress为空:', res.data);\n                        }\n                    } else {\n                        console.warn('订单地址API返回失败或数据为空:', res);\n                    }\n                    return null;\n                } catch (e) {\n                    console.error('加载买家地址异常:', e);\n                    return null;\n                }\n            },\n            // 加载买家地址（仅用于显示，不用于地图解析）\n            async loadBuyerAddressForDisplay() {\n                try {\n                    console.log('开始加载买家地址用于显示，订单ID:', this.orderInfo.id);\n                    const res = await this.$api.getOrderAddress({ orderId: this.orderInfo.id });\n                    console.log('获取订单地址API响应（显示用）:', res);\n                    if (res.status_code === 1 && res.data && res.data.detailAddress) {\n                        console.log('找到买家地址用于显示:', res.data.detailAddress);\n                        this.buyerAddressText = res.data.detailAddress;\n                    } else {\n                        console.warn('未找到买家地址:', res);\n                        this.buyerAddressText = '';\n                    }\n                } catch (e) {\n                    console.error('加载买家地址异常（显示用）:', e);\n                    this.buyerAddressText = '';\n                }\n            },\n            // 更新地图视野\n            updateMapView() {\n                if (!this.map) {\n                    console.warn('updateMapView: 地图实例不存在');\n                    return;\n                }\n                \n                const locations = [];\n                if (this.sellerLocation) {\n                    locations.push(this.sellerLocation);\n                    console.log('添加卖家位置到视野:', this.sellerLocation);\n                }\n                if (this.buyerLocation) {\n                    locations.push(this.buyerLocation);\n                    console.log('添加买家位置到视野:', this.buyerLocation);\n                }\n                \n                if (locations.length > 0) {\n                    console.log('调整地图视野，包含', locations.length, '个位置');\n                    console.log('位置详情:', locations.map(loc => ({ lng: loc.lng, lat: loc.lat, address: loc.address })));\n                    try {\n                        fitMapView(this.map, locations);\n                        // 延迟检查地图视野是否已更新\n                        setTimeout(() => {\n                            try {\n                                const center = this.map.getCenter();\n                                const zoom = this.map.getZoom();\n                                console.log('地图当前中心点:', center.toString(), '缩放级别:', zoom);\n                            } catch (e) {\n                                console.error('获取地图中心点失败:', e);\n                            }\n                        }, 300);\n                    } catch (e) {\n                        console.error('调整地图视野异常:', e);\n                        // 如果失败，至少设置到第一个位置\n                        if (locations.length > 0 && locations[0].lng && locations[0].lat) {\n                            this.map.setCenter([locations[0].lng, locations[0].lat]);\n                            this.map.setZoom(15);\n                            console.log('使用备用方法设置地图中心:', [locations[0].lng, locations[0].lat]);\n                        }\n                    }\n                    } else {\n                    console.warn('updateMapView: 没有可用的位置');\n                }\n            },\n            // 计算距离\n            calculateDistance() {\n                if (!this.sellerLocation || !this.buyerLocation) return;\n                \n                try {\n                    const distance = calculateDistance(this.sellerLocation, this.buyerLocation);\n                    if (distance !== null) {\n                        this.distanceKm = (distance / 1000).toFixed(2);\n                        this.distanceText = formatDistance(distance);\n                    }\n                } catch (e) {\n                    console.error('距离计算失败:', e);\n                }\n            },\n            // 导航到卖家位置\n            navigateToSeller() {\n                // 如果同时有卖家和买家解析后的位置，打开高德路线页面，展示两点与距离\n                const sellerAddress = this.orderInfo.idleItem && this.orderInfo.idleItem.idlePlace;\n                const buyerAddressText = this.buyerAddressText;\n\n                const tryOpenRoute = async () => {\n                    try {\n                        let start = this.buyerLocation;\n                        let end = this.sellerLocation;\n\n                        // 如果买家位置尚未解析但有文本，尝试用后端代理解析\n                        if (!start && buyerAddressText) {\n                            const res = await this.$api.geocodeProxy({ address: buyerAddressText });\n                            if (res && res.status_code === 1 && res.data) {\n                                start = { lng: res.data.lng, lat: res.data.lat, address: res.data.formattedAddress || buyerAddressText };\n                                this.buyerLocation = start;\n                            }\n                        }\n\n                        // 如果卖家位置尚未解析但有文本，尝试用后端代理解析\n                        if (!end && sellerAddress) {\n                            const res2 = await this.$api.geocodeProxy({ address: sellerAddress });\n                            if (res2 && res2.status_code === 1 && res2.data) {\n                                end = { lng: res2.data.lng, lat: res2.data.lat, address: res2.data.formattedAddress || sellerAddress };\n                                this.sellerLocation = end;\n                            }\n                        }\n\n                        if (start && end) {\n                            // 两点均可用，打开路线页面（高德会显示距离和路线）\n                            openRouteInAmap(start, end, 'car');\n                            return true;\n                        }\n                    } catch (e) {\n                        console.error('尝试使用route打开高德地图失败:', e);\n                    }\n                    return false;\n                };\n\n                (async () => {\n                    const ok = await tryOpenRoute();\n                    if (ok) return;\n\n                    // 回退：如果有解析后的卖家位置，直接导航到卖家\n                    if (this.sellerLocation) {\n                        try {\n                            openNavigation(this.sellerLocation, 'car');\n                            return;\n                        } catch (e) {\n                            console.error('使用解析位置导航失败:', e);\n                        }\n                    }\n\n                    // 最后回退到使用原始地址打开高德导航\n                    if (sellerAddress) {\n                        const url = `https://uri.amap.com/navigation?to=${encodeURIComponent(sellerAddress)}&mode=car&policy=1&src=mypage&callnative=1`;\n                        window.open(url, '_blank');\n                        this.$message.info('正在使用原始地址进行导航');\n                    } else {\n                        this.$message.warning('卖家地址未填写');\n                    }\n                })();\n            },\n            // 导航到买家位置\n            navigateToBuyer() {\n                // 当卖家发起导航到买家时，优先尝试打开高德路线页面，展示两点与距离\n                const sellerAddress = this.orderInfo.idleItem && this.orderInfo.idleItem.idlePlace;\n                const buyerAddressText = this.buyerAddressText;\n\n                const tryOpenRoute = async () => {\n                    try {\n                        let start = this.sellerLocation;\n                        let end = this.buyerLocation;\n\n                        if (!start && sellerAddress) {\n                            const res = await this.$api.geocodeProxy({ address: sellerAddress });\n                            if (res && res.status_code === 1 && res.data) {\n                                start = { lng: res.data.lng, lat: res.data.lat, address: res.data.formattedAddress || sellerAddress };\n                                this.sellerLocation = start;\n                            }\n                        }\n\n                        if (!end && buyerAddressText) {\n                            const res2 = await this.$api.geocodeProxy({ address: buyerAddressText });\n                            if (res2 && res2.status_code === 1 && res2.data) {\n                                end = { lng: res2.data.lng, lat: res2.data.lat, address: res2.data.formattedAddress || buyerAddressText };\n                                this.buyerLocation = end;\n                            }\n                        }\n\n                        if (start && end) {\n                            openRouteInAmap(start, end, 'car');\n                            return true;\n                        }\n                    } catch (e) {\n                        console.error('尝试使用route打开高德地图失败:', e);\n                    }\n                    return false;\n                };\n\n                (async () => {\n                    const ok = await tryOpenRoute();\n                    if (ok) return;\n\n                    // 回退：如果解析后有买家位置，直接导航到买家\n                    if (this.buyerLocation) {\n                        try {\n                            openNavigation(this.buyerLocation, 'car');\n                            return;\n                        } catch (e) {\n                            console.error('使用解析位置导航失败:', e);\n                        }\n                    }\n\n                    if (this.buyerAddressText) {\n                        const url = `https://uri.amap.com/navigation?to=${encodeURIComponent(this.buyerAddressText)}&mode=car&policy=1&src=mypage&callnative=1`;\n                        window.open(url, '_blank');\n                        this.$message.info('正在使用原始地址进行导航');\n                    } else {\n                        this.$message.warning('买家地址未填写');\n                    }\n                })();\n            },\n            // 刷新地图\n            refreshMap() {\n                this.sellerLocation = null;\n                this.buyerLocation = null;\n                this.buyerAddressText = '';\n                this.distanceKm = null;\n                this.distanceText = '';\n                \n                if (this.map) {\n                    this.map.clearMap();\n                }\n                \n                this.geocodeAddresses();\n                this.$message.success('地图已刷新');\n            },\n            // 销毁地图\n            destroyMap() {\n                if (this.map) {\n                    this.map.destroy();\n                    this.map = null;\n                }\n                this.sellerLocation = null;\n                this.buyerLocation = null;\n                this.buyerAddressText = '';\n                this.distanceKm = null;\n                this.distanceText = '';\n            }\n        },\n        beforeDestroy() {\n            this.destroyMap();\n        }\n    }\n</script>\n\n<style scoped>\n    .order-container {\n        min-height: 85vh;\n        padding: 20px 0;\n    }\n\n    .order-card {\n        max-width: 900px;\n        margin: 0 auto;\n        border-radius: 12px;\n    }\n\n    .card-header {\n        padding: 20px;\n        border-bottom: 1px solid #f0f2f5;\n    }\n\n    .order-title {\n        font-size: 24px;\n        font-weight: 600;\n        color: #303133;\n        margin: 0;\n        display: flex;\n        align-items: center;\n    }\n    \n    .order-title i {\n        margin-right: 10px;\n        color: #409EFF;\n        font-size: 28px;\n    }\n\n    .order-info-section {\n        padding: 20px;\n    }\n\n    .info-row {\n        display: flex;\n        align-items: center;\n        margin-bottom: 20px;\n        font-size: 16px;\n    }\n\n    .info-label {\n        width: 120px;\n        color: #606266;\n        font-weight: 500;\n    }\n\n    .info-value {\n        color: #303133;\n        flex: 1;\n    }\n\n    .info-value.price {\n        font-size: 24px;\n        font-weight: 700;\n        color: #f56c6c;\n    }\n\n    .section-title {\n        font-size: 18px;\n        font-weight: 600;\n        color: #303133;\n        margin-bottom: 15px;\n    }\n\n    .product-info-section {\n        padding: 20px;\n    }\n\n    .product-card {\n        display: flex;\n        padding: 20px;\n        background: #f8f9fa;\n        border-radius: 8px;\n        gap: 20px;\n    }\n    \n    .product-image {\n        width: 120px;\n        height: 120px;\n        border-radius: 8px;\n        flex-shrink: 0;\n    }\n\n    .product-details {\n        flex: 1;\n    }\n    \n    .product-name {\n        font-size: 18px;\n        font-weight: 600;\n        color: #303133;\n        margin: 0 0 15px 0;\n    }\n    \n    .product-price-info {\n        margin-top: 10px;\n    }\n    \n    .product-price {\n        font-size: 22px;\n        font-weight: 700;\n        color: #f56c6c;\n    }\n\n    .seller-info-section {\n        padding: 20px;\n    }\n\n    .seller-card {\n        display: flex;\n        padding: 20px;\n        background: #f8f9fa;\n        border-radius: 8px;\n        gap: 20px;\n        align-items: center;\n    }\n\n    .seller-avatar {\n        flex-shrink: 0;\n    }\n\n    .seller-details {\n        flex: 1;\n    }\n\n    .seller-name {\n        font-size: 16px;\n        margin-bottom: 15px;\n    }\n    \n    .seller-label {\n        color: #606266;\n        font-weight: 500;\n    }\n\n    .seller-value {\n        color: #303133;\n        font-weight: 600;\n        font-size: 18px;\n    }\n    \n    .seller-actions {\n        display: flex;\n        gap: 10px;\n    }\n\n    .buyer-info-section {\n        padding: 20px;\n    }\n\n    .buyer-card {\n        display: flex;\n        padding: 20px;\n        background: #f8f9fa;\n        border-radius: 8px;\n        gap: 20px;\n        align-items: center;\n    }\n    \n    .buyer-avatar {\n        flex-shrink: 0;\n    }\n\n    .buyer-details {\n        flex: 1;\n    }\n\n    .buyer-name {\n        font-size: 16px;\n        margin-bottom: 15px;\n    }\n\n    .buyer-label {\n        color: #606266;\n        font-weight: 500;\n    }\n\n    .buyer-value {\n        color: #303133;\n        font-weight: 600;\n        font-size: 18px;\n    }\n\n    .buyer-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    .action-buttons {\n        padding: 20px;\n        display: flex;\n        justify-content: center;\n        gap: 15px;\n    }\n\n    .empty-state {\n        text-align: center;\n        padding: 60px 20px;\n        color: #909399;\n    }\n\n    .empty-state i {\n        font-size: 64px;\n        margin-bottom: 20px;\n        color: #c0c4cc;\n    }\n\n    .empty-state p {\n            font-size: 16px;\n        margin-bottom: 30px;\n    }\n\n    .fund-hint {\n        margin-left: 10px;\n        color: #909399;\n        font-size: 12px;\n    }\n    \n    /* 地图相关样式 */\n    .location-navigation-section {\n        margin-top: 20px;\n        padding: 20px;\n    }\n    \n    .location-info-card {\n        display: flex;\n        gap: 20px;\n        margin-bottom: 15px;\n        padding: 15px;\n        background: #f5f7fa;\n        border-radius: 8px;\n        flex-wrap: wrap;\n    }\n    \n    .location-info-item.full-width {\n        width: 100%;\n        margin-bottom: 8px;\n    }\n    \n    .location-info-item {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .location-label {\n        color: #606266;\n            font-size: 14px;\n        }\n        \n    .location-value {\n        color: #303133;\n        font-weight: 600;\n            font-size: 16px;\n        }\n        \n    .location-value.text-warning {\n        color: #E6A23C;\n        font-weight: normal;\n    }\n    \n    .map-container {\n        width: 100%;\n        height: 400px;\n        border-radius: 8px;\n        overflow: hidden;\n        margin-bottom: 15px;\n        border: 1px solid #e4e7ed;\n    }\n    \n    .map-actions {\n        display: flex;\n            justify-content: center;\n        gap: 10px;\n        flex-wrap: wrap;\n    }\n\n    @media (max-width: 768px) {\n        .order-container {\n            padding: 10px;\n        }\n        \n        .product-card {\n            flex-direction: column;\n        }\n\n        .product-image {\n            width: 100%;\n            height: 200px;\n        }\n    }\n</style>\n"]}]}