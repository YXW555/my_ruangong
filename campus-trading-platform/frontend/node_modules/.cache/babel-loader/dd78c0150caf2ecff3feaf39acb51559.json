{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\AfterSaleReview.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\AfterSaleReview.vue","mtime":1767334153608},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.to-string\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: 'AfterSaleReview',\n  data: function data() {\n    return {\n      loading: false,\n      afterSales: [],\n      filterStatus: null,\n      detailDialogVisible: false,\n      currentAfterSale: null,\n      buyerEvidenceImages: [],\n      sellerEvidenceImages: [],\n      chatMessages: [],\n      chatLoading: false,\n      rejectDialogVisible: false,\n      rejectForm: {\n        reason: ''\n      },\n      rejectRules: {\n        reason: [{\n          required: true,\n          message: '请填写驳回原因',\n          trigger: 'blur'\n        }, {\n          min: 10,\n          max: 500,\n          message: '驳回原因长度在10到500个字符',\n          trigger: 'blur'\n        }]\n      },\n      rejectSubmitting: false\n    };\n  },\n  created: function created() {\n    this.loadAfterSales();\n  },\n  methods: {\n    loadAfterSales: function loadAfterSales() {\n      var _this = this;\n\n      this.loading = true;\n      this.$api.getAdminPendingAfterSales({}).then(function (res) {\n        if (res.status_code === 1 && res.data) {\n          _this.afterSales = res.data; // 通知父组件更新待审核数量\n\n          var pendingCount = res.data.filter(function (item) {\n            return item.applicationStatus === 3 || item.applicationStatus === 4;\n          }).length;\n\n          _this.$emit('pending-count-change', pendingCount);\n        }\n      }).catch(function (e) {\n        console.error('加载售后申请失败:', e);\n\n        _this.$message.error('加载售后申请失败');\n      }).finally(function () {\n        _this.loading = false;\n      });\n    },\n    handleStatusChange: function handleStatusChange() {\n      this.loadAfterSales();\n    },\n    getApplicationTypeText: function getApplicationTypeText(type) {\n      var types = {\n        1: '质量问题',\n        2: '描述不符',\n        3: '未收到货',\n        4: '其他'\n      };\n      return types[type] || '未知';\n    },\n    getStatusText: function getStatusText(status) {\n      var statuses = {\n        0: '待卖家审核',\n        1: '卖家已同意',\n        2: '卖家已拒绝',\n        3: '待管理员审核（卖家同意）',\n        4: '待管理员审核（卖家拒绝）',\n        5: '管理员已同意退款',\n        6: '管理员已驳回'\n      };\n      return statuses[status] || '未知状态';\n    },\n    getStatusType: function getStatusType(status) {\n      if (status === 3 || status === 4) return 'warning';\n      if (status === 5) return 'success';\n      if (status === 6) return 'danger';\n      return 'info';\n    },\n    formatTime: function formatTime(time) {\n      if (!time) return '';\n      return time.toString().substring(0, 19).replace('T', ' ');\n    },\n    viewDetail: function viewDetail(afterSale) {\n      this.currentAfterSale = afterSale;\n      this.detailDialogVisible = true; // 解析证据图片\n\n      if (afterSale.evidenceImages) {\n        try {\n          this.buyerEvidenceImages = JSON.parse(afterSale.evidenceImages);\n        } catch (e) {\n          this.buyerEvidenceImages = [];\n        }\n      } else {\n        this.buyerEvidenceImages = [];\n      }\n\n      if (afterSale.sellerEvidenceImages) {\n        try {\n          this.sellerEvidenceImages = JSON.parse(afterSale.sellerEvidenceImages);\n        } catch (e) {\n          this.sellerEvidenceImages = [];\n        }\n      } else {\n        this.sellerEvidenceImages = [];\n      } // 加载聊天记录\n\n\n      this.loadChatMessages();\n    },\n    loadChatMessages: function loadChatMessages() {\n      if (!this.currentAfterSale || !this.currentAfterSale.order) {\n        return;\n      }\n\n      this.chatLoading = true;\n      var buyerId = this.currentAfterSale.buyerId;\n      var sellerId = this.currentAfterSale.sellerId;\n      var idleId = this.currentAfterSale.order.idleId; // 注意：管理员查看聊天记录需要特殊处理\n      // 由于API需要当前用户ID，管理员无法直接查看\n      // 这里显示提示信息，管理员可要求相关方提供聊天截图作为证据\n      // 后续可以添加管理员专用的查看聊天记录接口\n\n      this.chatMessages = [];\n      this.chatLoading = false;\n    },\n    closeDetailDialog: function closeDetailDialog() {\n      this.currentAfterSale = null;\n      this.buyerEvidenceImages = [];\n      this.sellerEvidenceImages = [];\n      this.chatMessages = [];\n    },\n    approveRefund: function approveRefund(afterSale) {\n      var _this2 = this;\n\n      this.$confirm('确认同意退款吗？退款金额：¥' + afterSale.refundAmount, '确认退款', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this2.$api.adminReviewAfterSale({\n          id: afterSale.id,\n          reviewResult: 1\n        }).then(function (res) {\n          if (res.status_code === 1) {\n            _this2.$message.success('已同意退款');\n\n            _this2.detailDialogVisible = false;\n\n            _this2.loadAfterSales();\n          } else {\n            _this2.$message.error(res.msg || '操作失败');\n          }\n        }).catch(function (e) {\n          console.error('同意退款失败:', e);\n\n          _this2.$message.error('操作失败，请稍后重试');\n        });\n      }).catch(function () {});\n    },\n    rejectApplication: function rejectApplication(afterSale) {\n      this.currentAfterSale = afterSale;\n      this.rejectForm.reason = '';\n      this.rejectDialogVisible = true;\n    },\n    submitReject: function submitReject() {\n      var _this3 = this;\n\n      this.$refs.rejectForm.validate(function (valid) {\n        if (!valid) {\n          return false;\n        }\n\n        _this3.rejectSubmitting = true;\n\n        _this3.$api.adminReviewAfterSale({\n          id: _this3.currentAfterSale.id,\n          reviewResult: 2,\n          reason: _this3.rejectForm.reason\n        }).then(function (res) {\n          if (res.status_code === 1) {\n            _this3.$message.success('已驳回申请');\n\n            _this3.rejectDialogVisible = false;\n            _this3.detailDialogVisible = false;\n\n            _this3.loadAfterSales();\n          } else {\n            _this3.$message.error(res.msg || '操作失败');\n          }\n        }).catch(function (e) {\n          console.error('驳回申请失败:', e);\n\n          _this3.$message.error('操作失败，请稍后重试');\n        }).finally(function () {\n          _this3.rejectSubmitting = false;\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["AfterSaleReview.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"after-sale-review-container\">\n        <el-card shadow=\"never\">\n            <div slot=\"header\" class=\"clearfix\">\n                <span>售后申请审核</span>\n                <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"loadAfterSales\">刷新</el-button>\n            </div>\n\n            <!-- 筛选条件 -->\n            <div class=\"filter-container\">\n                <el-radio-group v-model=\"filterStatus\" @change=\"handleStatusChange\" size=\"small\">\n                    <el-radio-button :label=\"null\">全部</el-radio-button>\n                    <el-radio-button :label=\"3\">待审核（卖家同意）</el-radio-button>\n                    <el-radio-button :label=\"4\">待审核（卖家拒绝）</el-radio-button>\n                    <el-radio-button :label=\"5\">已同意退款</el-radio-button>\n                    <el-radio-button :label=\"6\">已驳回</el-radio-button>\n                </el-radio-group>\n            </div>\n\n            <!-- 售后申请列表 -->\n            <el-table\n                :data=\"afterSales\"\n                v-loading=\"loading\"\n                style=\"width: 100%\"\n                :header-cell-style=\"{ background: '#f5f7fa', color: '#303133', fontWeight: 'bold' }\"\n                border>\n                <el-table-column\n                    prop=\"id\"\n                    label=\"申请ID\"\n                    width=\"80\">\n                </el-table-column>\n                <el-table-column\n                    prop=\"order.orderNumber\"\n                    label=\"订单号\"\n                    width=\"180\"\n                    show-overflow-tooltip>\n                </el-table-column>\n                <el-table-column\n                    prop=\"order.idleItem.idleName\"\n                    label=\"商品名称\"\n                    show-overflow-tooltip>\n                </el-table-column>\n                <el-table-column\n                    prop=\"buyer.nickname\"\n                    label=\"买家\"\n                    width=\"120\">\n                </el-table-column>\n                <el-table-column\n                    prop=\"seller.nickname\"\n                    label=\"卖家\"\n                    width=\"120\">\n                </el-table-column>\n                <el-table-column\n                    label=\"申请类型\"\n                    width=\"120\">\n                    <template slot-scope=\"scope\">\n                        <el-tag size=\"small\">{{ getApplicationTypeText(scope.row.applicationType) }}</el-tag>\n                    </template>\n                </el-table-column>\n                <el-table-column\n                    label=\"申请状态\"\n                    width=\"140\">\n                    <template slot-scope=\"scope\">\n                        <el-tag :type=\"getStatusType(scope.row.applicationStatus)\" size=\"small\">\n                            {{ getStatusText(scope.row.applicationStatus) }}\n                        </el-tag>\n                    </template>\n                </el-table-column>\n                <el-table-column\n                    prop=\"refundAmount\"\n                    label=\"退款金额\"\n                    width=\"120\">\n                    <template slot-scope=\"scope\">\n                        ¥{{ scope.row.refundAmount }}\n                    </template>\n                </el-table-column>\n                <el-table-column\n                    prop=\"createTime\"\n                    label=\"申请时间\"\n                    width=\"160\">\n                    <template slot-scope=\"scope\">\n                        {{ formatTime(scope.row.createTime) }}\n                    </template>\n                </el-table-column>\n                <el-table-column\n                    label=\"操作\"\n                    width=\"200\"\n                    fixed=\"right\">\n                    <template slot-scope=\"scope\">\n                        <el-button\n                            size=\"mini\"\n                            type=\"primary\"\n                            @click=\"viewDetail(scope.row)\">\n                            查看详情\n                        </el-button>\n                        <el-button\n                            v-if=\"scope.row.applicationStatus === 3 || scope.row.applicationStatus === 4\"\n                            size=\"mini\"\n                            type=\"success\"\n                            @click=\"approveRefund(scope.row)\">\n                            同意退款\n                        </el-button>\n                        <el-button\n                            v-if=\"scope.row.applicationStatus === 3 || scope.row.applicationStatus === 4\"\n                            size=\"mini\"\n                            type=\"danger\"\n                            @click=\"rejectApplication(scope.row)\">\n                            驳回\n                        </el-button>\n                    </template>\n                </el-table-column>\n            </el-table>\n        </el-card>\n\n        <!-- 详情对话框 -->\n        <el-dialog\n            title=\"售后申请详情\"\n            :visible.sync=\"detailDialogVisible\"\n            width=\"900px\"\n            @close=\"closeDetailDialog\">\n            <div v-if=\"currentAfterSale\" class=\"detail-content\">\n                <!-- 基本信息 -->\n                <el-card shadow=\"never\" class=\"detail-section\">\n                    <div slot=\"header\">基本信息</div>\n                    <el-row :gutter=\"20\">\n                        <el-col :span=\"12\">\n                            <p><strong>申请ID：</strong>{{ currentAfterSale.id }}</p>\n                            <p><strong>订单号：</strong>{{ currentAfterSale.order.orderNumber }}</p>\n                            <p><strong>商品名称：</strong>{{ currentAfterSale.order.idleItem.idleName }}</p>\n                            <p><strong>申请类型：</strong>{{ getApplicationTypeText(currentAfterSale.applicationType) }}</p>\n                        </el-col>\n                        <el-col :span=\"12\">\n                            <p><strong>买家：</strong>{{ currentAfterSale.buyer.nickname }}</p>\n                            <p><strong>卖家：</strong>{{ currentAfterSale.seller.nickname }}</p>\n                            <p><strong>退款金额：</strong><span style=\"color: #f56c6c; font-weight: bold;\">¥{{ currentAfterSale.refundAmount }}</span></p>\n                            <p><strong>申请时间：</strong>{{ formatTime(currentAfterSale.createTime) }}</p>\n                        </el-col>\n                    </el-row>\n                </el-card>\n\n                <!-- 问题描述 -->\n                <el-card shadow=\"never\" class=\"detail-section\">\n                    <div slot=\"header\">问题描述</div>\n                    <p>{{ currentAfterSale.problemDescription }}</p>\n                </el-card>\n\n                <!-- 买家证据图片 -->\n                <el-card shadow=\"never\" class=\"detail-section\">\n                    <div slot=\"header\">买家证据图片</div>\n                    <div class=\"evidence-images\" v-if=\"buyerEvidenceImages.length > 0\">\n                        <el-image\n                            v-for=\"(img, index) in buyerEvidenceImages\"\n                            :key=\"index\"\n                            :src=\"img\"\n                            :preview-src-list=\"buyerEvidenceImages\"\n                            fit=\"cover\"\n                            class=\"evidence-image\">\n                        </el-image>\n                    </div>\n                    <p v-else style=\"color: #909399;\">暂无图片</p>\n                </el-card>\n\n                <!-- 卖家审核信息 -->\n                <el-card shadow=\"never\" class=\"detail-section\" v-if=\"currentAfterSale.sellerReviewTime\">\n                    <div slot=\"header\">卖家审核信息</div>\n                    <p><strong>审核结果：</strong>\n                        <el-tag :type=\"currentAfterSale.sellerReviewResult === 1 ? 'success' : 'danger'\" size=\"small\">\n                            {{ currentAfterSale.sellerReviewResult === 1 ? '同意' : '拒绝' }}\n                        </el-tag>\n                    </p>\n                    <p v-if=\"currentAfterSale.sellerRejectReason\"><strong>拒绝原因：</strong>{{ currentAfterSale.sellerRejectReason }}</p>\n                    <p><strong>审核时间：</strong>{{ formatTime(currentAfterSale.sellerReviewTime) }}</p>\n                    <div v-if=\"sellerEvidenceImages.length > 0\" class=\"evidence-images\">\n                        <p><strong>卖家举证图片：</strong></p>\n                        <el-image\n                            v-for=\"(img, index) in sellerEvidenceImages\"\n                            :key=\"index\"\n                            :src=\"img\"\n                            :preview-src-list=\"sellerEvidenceImages\"\n                            fit=\"cover\"\n                            class=\"evidence-image\">\n                        </el-image>\n                    </div>\n                </el-card>\n\n                <!-- 聊天记录 -->\n                <el-card shadow=\"never\" class=\"detail-section\">\n                    <div slot=\"header\">\n                        交易聊天记录\n                        <el-button size=\"mini\" type=\"text\" @click=\"loadChatMessages\" style=\"float: right;\">刷新</el-button>\n                    </div>\n                    <div class=\"chat-messages\" v-loading=\"chatLoading\">\n                        <div v-if=\"chatMessages.length === 0\" style=\"color: #909399; text-align: center; padding: 20px;\">\n                            <p>管理员无法直接查看聊天记录</p>\n                            <p style=\"font-size: 12px; margin-top: 10px;\">\n                                如需查看聊天记录，可要求买家或卖家提供聊天截图作为证据，或从相关用户账户查看\n                            </p>\n                            <p style=\"font-size: 12px; margin-top: 5px;\">\n                                买家ID: {{ currentAfterSale.buyerId }} | 卖家ID: {{ currentAfterSale.sellerId }}\n                            </p>\n                        </div>\n                        <div v-else>\n                            <div\n                                v-for=\"msg in chatMessages\"\n                                :key=\"msg.id\"\n                                class=\"chat-message-item\">\n                                <div class=\"chat-message-header\">\n                                    <span class=\"chat-user\">{{ msg.fromU && msg.fromU.nickname || '未知用户' }}</span>\n                                    <span class=\"chat-time\">{{ formatTime(msg.createTime) }}</span>\n                                </div>\n                                <div class=\"chat-message-content\">\n                                    <el-image\n                                        v-if=\"msg.imageUrl\"\n                                        :src=\"msg.imageUrl\"\n                                        :preview-src-list=\"[msg.imageUrl]\"\n                                        fit=\"cover\"\n                                        class=\"chat-image\">\n                                    </el-image>\n                                    <div v-else v-html=\"msg.content\"></div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </el-card>\n            </div>\n            <span slot=\"footer\" class=\"dialog-footer\" v-if=\"currentAfterSale && (currentAfterSale.applicationStatus === 3 || currentAfterSale.applicationStatus === 4)\">\n                <el-button @click=\"detailDialogVisible = false\">关 闭</el-button>\n                <el-button type=\"success\" @click=\"approveRefund(currentAfterSale)\">同意退款</el-button>\n                <el-button type=\"danger\" @click=\"rejectApplication(currentAfterSale)\">驳回申请</el-button>\n            </span>\n            <span slot=\"footer\" class=\"dialog-footer\" v-else>\n                <el-button @click=\"detailDialogVisible = false\">关 闭</el-button>\n            </span>\n        </el-dialog>\n\n        <!-- 驳回对话框 -->\n        <el-dialog\n            title=\"驳回售后申请\"\n            :visible.sync=\"rejectDialogVisible\"\n            width=\"500px\">\n            <el-form :model=\"rejectForm\" :rules=\"rejectRules\" ref=\"rejectForm\" label-width=\"100px\">\n                <el-form-item label=\"驳回原因\" prop=\"reason\">\n                    <el-input\n                        type=\"textarea\"\n                        :rows=\"4\"\n                        v-model=\"rejectForm.reason\"\n                        placeholder=\"请填写驳回原因，说明为什么驳回该申请...\"\n                        maxlength=\"500\"\n                        show-word-limit>\n                    </el-input>\n                </el-form-item>\n            </el-form>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"rejectDialogVisible = false\">取 消</el-button>\n                <el-button type=\"danger\" @click=\"submitReject\" :loading=\"rejectSubmitting\">确 定</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: 'AfterSaleReview',\n    data() {\n        return {\n            loading: false,\n            afterSales: [],\n            filterStatus: null,\n            detailDialogVisible: false,\n            currentAfterSale: null,\n            buyerEvidenceImages: [],\n            sellerEvidenceImages: [],\n            chatMessages: [],\n            chatLoading: false,\n            rejectDialogVisible: false,\n            rejectForm: {\n                reason: ''\n            },\n            rejectRules: {\n                reason: [\n                    { required: true, message: '请填写驳回原因', trigger: 'blur' },\n                    { min: 10, max: 500, message: '驳回原因长度在10到500个字符', trigger: 'blur' }\n                ]\n            },\n            rejectSubmitting: false\n        };\n    },\n    created() {\n        this.loadAfterSales();\n    },\n    methods: {\n        loadAfterSales() {\n            this.loading = true;\n            this.$api.getAdminPendingAfterSales({}).then(res => {\n                if (res.status_code === 1 && res.data) {\n                    this.afterSales = res.data;\n                    // 通知父组件更新待审核数量\n                    const pendingCount = res.data.filter(item => item.applicationStatus === 3 || item.applicationStatus === 4).length;\n                    this.$emit('pending-count-change', pendingCount);\n                }\n            }).catch(e => {\n                console.error('加载售后申请失败:', e);\n                this.$message.error('加载售后申请失败');\n            }).finally(() => {\n                this.loading = false;\n            });\n        },\n        handleStatusChange() {\n            this.loadAfterSales();\n        },\n        getApplicationTypeText(type) {\n            const types = {\n                1: '质量问题',\n                2: '描述不符',\n                3: '未收到货',\n                4: '其他'\n            };\n            return types[type] || '未知';\n        },\n        getStatusText(status) {\n            const statuses = {\n                0: '待卖家审核',\n                1: '卖家已同意',\n                2: '卖家已拒绝',\n                3: '待管理员审核（卖家同意）',\n                4: '待管理员审核（卖家拒绝）',\n                5: '管理员已同意退款',\n                6: '管理员已驳回'\n            };\n            return statuses[status] || '未知状态';\n        },\n        getStatusType(status) {\n            if (status === 3 || status === 4) return 'warning';\n            if (status === 5) return 'success';\n            if (status === 6) return 'danger';\n            return 'info';\n        },\n        formatTime(time) {\n            if (!time) return '';\n            return time.toString().substring(0, 19).replace('T', ' ');\n        },\n        viewDetail(afterSale) {\n            this.currentAfterSale = afterSale;\n            this.detailDialogVisible = true;\n            \n            // 解析证据图片\n            if (afterSale.evidenceImages) {\n                try {\n                    this.buyerEvidenceImages = JSON.parse(afterSale.evidenceImages);\n                } catch (e) {\n                    this.buyerEvidenceImages = [];\n                }\n            } else {\n                this.buyerEvidenceImages = [];\n            }\n\n            if (afterSale.sellerEvidenceImages) {\n                try {\n                    this.sellerEvidenceImages = JSON.parse(afterSale.sellerEvidenceImages);\n                } catch (e) {\n                    this.sellerEvidenceImages = [];\n                }\n            } else {\n                this.sellerEvidenceImages = [];\n            }\n\n            // 加载聊天记录\n            this.loadChatMessages();\n        },\n        loadChatMessages() {\n            if (!this.currentAfterSale || !this.currentAfterSale.order) {\n                return;\n            }\n\n            this.chatLoading = true;\n            const buyerId = this.currentAfterSale.buyerId;\n            const sellerId = this.currentAfterSale.sellerId;\n            const idleId = this.currentAfterSale.order.idleId;\n\n            // 注意：管理员查看聊天记录需要特殊处理\n            // 由于API需要当前用户ID，管理员无法直接查看\n            // 这里显示提示信息，管理员可要求相关方提供聊天截图作为证据\n            // 后续可以添加管理员专用的查看聊天记录接口\n            this.chatMessages = [];\n            this.chatLoading = false;\n        },\n        closeDetailDialog() {\n            this.currentAfterSale = null;\n            this.buyerEvidenceImages = [];\n            this.sellerEvidenceImages = [];\n            this.chatMessages = [];\n        },\n        approveRefund(afterSale) {\n            this.$confirm('确认同意退款吗？退款金额：¥' + afterSale.refundAmount, '确认退款', {\n                confirmButtonText: '确认',\n                cancelButtonText: '取消',\n                type: 'warning'\n            }).then(() => {\n                this.$api.adminReviewAfterSale({\n                    id: afterSale.id,\n                    reviewResult: 1\n                }).then(res => {\n                    if (res.status_code === 1) {\n                        this.$message.success('已同意退款');\n                        this.detailDialogVisible = false;\n                        this.loadAfterSales();\n                    } else {\n                        this.$message.error(res.msg || '操作失败');\n                    }\n                }).catch(e => {\n                    console.error('同意退款失败:', e);\n                    this.$message.error('操作失败，请稍后重试');\n                });\n            }).catch(() => {});\n        },\n        rejectApplication(afterSale) {\n            this.currentAfterSale = afterSale;\n            this.rejectForm.reason = '';\n            this.rejectDialogVisible = true;\n        },\n        submitReject() {\n            this.$refs.rejectForm.validate((valid) => {\n                if (!valid) {\n                    return false;\n                }\n\n                this.rejectSubmitting = true;\n                this.$api.adminReviewAfterSale({\n                    id: this.currentAfterSale.id,\n                    reviewResult: 2,\n                    reason: this.rejectForm.reason\n                }).then(res => {\n                    if (res.status_code === 1) {\n                        this.$message.success('已驳回申请');\n                        this.rejectDialogVisible = false;\n                        this.detailDialogVisible = false;\n                        this.loadAfterSales();\n                    } else {\n                        this.$message.error(res.msg || '操作失败');\n                    }\n                }).catch(e => {\n                    console.error('驳回申请失败:', e);\n                    this.$message.error('操作失败，请稍后重试');\n                }).finally(() => {\n                    this.rejectSubmitting = false;\n                });\n            });\n        }\n    }\n};\n</script>\n\n<style scoped>\n.after-sale-review-container {\n    padding: 20px;\n}\n\n.filter-container {\n    margin-bottom: 20px;\n}\n\n.detail-content {\n    max-height: 70vh;\n    overflow-y: auto;\n}\n\n.detail-section {\n    margin-bottom: 20px;\n}\n\n.detail-section p {\n    margin: 10px 0;\n    line-height: 1.8;\n}\n\n.evidence-images {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 10px;\n    margin-top: 10px;\n}\n\n.evidence-image {\n    width: 150px;\n    height: 150px;\n    border-radius: 8px;\n    cursor: pointer;\n}\n\n.chat-messages {\n    max-height: 400px;\n    overflow-y: auto;\n    padding: 10px;\n    background: #f5f7fa;\n    border-radius: 8px;\n}\n\n.chat-message-item {\n    margin-bottom: 15px;\n    padding: 10px;\n    background: #fff;\n    border-radius: 8px;\n    border-left: 3px solid #409EFF;\n}\n\n.chat-message-header {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    font-size: 12px;\n    color: #909399;\n}\n\n.chat-user {\n    font-weight: 600;\n    color: #409EFF;\n}\n\n.chat-time {\n    color: #909399;\n}\n\n.chat-message-content {\n    color: #303133;\n    line-height: 1.6;\n}\n\n.chat-image {\n    max-width: 200px;\n    max-height: 200px;\n    border-radius: 8px;\n    cursor: pointer;\n}\n</style>\n\n"],"sourceRoot":"src/components/common"}]}