# 容器未运行问题排查

## 问题现象

执行 `docker compose ps` 时，只显示表头，没有任何容器数据，说明**所有容器都没有运行**。

## 立即操作

在服务器上执行：

```bash
cd /opt/campus-trading-platform

# 1. 尝试启动所有容器
sudo docker compose up -d

# 2. 等待几秒
sleep 5

# 3. 再次检查状态
sudo docker compose ps

# 4. 如果还是没有运行，查看启动日志
sudo docker compose up
# 这会显示详细的启动日志，可以看到为什么启动失败
# 按 Ctrl+C 退出
```

## 常见原因

### 1. 容器启动后立即退出

**检查**：
```bash
# 查看所有容器（包括已停止的）
sudo docker compose ps -a

# 查看退出容器的日志
sudo docker compose logs frontend
sudo docker compose logs backend
```

### 2. 镜像不存在或拉取失败

**检查**：
```bash
# 查看本地镜像
sudo docker images | grep campus-trading

# 如果镜像不存在，手动拉取
export DOCKER_USERNAME=yxw555
sudo docker compose pull
```

### 3. docker-compose.yml 配置错误

**检查**：
```bash
# 验证配置文件语法
sudo docker compose config

# 如果有错误，会显示出来
```

### 4. 端口冲突

**检查**：
```bash
# 检查端口是否被占用
sudo netstat -tulpn | grep 80
sudo netstat -tulpn | grep 8080
```

### 5. 环境变量未设置

**检查**：
```bash
# 检查环境变量
echo $DOCKER_USERNAME

# 如果没有设置，需要设置
export DOCKER_USERNAME=yxw555
```

## 完整排查和修复流程

```bash
cd /opt/campus-trading-platform

# 1. 设置环境变量
export DOCKER_USERNAME=yxw555

# 2. 检查配置文件
sudo docker compose config

# 3. 查看所有容器（包括已停止的）
sudo docker compose ps -a

# 4. 如果容器存在但已停止，查看日志
sudo docker compose logs --tail=100

# 5. 尝试启动
sudo docker compose up -d

# 6. 等待并检查
sleep 10
sudo docker compose ps

# 7. 如果还是不行，查看详细启动日志
sudo docker compose up
```

## 如果启动失败

查看详细错误信息：

```bash
# 查看所有服务的启动日志
sudo docker compose up 2>&1 | tee /tmp/docker-compose.log

# 或者逐个检查
sudo docker compose up frontend
sudo docker compose up backend
sudo docker compose up mysql
```

## 快速修复命令

```bash
cd /opt/campus-trading-platform
export DOCKER_USERNAME=yxw555

# 停止所有（如果存在）
sudo docker compose down

# 重新启动
sudo docker compose up -d

# 查看状态
sudo docker compose ps

# 查看日志
sudo docker compose logs -f
```

