{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\utils\\mapUtil.js","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\utils\\mapUtil.js","mtime":1767671567796},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/es6.array.from\";\nimport \"core-js/modules/es6.regexp.to-string\";\nimport _defineProperty from \"D:/Git/my_ruangong/campus-trading-platform/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.search\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"regenerator-runtime/runtime\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.set\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.match\";\nimport _asyncToGenerator from \"D:/Git/my_ruangong/campus-trading-platform/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n/**\n * 地图工具类\n * 封装高德地图相关功能\n */\n// 地图API加载状态\nvar mapApiLoaded = false;\nvar mapApiLoading = false;\n/**\n * 动态加载高德地图API\n * @returns {Promise} 返回Promise，加载完成后resolve\n */\n\nexport function loadAmapApi() {\n  return new Promise(function (resolve, reject) {\n    // 如果已经加载，直接resolve\n    if (window.AMap) {\n      mapApiLoaded = true;\n      resolve();\n      return;\n    } // 如果正在加载，等待加载完成\n\n\n    if (mapApiLoading) {\n      var checkInterval = setInterval(function () {\n        if (window.AMap) {\n          clearInterval(checkInterval);\n          mapApiLoaded = true;\n          resolve();\n        }\n      }, 100);\n      return;\n    } // 开始加载\n\n\n    mapApiLoading = true; // 从环境变量获取API Key，如果没有则使用本地测试 Key（仅用于本地开发）\n\n    var apiKey = process.env.VUE_APP_AMAP_KEY || 'b2e5855e71acf8f3156a6409b5247086';\n    console.log('读取到的API Key:', apiKey ? apiKey.substring(0, 8) + '...' : '未配置');\n\n    if (apiKey === 'YOUR_AMAP_KEY' || !apiKey) {\n      console.warn('高德地图API Key未配置，请在.env文件中设置VUE_APP_AMAP_KEY');\n      console.warn('当前环境变量值:', process.env.VUE_APP_AMAP_KEY);\n      reject(new Error('高德地图API Key未配置，请在frontend目录下创建.env文件并设置VUE_APP_AMAP_KEY'));\n      return;\n    } // 创建script标签\n\n\n    var script = document.createElement('script');\n    script.type = 'text/javascript';\n    script.src = \"https://webapi.amap.com/maps?v=2.0&key=\".concat(apiKey, \"&plugin=AMap.Geocoder,AMap.Driving,AMap.PlaceSearch\");\n    script.async = true;\n\n    script.onload = function () {\n      mapApiLoaded = true;\n      mapApiLoading = false;\n      console.log('高德地图API加载成功');\n      resolve();\n    };\n\n    script.onerror = function () {\n      mapApiLoading = false;\n      console.error('高德地图API加载失败');\n      reject(new Error('高德地图API加载失败，请检查网络连接和API Key'));\n    }; // 添加到head\n\n\n    document.head.appendChild(script);\n  });\n}\n/**\n * 初始化地图\n * @param {String} containerId 地图容器ID\n * @param {Object} options 地图配置选项\n * @returns {Promise<AMap.Map>} 返回Promise，resolve包含地图实例\n */\n\nexport function initMap(_x) {\n  return _initMap.apply(this, arguments);\n}\n/**\n * 地址解析（Geocoding）\n * @param {String} address 地址文本\n * @returns {Promise} 返回Promise，resolve包含{lng, lat, address}\n */\n\nfunction _initMap() {\n  _initMap = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(containerId) {\n    var options,\n        defaultOptions,\n        _args2 = arguments;\n    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            options = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : {};\n            _context2.next = 3;\n            return loadAmapApi();\n\n          case 3:\n            if (window.AMap) {\n              _context2.next = 5;\n              break;\n            }\n\n            throw new Error('高德地图API未加载，请检查API Key配置');\n\n          case 5:\n            defaultOptions = _objectSpread({\n              zoom: 13,\n              center: [116.397428, 39.90923],\n              // 默认中心点（北京）\n              viewMode: '3D'\n            }, options);\n            return _context2.abrupt(\"return\", new AMap.Map(containerId, defaultOptions));\n\n          case 7:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _initMap.apply(this, arguments);\n}\n\nexport function geocodeAddress(address) {\n  return new Promise(function (resolve, reject) {\n    if (!window.AMap) {\n      reject(new Error('高德地图API未加载'));\n      return;\n    }\n\n    if (!address || !address.trim()) {\n      reject(new Error('地址不能为空'));\n      return;\n    } // 清理地址，去除多余空格\n\n\n    var cleanAddress = address.trim(); // 如果地址不包含城市信息，尝试添加常见城市（可以根据实际情况调整）\n\n    var searchAddress = cleanAddress; // 如果地址看起来不完整（比如只有学校名称），尝试添加\"大学\"或\"学院\"等关键词\n    // 或者使用POI搜索\n\n    console.log('开始解析地址:', cleanAddress); // 如果地址过短或不包含城市/区/省等关键词，优先使用POI搜索（对学校名、宿舍等更友好）\n\n    var shortAddressPattern = /^.{0,6}$|(?:大学|学院|宿舍|校区|教室|寝室)/i;\n    var containsCityPattern = /(市|省|区|县|县级|自治州|市辖区)/i;\n    var tryPlaceSearchFirst = shortAddressPattern.test(cleanAddress) && !containsCityPattern.test(cleanAddress);\n    var geocoder = new AMap.Geocoder({\n      city: '全国',\n      // 全国范围搜索\n      timeout: 10000 // 10秒超时\n\n    }); // helper to handle geocoder callback\n\n    var handleGeocoderResult = function handleGeocoderResult(status, result) {\n      console.log('地址解析结果:', status, result);\n\n      if (status === 'complete' && result.geocodes && result.geocodes.length > 0) {\n        var location = result.geocodes[0].location;\n        var formattedAddress = result.geocodes[0].formattedAddress || cleanAddress;\n        console.log('地址解析成功:', {\n          original: cleanAddress,\n          formatted: formattedAddress,\n          location: [location.lng, location.lat]\n        });\n        resolve({\n          lng: location.lng,\n          lat: location.lat,\n          address: cleanAddress,\n          formattedAddress: formattedAddress\n        });\n      } else {\n        console.warn('地理编码失败，尝试POI搜索:', cleanAddress);\n        searchByPOI(cleanAddress).then(resolve).catch(function (err) {\n          console.error('地址解析失败:', cleanAddress, '状态:', status, 'err:', err && err.message);\n          reject(new Error(\"\\u5730\\u5740\\u89E3\\u6790\\u5931\\u8D25: \\\"\".concat(cleanAddress, \"\\\"\\u3002\\u8BF7\\u786E\\u4FDD\\u5730\\u5740\\u5305\\u542B\\u57CE\\u5E02\\u548C\\u8BE6\\u7EC6\\u4F4D\\u7F6E\\uFF0C\\u4F8B\\u5982\\uFF1A\\\"\\u5317\\u4EAC\\u5E02\\u6E05\\u534E\\u5927\\u5B66\\\"\")));\n        });\n      }\n    }; // 优先尝试后端代理（可以绕过前端 Referer 白名单问题）\n    // 构建候选尝试：优先原始地址+可能的城市，再尝试学校名或去掉口语化后缀的版本\n\n\n    var cityMatch = cleanAddress.match(/(.+?市)/);\n    var cityCandidate = cityMatch ? cityMatch[1] : null; // 提取学校名（与searchByPOI的pattern一致）\n\n    var schoolName = null;\n\n    for (var _i = 0, _arr = [/^(.+?)(?:校区|宿舍|东区|西区|南区|北区|.*?宿舍)/, /^(.+?大学)/, /^(.+?学院)/, /^(.+?学校)/]; _i < _arr.length; _i++) {\n      var pattern = _arr[_i];\n      var m = cleanAddress.match(pattern);\n\n      if (m && m[1]) {\n        schoolName = m[1].trim();\n        break;\n      }\n    }\n\n    var attempts = [];\n    attempts.push({\n      address: cleanAddress,\n      city: cityCandidate\n    });\n\n    if (schoolName) {\n      attempts.push({\n        address: schoolName,\n        city: cityCandidate\n      });\n      if (cityCandidate) attempts.push({\n        address: \"\".concat(cityCandidate).concat(schoolName),\n        city: cityCandidate\n      });\n    } // 尝试去掉诸如\"浴室旁边\"、\"学生公寓5号楼\"等后缀（常见干扰词）\n\n\n    var noisySuffixPattern = /(浴室|旁边|学生公寓|学生宿舍|楼|号楼|寝室|教室|旁|附近|旁边)$/;\n    var shortClean = cleanAddress.replace(noisySuffixPattern, '').trim();\n\n    if (shortClean && shortClean !== cleanAddress) {\n      attempts.push({\n        address: shortClean,\n        city: cityCandidate\n      });\n    } // Deduplicate attempts by address+city\n\n\n    var seen = new Set();\n    var uniqueAttempts = [];\n\n    for (var _i2 = 0, _attempts = attempts; _i2 < _attempts.length; _i2++) {\n      var a = _attempts[_i2];\n      var key = \"\".concat(a.address, \"||\").concat(a.city || '');\n\n      if (!seen.has(key)) {\n        seen.add(key);\n        uniqueAttempts.push(a);\n      }\n    }\n\n    var tryProxyAttempts = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _iterator, _step, attempt, q, res, data;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _iterator = _createForOfIteratorHelper(uniqueAttempts);\n                _context.prev = 1;\n\n                _iterator.s();\n\n              case 3:\n                if ((_step = _iterator.n()).done) {\n                  _context.next = 24;\n                  break;\n                }\n\n                attempt = _step.value;\n                q = \"/api/geocode?address=\".concat(encodeURIComponent(attempt.address)).concat(attempt.city ? \"&city=\".concat(encodeURIComponent(attempt.city)) : '');\n                console.log('尝试后端代理解析地址:', q);\n                _context.prev = 7;\n                _context.next = 10;\n                return fetch(q, {\n                  method: 'GET'\n                });\n\n              case 10:\n                res = _context.sent;\n                _context.next = 13;\n                return res.json();\n\n              case 13:\n                data = _context.sent;\n                console.log('后端代理返回（尝试）:', attempt, data);\n\n                if (!(data && data.status_code === 1 && data.data && data.data.lng && data.data.lat)) {\n                  _context.next = 17;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", {\n                  lng: Number(data.data.lng),\n                  lat: Number(data.data.lat),\n                  address: attempt.address,\n                  formattedAddress: data.data.formattedAddress || attempt.address\n                });\n\n              case 17:\n                _context.next = 22;\n                break;\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](7);\n                console.warn('后端代理调用异常，尝试下一个候选:', _context.t0);\n\n              case 22:\n                _context.next = 3;\n                break;\n\n              case 24:\n                _context.next = 29;\n                break;\n\n              case 26:\n                _context.prev = 26;\n                _context.t1 = _context[\"catch\"](1);\n\n                _iterator.e(_context.t1);\n\n              case 29:\n                _context.prev = 29;\n\n                _iterator.f();\n\n                return _context.finish(29);\n\n              case 32:\n                return _context.abrupt(\"return\", null);\n\n              case 33:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[1, 26, 29, 32], [7, 19]]);\n      }));\n\n      return function tryProxyAttempts() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    tryProxyAttempts().then(function (proxyResult) {\n      if (proxyResult) {\n        resolve(proxyResult);\n        return;\n      } // 代理未命中，继续使用前端 SDK 的策略（先POI或geocoder）\n\n\n      if (tryPlaceSearchFirst) {\n        console.log('代理未命中，优先尝试POI搜索:', cleanAddress);\n        searchByPOI(cleanAddress, cityCandidate).then(resolve).catch(function (err) {\n          console.warn('POI搜索未命中，回退地理编码:', err && err.message);\n          geocoder.getLocation(cleanAddress, handleGeocoderResult);\n        });\n      } else {\n        geocoder.getLocation(cleanAddress, handleGeocoderResult);\n      }\n    }).catch(function (err) {\n      console.warn('后端代理批量尝试失败，使用客户端解析:', err);\n\n      if (tryPlaceSearchFirst) {\n        searchByPOI(cleanAddress, cityCandidate).then(resolve).catch(function () {\n          return geocoder.getLocation(cleanAddress, handleGeocoderResult);\n        });\n      } else {\n        geocoder.getLocation(cleanAddress, handleGeocoderResult);\n      }\n    });\n  });\n}\n/**\n * 使用POI搜索地址（当地理编码失败时使用）\n * @param {String} keyword 搜索关键词\n * @returns {Promise} 返回Promise，resolve包含{lng, lat, address}\n */\n\nfunction searchByPOI(keyword) {\n  return new Promise(function (resolve, reject) {\n    if (!window.AMap) {\n      reject(new Error('高德地图API未加载'));\n      return;\n    } // 尝试提取学校名称（去除宿舍等后缀）\n\n\n    var searchKeyword = keyword; // 如果包含\"宿舍\"、\"校区\"等关键词，尝试提取学校名称部分\n\n    var schoolPatterns = [/^(.+?)(?:校区|宿舍|东区|西区|南区|北区|.*?宿舍)/, // 匹配\"学校名称+校区/宿舍\"\n    /^(.+?大学)/, // 匹配\"XX大学\"\n    /^(.+?学院)/, // 匹配\"XX学院\"\n    /^(.+?学校)/ // 匹配\"XX学校\"\n    ];\n\n    for (var _i3 = 0, _schoolPatterns = schoolPatterns; _i3 < _schoolPatterns.length; _i3++) {\n      var pattern = _schoolPatterns[_i3];\n      var match = keyword.match(pattern);\n\n      if (match && match[1]) {\n        searchKeyword = match[1].trim();\n        console.log('提取学校名称:', searchKeyword, '从:', keyword);\n        break;\n      }\n    }\n\n    var placeSearch = new AMap.PlaceSearch({\n      city: '全国',\n      citylimit: false,\n      type: '高等院校|科教文化服务' // 优先搜索学校\n\n    }); // 先尝试搜索提取的学校名称\n\n    placeSearch.search(searchKeyword, function (status, result) {\n      if (status === 'complete' && result.poiList && result.poiList.pois && result.poiList.pois.length > 0) {\n        var poi = result.poiList.pois[0];\n        var location = poi.location;\n        console.log('POI搜索成功:', {\n          keyword: keyword,\n          searchKeyword: searchKeyword,\n          name: poi.name,\n          address: poi.address,\n          location: [location.lng, location.lat]\n        });\n        resolve({\n          lng: location.lng,\n          lat: location.lat,\n          address: keyword,\n          formattedAddress: poi.address || poi.name\n        });\n      } else {\n        // 如果提取的学校名称搜索失败，尝试用原始关键词搜索\n        if (searchKeyword !== keyword) {\n          console.log('学校名称搜索失败，尝试原始关键词:', keyword);\n          placeSearch.search(keyword, function (status2, result2) {\n            if (status2 === 'complete' && result2.poiList && result2.poiList.pois && result2.poiList.pois.length > 0) {\n              var _poi = result2.poiList.pois[0];\n              var _location = _poi.location;\n              resolve({\n                lng: _location.lng,\n                lat: _location.lat,\n                address: keyword,\n                formattedAddress: _poi.address || _poi.name\n              });\n            } else {\n              reject(new Error('POI搜索失败: ' + keyword));\n            }\n          });\n        } else {\n          reject(new Error('POI搜索失败: ' + keyword));\n        }\n      }\n    });\n  });\n}\n/**\n * 添加地图标记\n * @param {AMap.Map} map 地图实例\n * @param {Object} location 位置对象 {lng, lat, address}\n * @param {String} title 标记标题\n * @param {String} type 标记类型 'seller' | 'buyer'\n */\n\n\nexport function addMarker(map, location, title) {\n  var type = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'default';\n\n  if (!map || !location) {\n    console.warn('addMarker: 参数无效', {\n      map: map,\n      location: location\n    });\n    return null;\n  }\n\n  if (!location.lng || !location.lat) {\n    console.error('addMarker: 位置坐标无效', location);\n    return null;\n  }\n\n  console.log('添加标记:', {\n    title: title,\n    type: type,\n    location: [location.lng, location.lat]\n  });\n  var iconMap = {\n    seller: 'https://webapi.amap.com/theme/v1.3/markers/n/mid_red.png',\n    // 红色（卖家）\n    buyer: 'https://webapi.amap.com/theme/v1.3/markers/n/mid_blue.png',\n    // 蓝色（买家）\n    default: 'https://webapi.amap.com/theme/v1.3/markers/n/mid_green.png' // 绿色（默认）\n\n  };\n  var icon = iconMap[type] || iconMap.default;\n  var marker = new AMap.Marker({\n    position: [location.lng, location.lat],\n    title: title,\n    icon: new AMap.Icon({\n      image: icon,\n      size: new AMap.Size(32, 32),\n      imageSize: new AMap.Size(32, 32)\n    })\n  }); // 添加信息窗口\n\n  var infoWindow = new AMap.InfoWindow({\n    content: \"<div style=\\\"padding: 5px; min-width: 150px;\\\">\\n            <strong style=\\\"color: #409EFF;\\\">\".concat(title, \"</strong><br/>\\n            <span style=\\\"font-size: 12px; color: #666;\\\">\").concat(location.address || location.formattedAddress || '', \"</span>\\n        </div>\")\n  });\n  marker.on('click', function () {\n    infoWindow.open(map, marker.getPosition());\n  });\n  map.add(marker);\n  console.log('标记已添加到地图:', marker, '位置:', [location.lng, location.lat]);\n  return marker;\n}\n/**\n * 计算两点间距离\n * @param {Object} location1 位置1 {lng, lat}\n * @param {Object} location2 位置2 {lng, lat}\n * @returns {Number} 距离（米）\n */\n\nexport function calculateDistance(location1, location2) {\n  if (!window.AMap || !location1 || !location2) {\n    return null;\n  }\n\n  return AMap.GeometryUtil.distance([location1.lng, location1.lat], [location2.lng, location2.lat]);\n}\n/**\n * 格式化距离文本\n * @param {Number} distance 距离（米）\n * @returns {String} 格式化后的距离文本\n */\n\nexport function formatDistance(distance) {\n  if (distance === null || distance === undefined) {\n    return '计算中...';\n  }\n\n  if (distance < 1000) {\n    return \"\\u7EA6 \".concat(Math.round(distance), \" \\u7C73\");\n  } else {\n    return \"\\u7EA6 \".concat((distance / 1000).toFixed(2), \" \\u516C\\u91CC\");\n  }\n}\n/**\n * 更新地图视野，包含所有标记点\n * @param {AMap.Map} map 地图实例\n * @param {Array} locations 位置数组 [{lng, lat}, ...]\n */\n\nexport function fitMapView(map, locations) {\n  if (!map || !locations || locations.length === 0) {\n    console.warn('fitMapView: 参数无效', {\n      map: map,\n      locations: locations\n    });\n    return;\n  } // 过滤无效坐标\n\n\n  var points = locations.map(function (loc) {\n    if (!loc || typeof loc.lng !== 'number' || typeof loc.lat !== 'number') {\n      console.error('fitMapView: 位置坐标无效', loc);\n      return null;\n    }\n\n    return [loc.lng, loc.lat];\n  }).filter(function (p) {\n    return p !== null;\n  });\n\n  if (points.length === 0) {\n    console.error('fitMapView: 没有有效的坐标点');\n    return;\n  }\n\n  console.log('调整地图视野，包含点:', points);\n\n  try {\n    if (points.length === 1) {\n      // 只有一个点，直接设置中心点和缩放\n      map.setCenter(points[0]);\n      map.setZoom(15);\n      console.log('地图视野调整成功（单点）:', points[0]);\n    } else {\n      // 多个点，使用setFitView\n      // 高德地图的setFitView需要传入坐标数组，而不是Marker数组\n      map.setFitView(points, false, [50, 50, 50, 50]);\n      console.log('地图视野调整成功（多点）:', points);\n    }\n  } catch (e) {\n    console.error('调整地图视野失败:', e); // 如果setFitView失败，至少设置中心点\n\n    if (points.length > 0) {\n      map.setCenter(points[0]);\n      map.setZoom(15);\n      console.log('使用备用方法设置地图中心:', points[0]);\n    }\n  }\n}\n/**\n * 打开导航\n * @param {Object} location 目标位置 {lng, lat, address}\n * @param {String} mode 导航模式 'car' | 'walk' | 'bus'\n */\n\nexport function openNavigation(location) {\n  var mode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'car';\n\n  if (!location || !location.lng || !location.lat) {\n    throw new Error('位置信息不完整');\n  }\n\n  var toName = location.address || location.formattedAddress || '目的地';\n  var url = \"https://uri.amap.com/navigation?to=\".concat(location.lng, \",\").concat(location.lat, \"&toName=\").concat(encodeURIComponent(toName), \"&mode=\").concat(mode, \"&policy=1&src=mypage&callnative=1\");\n  window.open(url, '_blank');\n}\n/**\n * 在高德地图中打开从 start 到 end 的路线页面（在页面上会展示两点和路线并包含距离信息）\n * start / end 格式: {lng, lat, address}\n */\n\nexport function openRouteInAmap(start, end) {\n  var mode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'car';\n\n  if (!start || !end || !start.lng || !start.lat || !end.lng || !end.lat) {\n    throw new Error('起点或终点信息不完整');\n  }\n\n  var fromName = start.address || start.formattedAddress || '起点';\n  var toName = end.address || end.formattedAddress || '终点'; // 使用 amap uri scheme 的 route 接口展示驾车/步行/公交路线\n\n  var url = \"https://uri.amap.com/route?from=\".concat(start.lng, \",\").concat(start.lat, \",\").concat(encodeURIComponent(fromName), \"&to=\").concat(end.lng, \",\").concat(end.lat, \",\").concat(encodeURIComponent(toName), \"&policy=1&src=mypage&callnative=1\");\n  window.open(url, '_blank');\n}\n/**\n * 绘制驾驶路线（从start到end）\n * @param {AMap.Map} map 地图实例\n * @param {Object} start {lng, lat}\n * @param {Object} end {lng, lat}\n * @returns {Promise} resolve(routeInfo)\n */\n\nexport function drawDrivingRoute(map, start, end) {\n  return new Promise(function (resolve, reject) {\n    if (!window.AMap) {\n      reject(new Error('高德地图API未加载'));\n      return;\n    }\n\n    if (!map || !start || !end) {\n      reject(new Error('drawDrivingRoute: 参数不足'));\n      return;\n    }\n\n    try {\n      // 清理已有路线\n      clearRoute(map);\n      var driving = new AMap.Driving({// 使用默认策略\n      });\n      var origin = [start.lng, start.lat];\n      var destination = [end.lng, end.lat];\n      driving.search(origin, destination, function (status, result) {\n        if (status !== 'complete' || !result || !result.routes || result.routes.length === 0) {\n          reject(new Error('路线搜索失败'));\n          return;\n        }\n\n        var route = result.routes[0]; // 合并所有路径点\n\n        var path = [];\n\n        if (route && route.steps) {\n          route.steps.forEach(function (step) {\n            if (step.path && step.path.length > 0) {\n              step.path.forEach(function (p) {\n                return path.push(p);\n              });\n            }\n          });\n        } // 创建折线\n\n\n        var polyline = new AMap.Polyline({\n          path: path,\n          strokeColor: '#3366FF',\n          strokeWeight: 5,\n          strokeOpacity: 0.8,\n          showDir: true\n        }); // 起终点标记\n\n        var startMarker = new AMap.Marker({\n          position: origin,\n          title: '起点',\n          icon: new AMap.Icon({\n            image: 'https://webapi.amap.com/theme/v1.3/markers/n/start.png',\n            size: new AMap.Size(24, 34),\n            imageSize: new AMap.Size(24, 34)\n          })\n        });\n        var endMarker = new AMap.Marker({\n          position: destination,\n          title: '终点',\n          icon: new AMap.Icon({\n            image: 'https://webapi.amap.com/theme/v1.3/markers/n/end.png',\n            size: new AMap.Size(24, 34),\n            imageSize: new AMap.Size(24, 34)\n          })\n        }); // 将覆盖物添加到地图并保存引用以便清理\n\n        map.add(polyline);\n        map.add(startMarker);\n        map.add(endMarker);\n        if (!map.__routeOverlays) map.__routeOverlays = [];\n\n        map.__routeOverlays.push(polyline, startMarker, endMarker); // 适配视野\n\n\n        try {\n          map.setFitView([polyline], false, [50, 50, 50, 50]);\n        } catch (e) {\n          // fallback: fit bounds by points\n          try {\n            map.setFitView();\n          } catch (e2) {}\n        }\n\n        resolve({\n          distance: route.distance || null,\n          duration: route.duration || null,\n          path: path\n        });\n      });\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n/**\n * 清除当前地图上的路线覆盖物（如果存在）\n * @param {AMap.Map} map\n */\n\nexport function clearRoute(map) {\n  if (!map) return;\n\n  if (map.__routeOverlays && Array.isArray(map.__routeOverlays)) {\n    try {\n      map.__routeOverlays.forEach(function (ov) {\n        try {\n          map.remove(ov);\n        } catch (e) {}\n      });\n    } catch (e) {}\n\n    map.__routeOverlays = [];\n  }\n}",{"version":3,"sources":["D:/Git/my_ruangong/campus-trading-platform/frontend/src/utils/mapUtil.js"],"names":["mapApiLoaded","mapApiLoading","loadAmapApi","Promise","resolve","reject","window","AMap","checkInterval","setInterval","clearInterval","apiKey","process","env","VUE_APP_AMAP_KEY","console","log","substring","warn","Error","script","document","createElement","type","src","async","onload","onerror","error","head","appendChild","initMap","containerId","options","defaultOptions","zoom","center","viewMode","Map","geocodeAddress","address","trim","cleanAddress","searchAddress","shortAddressPattern","containsCityPattern","tryPlaceSearchFirst","test","geocoder","Geocoder","city","timeout","handleGeocoderResult","status","result","geocodes","length","location","formattedAddress","original","formatted","lng","lat","searchByPOI","then","catch","err","message","cityMatch","match","cityCandidate","schoolName","pattern","m","attempts","push","noisySuffixPattern","shortClean","replace","seen","Set","uniqueAttempts","a","key","has","add","tryProxyAttempts","attempt","q","encodeURIComponent","fetch","method","res","json","data","status_code","Number","proxyResult","getLocation","keyword","searchKeyword","schoolPatterns","placeSearch","PlaceSearch","citylimit","search","poiList","pois","poi","name","status2","result2","addMarker","map","title","iconMap","seller","buyer","default","icon","marker","Marker","position","Icon","image","size","Size","imageSize","infoWindow","InfoWindow","content","on","open","getPosition","calculateDistance","location1","location2","GeometryUtil","distance","formatDistance","undefined","Math","round","toFixed","fitMapView","locations","points","loc","filter","p","setCenter","setZoom","setFitView","e","openNavigation","mode","toName","url","openRouteInAmap","start","end","fromName","drawDrivingRoute","clearRoute","driving","Driving","origin","destination","routes","route","path","steps","forEach","step","polyline","Polyline","strokeColor","strokeWeight","strokeOpacity","showDir","startMarker","endMarker","__routeOverlays","e2","duration","Array","isArray","ov","remove"],"mappings":"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","sourcesContent":["/**\n * 地图工具类\n * 封装高德地图相关功能\n */\n\n// 地图API加载状态\nlet mapApiLoaded = false;\nlet mapApiLoading = false;\n\n/**\n * 动态加载高德地图API\n * @returns {Promise} 返回Promise，加载完成后resolve\n */\nexport function loadAmapApi() {\n    return new Promise((resolve, reject) => {\n        // 如果已经加载，直接resolve\n        if (window.AMap) {\n            mapApiLoaded = true;\n            resolve();\n            return;\n        }\n        \n        // 如果正在加载，等待加载完成\n        if (mapApiLoading) {\n            const checkInterval = setInterval(() => {\n                if (window.AMap) {\n                    clearInterval(checkInterval);\n                    mapApiLoaded = true;\n                    resolve();\n                }\n            }, 100);\n            return;\n        }\n        \n        // 开始加载\n        mapApiLoading = true;\n        \n        // 从环境变量获取API Key，如果没有则使用本地测试 Key（仅用于本地开发）\n        const apiKey = process.env.VUE_APP_AMAP_KEY || 'b2e5855e71acf8f3156a6409b5247086';\n        \n        console.log('读取到的API Key:', apiKey ? apiKey.substring(0, 8) + '...' : '未配置');\n        \n        if (apiKey === 'YOUR_AMAP_KEY' || !apiKey) {\n            console.warn('高德地图API Key未配置，请在.env文件中设置VUE_APP_AMAP_KEY');\n            console.warn('当前环境变量值:', process.env.VUE_APP_AMAP_KEY);\n            reject(new Error('高德地图API Key未配置，请在frontend目录下创建.env文件并设置VUE_APP_AMAP_KEY'));\n            return;\n        }\n        \n        // 创建script标签\n        const script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.src = `https://webapi.amap.com/maps?v=2.0&key=${apiKey}&plugin=AMap.Geocoder,AMap.Driving,AMap.PlaceSearch`;\n        script.async = true;\n        \n        script.onload = () => {\n            mapApiLoaded = true;\n            mapApiLoading = false;\n            console.log('高德地图API加载成功');\n            resolve();\n        };\n        \n        script.onerror = () => {\n            mapApiLoading = false;\n            console.error('高德地图API加载失败');\n            reject(new Error('高德地图API加载失败，请检查网络连接和API Key'));\n        };\n        \n        // 添加到head\n        document.head.appendChild(script);\n    });\n}\n\n/**\n * 初始化地图\n * @param {String} containerId 地图容器ID\n * @param {Object} options 地图配置选项\n * @returns {Promise<AMap.Map>} 返回Promise，resolve包含地图实例\n */\nexport async function initMap(containerId, options = {}) {\n    // 确保API已加载\n    await loadAmapApi();\n    \n    if (!window.AMap) {\n        throw new Error('高德地图API未加载，请检查API Key配置');\n    }\n    \n    const defaultOptions = {\n        zoom: 13,\n        center: [116.397428, 39.90923], // 默认中心点（北京）\n        viewMode: '3D',\n        ...options\n    };\n    \n    return new AMap.Map(containerId, defaultOptions);\n}\n\n/**\n * 地址解析（Geocoding）\n * @param {String} address 地址文本\n * @returns {Promise} 返回Promise，resolve包含{lng, lat, address}\n */\nexport function geocodeAddress(address) {\n    return new Promise((resolve, reject) => {\n        if (!window.AMap) {\n            reject(new Error('高德地图API未加载'));\n            return;\n        }\n        \n        if (!address || !address.trim()) {\n            reject(new Error('地址不能为空'));\n            return;\n        }\n        \n        // 清理地址，去除多余空格\n        const cleanAddress = address.trim();\n        \n        // 如果地址不包含城市信息，尝试添加常见城市（可以根据实际情况调整）\n        let searchAddress = cleanAddress;\n        \n        // 如果地址看起来不完整（比如只有学校名称），尝试添加\"大学\"或\"学院\"等关键词\n        // 或者使用POI搜索\n        console.log('开始解析地址:', cleanAddress);\n\n        // 如果地址过短或不包含城市/区/省等关键词，优先使用POI搜索（对学校名、宿舍等更友好）\n        const shortAddressPattern = /^.{0,6}$|(?:大学|学院|宿舍|校区|教室|寝室)/i;\n        const containsCityPattern = /(市|省|区|县|县级|自治州|市辖区)/i;\n\n        const tryPlaceSearchFirst = shortAddressPattern.test(cleanAddress) && !containsCityPattern.test(cleanAddress);\n\n        const geocoder = new AMap.Geocoder({\n            city: '全国', // 全国范围搜索\n            timeout: 10000 // 10秒超时\n        });\n\n        // helper to handle geocoder callback\n        const handleGeocoderResult = (status, result) => {\n            console.log('地址解析结果:', status, result);\n            if (status === 'complete' && result.geocodes && result.geocodes.length > 0) {\n                const location = result.geocodes[0].location;\n                const formattedAddress = result.geocodes[0].formattedAddress || cleanAddress;\n                console.log('地址解析成功:', {\n                    original: cleanAddress,\n                    formatted: formattedAddress,\n                    location: [location.lng, location.lat]\n                });\n                resolve({\n                    lng: location.lng,\n                    lat: location.lat,\n                    address: cleanAddress,\n                    formattedAddress: formattedAddress\n                });\n            } else {\n                console.warn('地理编码失败，尝试POI搜索:', cleanAddress);\n                searchByPOI(cleanAddress).then(resolve).catch((err) => {\n                    console.error('地址解析失败:', cleanAddress, '状态:', status, 'err:', err && err.message);\n                    reject(new Error(`地址解析失败: \"${cleanAddress}\"。请确保地址包含城市和详细位置，例如：\"北京市清华大学\"`));\n                });\n            }\n        };\n\n        // 优先尝试后端代理（可以绕过前端 Referer 白名单问题）\n        // 构建候选尝试：优先原始地址+可能的城市，再尝试学校名或去掉口语化后缀的版本\n        const cityMatch = cleanAddress.match(/(.+?市)/);\n        const cityCandidate = cityMatch ? cityMatch[1] : null;\n\n        // 提取学校名（与searchByPOI的pattern一致）\n        let schoolName = null;\n        for (const pattern of [\n            /^(.+?)(?:校区|宿舍|东区|西区|南区|北区|.*?宿舍)/,\n            /^(.+?大学)/,\n            /^(.+?学院)/,\n            /^(.+?学校)/\n        ]) {\n            const m = cleanAddress.match(pattern);\n            if (m && m[1]) {\n                schoolName = m[1].trim();\n                break;\n            }\n        }\n\n        const attempts = [];\n        attempts.push({ address: cleanAddress, city: cityCandidate });\n        if (schoolName) {\n            attempts.push({ address: schoolName, city: cityCandidate });\n            if (cityCandidate) attempts.push({ address: `${cityCandidate}${schoolName}`, city: cityCandidate });\n        }\n        // 尝试去掉诸如\"浴室旁边\"、\"学生公寓5号楼\"等后缀（常见干扰词）\n        const noisySuffixPattern = /(浴室|旁边|学生公寓|学生宿舍|楼|号楼|寝室|教室|旁|附近|旁边)$/;\n        const shortClean = cleanAddress.replace(noisySuffixPattern, '').trim();\n        if (shortClean && shortClean !== cleanAddress) {\n            attempts.push({ address: shortClean, city: cityCandidate });\n        }\n\n        // Deduplicate attempts by address+city\n        const seen = new Set();\n        const uniqueAttempts = [];\n        for (const a of attempts) {\n            const key = `${a.address}||${a.city || ''}`;\n            if (!seen.has(key)) {\n                seen.add(key);\n                uniqueAttempts.push(a);\n            }\n        }\n\n        const tryProxyAttempts = async () => {\n            for (const attempt of uniqueAttempts) {\n                const q = `/api/geocode?address=${encodeURIComponent(attempt.address)}${attempt.city ? `&city=${encodeURIComponent(attempt.city)}` : ''}`;\n                console.log('尝试后端代理解析地址:', q);\n                try {\n                    const res = await fetch(q, { method: 'GET' });\n                    const data = await res.json();\n                    console.log('后端代理返回（尝试）:', attempt, data);\n                    if (data && data.status_code === 1 && data.data && data.data.lng && data.data.lat) {\n                        return {\n                            lng: Number(data.data.lng),\n                            lat: Number(data.data.lat),\n                            address: attempt.address,\n                            formattedAddress: data.data.formattedAddress || attempt.address\n                        };\n                    }\n                } catch (e) {\n                    console.warn('后端代理调用异常，尝试下一个候选:', e);\n                }\n            }\n            return null;\n        };\n\n        tryProxyAttempts().then(proxyResult => {\n            if (proxyResult) {\n                resolve(proxyResult);\n                return;\n            }\n\n            // 代理未命中，继续使用前端 SDK 的策略（先POI或geocoder）\n            if (tryPlaceSearchFirst) {\n                console.log('代理未命中，优先尝试POI搜索:', cleanAddress);\n                searchByPOI(cleanAddress, cityCandidate).then(resolve).catch((err) => {\n                    console.warn('POI搜索未命中，回退地理编码:', err && err.message);\n                    geocoder.getLocation(cleanAddress, handleGeocoderResult);\n                });\n            } else {\n                geocoder.getLocation(cleanAddress, handleGeocoderResult);\n            }\n        }).catch(err => {\n            console.warn('后端代理批量尝试失败，使用客户端解析:', err);\n            if (tryPlaceSearchFirst) {\n                searchByPOI(cleanAddress, cityCandidate).then(resolve).catch(() => geocoder.getLocation(cleanAddress, handleGeocoderResult));\n            } else {\n                geocoder.getLocation(cleanAddress, handleGeocoderResult);\n            }\n        });\n    });\n}\n\n/**\n * 使用POI搜索地址（当地理编码失败时使用）\n * @param {String} keyword 搜索关键词\n * @returns {Promise} 返回Promise，resolve包含{lng, lat, address}\n */\nfunction searchByPOI(keyword) {\n    return new Promise((resolve, reject) => {\n        if (!window.AMap) {\n            reject(new Error('高德地图API未加载'));\n            return;\n        }\n        \n        // 尝试提取学校名称（去除宿舍等后缀）\n        let searchKeyword = keyword;\n        \n        // 如果包含\"宿舍\"、\"校区\"等关键词，尝试提取学校名称部分\n        const schoolPatterns = [\n            /^(.+?)(?:校区|宿舍|东区|西区|南区|北区|.*?宿舍)/,  // 匹配\"学校名称+校区/宿舍\"\n            /^(.+?大学)/,  // 匹配\"XX大学\"\n            /^(.+?学院)/,  // 匹配\"XX学院\"\n            /^(.+?学校)/,  // 匹配\"XX学校\"\n        ];\n        \n        for (const pattern of schoolPatterns) {\n            const match = keyword.match(pattern);\n            if (match && match[1]) {\n                searchKeyword = match[1].trim();\n                console.log('提取学校名称:', searchKeyword, '从:', keyword);\n                break;\n            }\n        }\n        \n        const placeSearch = new AMap.PlaceSearch({\n            city: '全国',\n            citylimit: false,\n            type: '高等院校|科教文化服务' // 优先搜索学校\n        });\n        \n        // 先尝试搜索提取的学校名称\n        placeSearch.search(searchKeyword, (status, result) => {\n            if (status === 'complete' && result.poiList && result.poiList.pois && result.poiList.pois.length > 0) {\n                const poi = result.poiList.pois[0];\n                const location = poi.location;\n                \n                console.log('POI搜索成功:', {\n                    keyword: keyword,\n                    searchKeyword: searchKeyword,\n                    name: poi.name,\n                    address: poi.address,\n                    location: [location.lng, location.lat]\n                });\n                \n                resolve({\n                    lng: location.lng,\n                    lat: location.lat,\n                    address: keyword,\n                    formattedAddress: poi.address || poi.name\n                });\n            } else {\n                // 如果提取的学校名称搜索失败，尝试用原始关键词搜索\n                if (searchKeyword !== keyword) {\n                    console.log('学校名称搜索失败，尝试原始关键词:', keyword);\n                    placeSearch.search(keyword, (status2, result2) => {\n                        if (status2 === 'complete' && result2.poiList && result2.poiList.pois && result2.poiList.pois.length > 0) {\n                            const poi = result2.poiList.pois[0];\n                            const location = poi.location;\n                            \n                            resolve({\n                                lng: location.lng,\n                                lat: location.lat,\n                                address: keyword,\n                                formattedAddress: poi.address || poi.name\n                            });\n                        } else {\n                            reject(new Error('POI搜索失败: ' + keyword));\n                        }\n                    });\n                } else {\n                    reject(new Error('POI搜索失败: ' + keyword));\n                }\n            }\n        });\n    });\n}\n\n/**\n * 添加地图标记\n * @param {AMap.Map} map 地图实例\n * @param {Object} location 位置对象 {lng, lat, address}\n * @param {String} title 标记标题\n * @param {String} type 标记类型 'seller' | 'buyer'\n */\nexport function addMarker(map, location, title, type = 'default') {\n    if (!map || !location) {\n        console.warn('addMarker: 参数无效', { map, location });\n        return null;\n    }\n    \n    if (!location.lng || !location.lat) {\n        console.error('addMarker: 位置坐标无效', location);\n        return null;\n    }\n    \n    console.log('添加标记:', { title, type, location: [location.lng, location.lat] });\n    \n    const iconMap = {\n        seller: 'https://webapi.amap.com/theme/v1.3/markers/n/mid_red.png', // 红色（卖家）\n        buyer: 'https://webapi.amap.com/theme/v1.3/markers/n/mid_blue.png', // 蓝色（买家）\n        default: 'https://webapi.amap.com/theme/v1.3/markers/n/mid_green.png' // 绿色（默认）\n    };\n    \n    const icon = iconMap[type] || iconMap.default;\n    \n    const marker = new AMap.Marker({\n        position: [location.lng, location.lat],\n        title: title,\n        icon: new AMap.Icon({\n            image: icon,\n            size: new AMap.Size(32, 32),\n            imageSize: new AMap.Size(32, 32)\n        })\n    });\n    \n    // 添加信息窗口\n    const infoWindow = new AMap.InfoWindow({\n        content: `<div style=\"padding: 5px; min-width: 150px;\">\n            <strong style=\"color: #409EFF;\">${title}</strong><br/>\n            <span style=\"font-size: 12px; color: #666;\">${location.address || location.formattedAddress || ''}</span>\n        </div>`\n    });\n    \n    marker.on('click', () => {\n        infoWindow.open(map, marker.getPosition());\n    });\n    \n    map.add(marker);\n    console.log('标记已添加到地图:', marker, '位置:', [location.lng, location.lat]);\n    \n    return marker;\n}\n\n/**\n * 计算两点间距离\n * @param {Object} location1 位置1 {lng, lat}\n * @param {Object} location2 位置2 {lng, lat}\n * @returns {Number} 距离（米）\n */\nexport function calculateDistance(location1, location2) {\n    if (!window.AMap || !location1 || !location2) {\n        return null;\n    }\n    \n    return AMap.GeometryUtil.distance(\n        [location1.lng, location1.lat],\n        [location2.lng, location2.lat]\n    );\n}\n\n/**\n * 格式化距离文本\n * @param {Number} distance 距离（米）\n * @returns {String} 格式化后的距离文本\n */\nexport function formatDistance(distance) {\n    if (distance === null || distance === undefined) {\n        return '计算中...';\n    }\n    \n    if (distance < 1000) {\n        return `约 ${Math.round(distance)} 米`;\n    } else {\n        return `约 ${(distance / 1000).toFixed(2)} 公里`;\n    }\n}\n\n/**\n * 更新地图视野，包含所有标记点\n * @param {AMap.Map} map 地图实例\n * @param {Array} locations 位置数组 [{lng, lat}, ...]\n */\nexport function fitMapView(map, locations) {\n    if (!map || !locations || locations.length === 0) {\n        console.warn('fitMapView: 参数无效', { map, locations });\n        return;\n    }\n    \n    // 过滤无效坐标\n    const points = locations.map(loc => {\n        if (!loc || typeof loc.lng !== 'number' || typeof loc.lat !== 'number') {\n            console.error('fitMapView: 位置坐标无效', loc);\n            return null;\n        }\n        return [loc.lng, loc.lat];\n    }).filter(p => p !== null);\n    \n    if (points.length === 0) {\n        console.error('fitMapView: 没有有效的坐标点');\n        return;\n    }\n    \n    console.log('调整地图视野，包含点:', points);\n    \n    try {\n        if (points.length === 1) {\n            // 只有一个点，直接设置中心点和缩放\n            map.setCenter(points[0]);\n            map.setZoom(15);\n            console.log('地图视野调整成功（单点）:', points[0]);\n        } else {\n            // 多个点，使用setFitView\n            // 高德地图的setFitView需要传入坐标数组，而不是Marker数组\n            map.setFitView(points, false, [50, 50, 50, 50]);\n            console.log('地图视野调整成功（多点）:', points);\n        }\n    } catch (e) {\n        console.error('调整地图视野失败:', e);\n        // 如果setFitView失败，至少设置中心点\n        if (points.length > 0) {\n            map.setCenter(points[0]);\n            map.setZoom(15);\n            console.log('使用备用方法设置地图中心:', points[0]);\n        }\n    }\n}\n\n/**\n * 打开导航\n * @param {Object} location 目标位置 {lng, lat, address}\n * @param {String} mode 导航模式 'car' | 'walk' | 'bus'\n */\nexport function openNavigation(location, mode = 'car') {\n    if (!location || !location.lng || !location.lat) {\n        throw new Error('位置信息不完整');\n    }\n    \n    const toName = location.address || location.formattedAddress || '目的地';\n    const url = `https://uri.amap.com/navigation?to=${location.lng},${location.lat}&toName=${encodeURIComponent(toName)}&mode=${mode}&policy=1&src=mypage&callnative=1`;\n    window.open(url, '_blank');\n}\n\n/**\n * 在高德地图中打开从 start 到 end 的路线页面（在页面上会展示两点和路线并包含距离信息）\n * start / end 格式: {lng, lat, address}\n */\nexport function openRouteInAmap(start, end, mode = 'car') {\n    if (!start || !end || !start.lng || !start.lat || !end.lng || !end.lat) {\n        throw new Error('起点或终点信息不完整');\n    }\n    const fromName = start.address || start.formattedAddress || '起点';\n    const toName = end.address || end.formattedAddress || '终点';\n    // 使用 amap uri scheme 的 route 接口展示驾车/步行/公交路线\n    const url = `https://uri.amap.com/route?from=${start.lng},${start.lat},${encodeURIComponent(fromName)}&to=${end.lng},${end.lat},${encodeURIComponent(toName)}&policy=1&src=mypage&callnative=1`;\n    window.open(url, '_blank');\n}\n\n/**\n * 绘制驾驶路线（从start到end）\n * @param {AMap.Map} map 地图实例\n * @param {Object} start {lng, lat}\n * @param {Object} end {lng, lat}\n * @returns {Promise} resolve(routeInfo)\n */\nexport function drawDrivingRoute(map, start, end) {\n    return new Promise((resolve, reject) => {\n        if (!window.AMap) {\n            reject(new Error('高德地图API未加载'));\n            return;\n        }\n        if (!map || !start || !end) {\n            reject(new Error('drawDrivingRoute: 参数不足'));\n            return;\n        }\n\n        try {\n            // 清理已有路线\n            clearRoute(map);\n\n            const driving = new AMap.Driving({\n                // 使用默认策略\n            });\n\n            const origin = [start.lng, start.lat];\n            const destination = [end.lng, end.lat];\n\n            driving.search(origin, destination, (status, result) => {\n                if (status !== 'complete' || !result || !result.routes || result.routes.length === 0) {\n                    reject(new Error('路线搜索失败'));\n                    return;\n                }\n\n                const route = result.routes[0];\n                // 合并所有路径点\n                const path = [];\n                if (route && route.steps) {\n                    route.steps.forEach(step => {\n                        if (step.path && step.path.length > 0) {\n                            step.path.forEach(p => path.push(p));\n                        }\n                    });\n                }\n\n                // 创建折线\n                const polyline = new AMap.Polyline({\n                    path: path,\n                    strokeColor: '#3366FF',\n                    strokeWeight: 5,\n                    strokeOpacity: 0.8,\n                    showDir: true\n                });\n\n                // 起终点标记\n                const startMarker = new AMap.Marker({\n                    position: origin,\n                    title: '起点',\n                    icon: new AMap.Icon({\n                        image: 'https://webapi.amap.com/theme/v1.3/markers/n/start.png',\n                        size: new AMap.Size(24, 34),\n                        imageSize: new AMap.Size(24, 34)\n                    })\n                });\n                const endMarker = new AMap.Marker({\n                    position: destination,\n                    title: '终点',\n                    icon: new AMap.Icon({\n                        image: 'https://webapi.amap.com/theme/v1.3/markers/n/end.png',\n                        size: new AMap.Size(24, 34),\n                        imageSize: new AMap.Size(24, 34)\n                    })\n                });\n\n                // 将覆盖物添加到地图并保存引用以便清理\n                map.add(polyline);\n                map.add(startMarker);\n                map.add(endMarker);\n\n                if (!map.__routeOverlays) map.__routeOverlays = [];\n                map.__routeOverlays.push(polyline, startMarker, endMarker);\n\n                // 适配视野\n                try {\n                    map.setFitView([polyline], false, [50, 50, 50, 50]);\n                } catch (e) {\n                    // fallback: fit bounds by points\n                    try {\n                        map.setFitView();\n                    } catch (e2) {}\n                }\n\n                resolve({\n                    distance: route.distance || null,\n                    duration: route.duration || null,\n                    path\n                });\n            });\n        } catch (e) {\n            reject(e);\n        }\n    });\n}\n\n/**\n * 清除当前地图上的路线覆盖物（如果存在）\n * @param {AMap.Map} map\n */\nexport function clearRoute(map) {\n    if (!map) return;\n    if (map.__routeOverlays && Array.isArray(map.__routeOverlays)) {\n        try {\n            map.__routeOverlays.forEach(ov => {\n                try {\n                    map.remove(ov);\n                } catch (e) {}\n            });\n        } catch (e) {}\n        map.__routeOverlays = [];\n    }\n}\n\n"]}]}