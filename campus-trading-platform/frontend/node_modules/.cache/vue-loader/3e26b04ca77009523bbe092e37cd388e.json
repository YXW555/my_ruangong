{"remainingRequest":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\admin-announcement.vue?vue&type=style&index=0&id=db5373b6&scoped=true&lang=css&","dependencies":[{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\src\\components\\page\\admin-announcement.vue","mtime":1767624037627},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\css-loader\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\my_ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.admin-announcement {\n  max-width: 980px;\n  margin: 24px auto;\n  background: #ffffff;\n  border-radius: 8px;\n  padding: 28px;\n  box-shadow: 0 6px 18px rgba(24,39,75,0.08);\n}\n.admin-announcement h2{\n  font-size: 24px;\n  font-weight: 700;\n  color: #2d3a4b;\n  margin-bottom: 18px;\n}\n.admin-announcement .el-form {\n  background: transparent;\n}\n.admin-announcement .el-form-item {\n  margin-bottom: 18px;\n}\n.admin-announcement .el-input__inner {\n  background: #fafbfd;\n  border-radius: 6px;\n  border: 1px solid #e6eef8;\n}\n.admin-announcement .quill-editor {\n  border-radius: 6px;\n  overflow: hidden;\n  border: 1px solid #e6eef8;\n  background: #fafbfd;\n}\n.admin-announcement .el-switch {\n  vertical-align: middle;\n}\n.admin-announcement .el-button--primary {\n  background: linear-gradient(90deg,#409eff,#60aef6);\n  border-color: transparent;\n  box-shadow: 0 6px 12px rgba(64,158,255,0.12);\n}\n@media (max-width: 768px) {\n  .admin-announcement {\n    padding: 16px;\n    margin: 12px;\n  }\n  .admin-announcement h2 {\n    font-size: 20px;\n  }\n}\n",{"version":3,"sources":["admin-announcement.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"admin-announcement.vue","sourceRoot":"src/components/page","sourcesContent":["<template>\n  <div class=\"admin-announcement page-card\">\n    <h2>发布公告</h2>\n    <el-form :model=\"form\" label-width=\"80px\">\n      <el-form-item label=\"标题\">\n        <el-input v-model=\"form.title\" maxlength=\"128\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"内容\">\n        <quill-editor ref=\"quillEditor\" v-model=\"form.content\" :options=\"editorOption\" style=\"height:300px;\"></quill-editor>\n      </el-form-item>\n      <el-form-item label=\"置顶\">\n        <el-switch v-model=\"form.isPinned\"></el-switch>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"submit\" :loading=\"submitting\">发布</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { quillEditor } from 'vue-quill-editor';\nimport 'quill/dist/quill.core.css';\nimport 'quill/dist/quill.snow.css';\nimport 'quill/dist/quill.bubble.css';\n\nexport default {\n  name: 'AdminAnnouncement',\n  data() {\n    return {\n      form: {\n        title: '',\n        content: '',\n        isPinned: 0\n      },\n      submitting: false\n    };\n  },\n  components: {\n    quillEditor\n  },\n  computed: {\n    editorOption() {\n      return {\n        placeholder: '请输入公告内容（支持图片上传）',\n        modules: {\n          toolbar: {\n            container: [\n              ['bold', 'italic', 'underline'],\n              [{ 'header': [1, 2, 3, false] }],\n              [{ 'list': 'ordered'}, { 'list': 'bullet' }],\n              ['link', 'image']\n            ],\n            handlers: {\n              image: this.imageHandler\n            }\n          }\n        }\n      };\n    }\n  },\n  methods: {\n    async imageHandler() {\n      // create file input\n      const input = document.createElement('input');\n      input.setAttribute('type', 'file');\n      input.setAttribute('accept', 'image/*');\n      input.click();\n      input.onchange = async () => {\n        const file = input.files[0];\n        if (!file) return;\n        const formData = new FormData();\n        formData.append('file', file);\n        try {\n          const res = await fetch('/api/file', {\n            method: 'POST',\n            body: formData\n          });\n          const text = await res.text();\n          let parsed = {};\n          try { parsed = JSON.parse(text); } catch { parsed = { status_code: 1, data: text }; }\n          const url = parsed && parsed.status_code === 1 ? parsed.data : text;\n          const quill = this.$refs.quillEditor && this.$refs.quillEditor.quill ? this.$refs.quillEditor.quill : null;\n          if (quill) {\n            const range = quill.getSelection();\n            quill.insertEmbed(range ? range.index : 0, 'image', url);\n          } else {\n            // fallback append as plain img tag\n            this.form.content += `<img src=\"${url}\" />`;\n          }\n        } catch (e) {\n          this.$message.error('图片上传失败');\n        }\n      };\n    },\n    submit() {\n      if (!this.form.title || !this.form.content) {\n        this.$message.error('请填写标题和内容');\n        return;\n      }\n      this.submitting = true;\n      const payload = {\n        title: this.form.title,\n        content: this.form.content,\n        isPinned: this.form.isPinned ? 1 : 0\n      };\n      const apiCall = this.editId ? this.$api.updateAnnouncement({ id: this.editId, ...payload }) : this.$api.addAnnouncement(payload);\n      apiCall.then(res => {\n        if (res.status_code === 1) {\n          this.$message.success('发布成功');\n          this.form.title = '';\n          this.form.content = '';\n          this.form.isPinned = 0;\n          this.$router.push('/announcements');\n        } else {\n          this.$message.error(res.msg || '发布失败');\n        }\n      }).catch(() => {\n        this.$message.error('网络错误');\n      }).finally(() => {\n        this.submitting = false;\n      });\n    }\n  },\n  mounted() {\n    // if editing (id passed), load existing announcement\n    const id = this.$route.query.id;\n    if (id) {\n      this.editId = id;\n      this.$api.getAnnouncement({ id }).then(res => {\n        if (res.status_code === 1 && res.data) {\n          this.form.title = res.data.title;\n          this.form.content = res.data.content;\n          this.form.isPinned = res.data.isPinned === 1 ? 1 : 0;\n        }\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.admin-announcement {\n  max-width: 980px;\n  margin: 24px auto;\n  background: #ffffff;\n  border-radius: 8px;\n  padding: 28px;\n  box-shadow: 0 6px 18px rgba(24,39,75,0.08);\n}\n.admin-announcement h2{\n  font-size: 24px;\n  font-weight: 700;\n  color: #2d3a4b;\n  margin-bottom: 18px;\n}\n.admin-announcement .el-form {\n  background: transparent;\n}\n.admin-announcement .el-form-item {\n  margin-bottom: 18px;\n}\n.admin-announcement .el-input__inner {\n  background: #fafbfd;\n  border-radius: 6px;\n  border: 1px solid #e6eef8;\n}\n.admin-announcement .quill-editor {\n  border-radius: 6px;\n  overflow: hidden;\n  border: 1px solid #e6eef8;\n  background: #fafbfd;\n}\n.admin-announcement .el-switch {\n  vertical-align: middle;\n}\n.admin-announcement .el-button--primary {\n  background: linear-gradient(90deg,#409eff,#60aef6);\n  border-color: transparent;\n  box-shadow: 0 6px 12px rgba(64,158,255,0.12);\n}\n@media (max-width: 768px) {\n  .admin-announcement {\n    padding: 16px;\n    margin: 12px;\n  }\n  .admin-announcement h2 {\n    font-size: 20px;\n  }\n}\n</style>\n\n"]}]}