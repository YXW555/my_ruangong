# 首页商品不显示问题排查

## 问题现象

1. ✅ 在"我的发布"中能看到商品和图片
2. ❌ 在首页商品展示部分看不到商品
3. ❌ 首页看不到图片

## 可能的原因

### 原因 1：商品状态问题

首页可能只显示 `idle_status = 1`（发布状态）的商品。

**检查**：
```bash
cd /opt/campus-trading-platform

# 检查商品状态
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT id, idle_name, idle_status FROM sh_idle_item ORDER BY id DESC LIMIT 10;" 2>&1
```

**状态说明**：
- `1` = 发布（应该在首页显示）
- `2` = 下架（不应该在首页显示）
- `0` = 删除（不应该在首页显示）

### 原因 2：后端查询逻辑问题

后端可能只查询特定状态的商品。

### 原因 3：图片路径解析问题

首页的图片路径解析可能有问题。

## 立即排查

在服务器上执行：

```bash
cd /opt/campus-trading-platform

echo "=== 1. 检查商品状态 ==="
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT id, idle_name, idle_status, LEFT(picture_list, 50) as pic FROM sh_idle_item ORDER BY id DESC LIMIT 10;" 2>&1

echo ""
echo "=== 2. 检查发布状态的商品 ==="
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT COUNT(*) as count FROM sh_idle_item WHERE idle_status = 1;" 2>&1

echo ""
echo "=== 3. 检查后端日志（商品查询相关）==="
sudo docker compose logs backend --tail=50 | grep -i "idle\|商品" || echo "没有相关日志"

echo ""
echo "=== 4. 测试后端接口 ==="
curl "http://localhost:8080/api/idle/lable?idleLabel=1&page=1&nums=8" 2>&1 | head -20
```

## 解决方案

### 方案 1：修改商品状态为"发布"

如果商品状态不是 1，需要修改：

```bash
cd /opt/campus-trading-platform

# 将指定商品状态改为 1（发布）
sudo docker compose exec mysql mysql -u root -proot123456 second_hand_trading << 'EOF'
UPDATE sh_idle_item 
SET idle_status = 1 
WHERE id IN (6, 7) AND idle_status != 1;
EOF

# 验证
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT id, idle_name, idle_status FROM sh_idle_item WHERE id IN (6, 7);" 2>&1
```

### 方案 2：检查后端查询逻辑

查看后端代码是否正确过滤了状态。

### 方案 3：检查前端图片显示

检查首页的图片路径解析是否正确。

## 完整排查脚本

```bash
cd /opt/campus-trading-platform

echo "=== 完整排查 ==="
echo ""
echo "1. 所有商品状态："
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT id, idle_name, idle_status, release_time FROM sh_idle_item ORDER BY id DESC LIMIT 10;" 2>&1

echo ""
echo "2. 发布状态的商品数量："
sudo docker compose exec mysql mysql -u trading_user -ptrading123456 -e "USE second_hand_trading; SELECT COUNT(*) as published_count FROM sh_idle_item WHERE idle_status = 1;" 2>&1

echo ""
echo "3. 测试后端接口（分类1，第1页）："
curl -s "http://localhost:8080/api/idle/lable?idleLabel=1&page=1&nums=8" | python3 -m json.tool 2>/dev/null | head -30 || curl -s "http://localhost:8080/api/idle/lable?idleLabel=1&page=1&nums=8" | head -30

echo ""
echo "4. 测试后端接口（全部商品）："
curl -s "http://localhost:8080/api/idle/all?page=1&nums=8" | python3 -m json.tool 2>/dev/null | head -30 || curl -s "http://localhost:8080/api/idle/all?page=1&nums=8" | head -30
```

