{"remainingRequest":"D:\\Git\\ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Git\\ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\MerchantApplicationAdmin.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Git\\ruangong\\campus-trading-platform\\frontend\\src\\components\\common\\MerchantApplicationAdmin.vue","mtime":1766651880118},{"path":"D:\\Git\\ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\ruangong\\campus-trading-platform\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1678197338000},{"path":"D:\\Git\\ruangong\\campus-trading-platform\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1678197338000},{"path":"D:\\Git\\ruangong\\campus-trading-platform\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":1678197338000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n    name: \"MerchantApplicationAdmin\",\r\n    data() {\r\n        return {\r\n            loading: false,\r\n            applications: [],\r\n            dialogVisible: false,\r\n            currentApplication: null,\r\n            adminComment: ''\r\n        };\r\n    },\r\n    created() {\r\n        this.loadApplications();\r\n    },\r\n    methods: {\r\n        loadApplications() {\r\n            this.loading = true;\r\n            this.$api.adminGetAllApplications({ status: 0 }) // 0 表示待审核\r\n                .then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.applications = res.data;\r\n                    }\r\n                    this.loading = false;\r\n                })\r\n                .catch(() => {\r\n                    this.loading = false;\r\n                    this.$message.error('数据加载失败');\r\n                });\r\n        },\r\n        viewDetails(application) {\r\n            this.currentApplication = application;\r\n            this.adminComment = '';\r\n            this.dialogVisible = true;\r\n        },\r\n        review(status) {\r\n            if (status === 2 && !this.adminComment) {\r\n                this.$message.warning('拒绝申请必须填写理由');\r\n                return;\r\n            }\r\n            this.$api.adminReviewApplication({\r\n                applicationId: this.currentApplication.id,\r\n                status: status,\r\n                adminComment: this.adminComment\r\n            }).then(res => {\r\n                if (res.status_code === 1) {\r\n                    this.$message.success('操作成功');\r\n                    this.dialogVisible = false;\r\n                    this.loadApplications(); // 刷新列表\r\n                    // 调用父组件方法刷新角标\r\n                    this.$parent.loadPendingCount();\r\n                } else {\r\n                    this.$message.error(res.msg || '操作失败');\r\n                }\r\n            }).catch(() => {\r\n                this.$message.error('操作失败');\r\n            });\r\n        }\r\n    },\r\n    filters: {\r\n        formatDate(time) {\r\n            if (!time) return '';\r\n            let date = new Date(time);\r\n            return date.toLocaleString();\r\n        }\r\n    }\r\n}\r\n",{"version":3,"sources":["MerchantApplicationAdmin.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MerchantApplicationAdmin.vue","sourceRoot":"src/components/common","sourcesContent":["<template>\r\n    <div class=\"merchant-application-admin-container\">\r\n        <el-card shadow=\"never\">\r\n            <div slot=\"header\" class=\"clearfix\">\r\n                <span>商家认证审核</span>\r\n                <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"loadApplications\">刷新</el-button>\r\n            </div>\r\n\r\n            <el-table\r\n                :data=\"applications\"\r\n                v-loading=\"loading\"\r\n                style=\"width: 100%\">\r\n                <el-table-column\r\n                    prop=\"user.nickname\"\r\n                    label=\"申请人\"\r\n                    width=\"180\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                    prop=\"shopName\"\r\n                    label=\"店铺名称\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                    prop=\"contactPhone\"\r\n                    label=\"联系电话\"\r\n                    width=\"180\">\r\n                </el-table-column>\r\n                <el-table-column\r\n                    prop=\"createTime\"\r\n                    label=\"申请时间\"\r\n                    width=\"180\">\r\n                    <template slot-scope=\"scope\">\r\n                        {{ scope.row.createTime | formatDate }}\r\n                    </template>\r\n                </el-table-column>\r\n                <el-table-column\r\n                    label=\"操作\"\r\n                    width=\"120\">\r\n                    <template slot-scope=\"scope\">\r\n                        <el-button type=\"primary\" size=\"mini\" @click=\"viewDetails(scope.row)\">查看详情</el-button>\r\n                    </template>\r\n                </el-table-column>\r\n            </el-table>\r\n        </el-card>\r\n\r\n        <!-- 详情对话框 -->\r\n        <el-dialog\r\n            title=\"审核商家认证申请\"\r\n            :visible.sync=\"dialogVisible\"\r\n            width=\"60%\"\r\n            @close=\"currentApplication = null\">\r\n            <div v-if=\"currentApplication\" class=\"detail-content\">\r\n                <el-descriptions :column=\"2\" border>\r\n                    <el-descriptions-item label=\"申请人\">{{ currentApplication.user.nickname }}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"申请时间\">{{ currentApplication.createTime | formatDate }}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"店铺名称\">{{ currentApplication.shopName }}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"联系电话\">{{ currentApplication.contactPhone }}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"联系地址\" :span=\"2\">{{ currentApplication.contactAddress }}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"申请理由\" :span=\"2\">{{ currentApplication.applicationReason || '无' }}</el-descriptions-item>\r\n                </el-descriptions>\r\n\r\n                <el-divider>认证材料</el-divider>\r\n\r\n                <div class=\"image-gallery\">\r\n                    <div class=\"image-item\">\r\n                        <p>身份证正面</p>\r\n                        <el-image :src=\"currentApplication.idCardFront\" :preview-src-list=\"[currentApplication.idCardFront]\"></el-image>\r\n                    </div>\r\n                    <div class=\"image-item\">\r\n                        <p>身份证反面</p>\r\n                        <el-image :src=\"currentApplication.idCardBack\" :preview-src-list=\"[currentApplication.idCardBack]\"></el-image>\r\n                    </div>\r\n                    <div class=\"image-item\" v-if=\"currentApplication.businessLicense\">\r\n                        <p>营业执照</p>\r\n                        <el-image :src=\"currentApplication.businessLicense\" :preview-src-list=\"[currentApplication.businessLicense]\"></el-image>\r\n                    </div>\r\n                </div>\r\n\r\n                <el-divider>审核操作</el-divider>\r\n                <div class=\"review-actions\">\r\n                     <el-input\r\n                        v-model=\"adminComment\"\r\n                        type=\"textarea\"\r\n                        :rows=\"3\"\r\n                        placeholder=\"如果拒绝，请填写拒绝理由...\"\r\n                        style=\"margin-bottom: 20px;\">\r\n                    </el-input>\r\n                    <el-button type=\"success\" icon=\"el-icon-check\" @click=\"review(1)\">批准申请</el-button>\r\n                    <el-button type=\"danger\" icon=\"el-icon-close\" @click=\"review(2)\">拒绝申请</el-button>\r\n                </div>\r\n            </div>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"dialogVisible = false\">关闭</el-button>\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name: \"MerchantApplicationAdmin\",\r\n    data() {\r\n        return {\r\n            loading: false,\r\n            applications: [],\r\n            dialogVisible: false,\r\n            currentApplication: null,\r\n            adminComment: ''\r\n        };\r\n    },\r\n    created() {\r\n        this.loadApplications();\r\n    },\r\n    methods: {\r\n        loadApplications() {\r\n            this.loading = true;\r\n            this.$api.adminGetAllApplications({ status: 0 }) // 0 表示待审核\r\n                .then(res => {\r\n                    if (res.status_code === 1) {\r\n                        this.applications = res.data;\r\n                    }\r\n                    this.loading = false;\r\n                })\r\n                .catch(() => {\r\n                    this.loading = false;\r\n                    this.$message.error('数据加载失败');\r\n                });\r\n        },\r\n        viewDetails(application) {\r\n            this.currentApplication = application;\r\n            this.adminComment = '';\r\n            this.dialogVisible = true;\r\n        },\r\n        review(status) {\r\n            if (status === 2 && !this.adminComment) {\r\n                this.$message.warning('拒绝申请必须填写理由');\r\n                return;\r\n            }\r\n            this.$api.adminReviewApplication({\r\n                applicationId: this.currentApplication.id,\r\n                status: status,\r\n                adminComment: this.adminComment\r\n            }).then(res => {\r\n                if (res.status_code === 1) {\r\n                    this.$message.success('操作成功');\r\n                    this.dialogVisible = false;\r\n                    this.loadApplications(); // 刷新列表\r\n                    // 调用父组件方法刷新角标\r\n                    this.$parent.loadPendingCount();\r\n                } else {\r\n                    this.$message.error(res.msg || '操作失败');\r\n                }\r\n            }).catch(() => {\r\n                this.$message.error('操作失败');\r\n            });\r\n        }\r\n    },\r\n    filters: {\r\n        formatDate(time) {\r\n            if (!time) return '';\r\n            let date = new Date(time);\r\n            return date.toLocaleString();\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.merchant-application-admin-container {\r\n    padding: 20px;\r\n}\r\n.detail-content {\r\n    max-height: 60vh;\r\n    overflow-y: auto;\r\n}\r\n.image-gallery {\r\n    display: flex;\r\n    gap: 20px;\r\n    margin-top: 20px;\r\n}\r\n.image-item {\r\n    text-align: center;\r\n}\r\n.image-item p {\r\n    margin-bottom: 10px;\r\n    color: #606266;\r\n}\r\n.image-item .el-image {\r\n    width: 200px;\r\n    height: 120px;\r\n    border: 1px solid #ebeef5;\r\n    border-radius: 4px;\r\n}\r\n.review-actions {\r\n    text-align: center;\r\n    margin-top: 20px;\r\n}\r\n</style>\r\n"]}]}